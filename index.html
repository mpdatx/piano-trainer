<!-- GENERATED FILE â€” do not edit. Source is in src/ directory. Run: npm run build -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#1a1a2e">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="manifest" href="manifest.json">
    <link rel="icon" href="icon.svg" type="image/svg+xml">
    <link rel="apple-touch-icon" href="icon-192.png">
    <title>Piano Trainer</title>
    <script src="vexflow.js"></script>
    <script src="tone.js"></script>
    <style>
                * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #1a1a2e;
            color: #eee;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            padding: max(10px, env(safe-area-inset-top)) max(10px, env(safe-area-inset-right)) max(10px, env(safe-area-inset-bottom)) max(10px, env(safe-area-inset-left));
            overflow-x: hidden;
        }
        h1 {
            font-size: clamp(1.2rem, 4vw, 1.5rem);
            margin-bottom: 15px;
            font-weight: 300;
            letter-spacing: 2px;
            text-align: center;
        }
        #staff-container {
            background: #fff;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            overflow-x: auto;
            width: 100%;
            max-width: min(95vw, 400px);
            display: flex;
            justify-content: center;
        }
        #keyboard-container {
            display: flex;
            overflow-x: auto;
            overflow-y: hidden;
            width: 100%;
            max-width: 100vw;
            padding: 10px 0;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: thin;
        }
        #keyboard-container::-webkit-scrollbar {
            height: 8px;
        }
        #keyboard-container::-webkit-scrollbar-track {
            background: rgba(255,255,255,0.1);
            border-radius: 4px;
        }
        #keyboard-container::-webkit-scrollbar-thumb {
            background: rgba(255,255,255,0.3);
            border-radius: 4px;
        }
        #keyboard {
            display: flex;
            position: relative;
            cursor: pointer;
            user-select: none;
            touch-action: pan-x pan-y;
            margin: 0 auto;
            --key-width: 50px;
            --key-height: 180px;
        }
        .key {
            position: relative;
            border: 1px solid #333;
            border-radius: 0 0 6px 6px;
            transition: background 0.08s;
            touch-action: manipulation;
        }
        .key.white {
            width: var(--key-width);
            height: var(--key-height);
            background: linear-gradient(to bottom, #f8f8f8, #fff);
            z-index: 1;
        }
        .key.white:hover {
            background: linear-gradient(to bottom, #e8e8e8, #f0f0f0);
        }
        .key.white.active {
            background: linear-gradient(to bottom, #c8d8f8, #d8e8ff);
        }
        .key.black {
            width: calc(var(--key-width) * 0.6);
            height: calc(var(--key-height) * 0.61);
            background: linear-gradient(to bottom, #333, #111);
            margin-left: calc(var(--key-width) * -0.3);
            margin-right: calc(var(--key-width) * -0.3);
            z-index: 2;
            border-color: #000;
            box-shadow: 2px 2px 5px rgba(0,0,0,0.4);
        }
        .key.black:hover {
            background: linear-gradient(to bottom, #555, #333);
        }
        .key.black.active {
            background: linear-gradient(to bottom, #446, #335);
        }
        @media (max-height: 700px) and (max-width: 480px) {
            #staff-container {
                padding: 8px;
                margin-bottom: 10px;
            }
            .back-btn { margin-bottom: 8px; }
            #level-info { margin-bottom: 8px; }
            #feedback { min-height: 1.5rem; margin-bottom: 5px; }
            #controls { margin-bottom: 10px; gap: 8px; }
            #keyboard-container { padding: 5px 0; }
        }
        .key-label {
            position: absolute;
            bottom: 8px;
            left: 50%;
            transform: translateX(-50%);
            font-size: clamp(8px, 2vw, 10px);
            color: #999;
            pointer-events: none;
            white-space: nowrap;
        }
        .key.black .key-label {
            color: #888;
            font-size: clamp(7px, 1.8vw, 9px);
        }
        .key.wrong {
            background: linear-gradient(to bottom, #f88, #faa) !important;
        }
        .key.correct {
            background: linear-gradient(to bottom, #8f8, #afa) !important;
        }
        #feedback {
            font-size: clamp(1rem, 3.5vw, 1.2rem);
            min-height: 2rem;
            margin-bottom: 10px;
            text-align: center;
        }
        #feedback.correct { color: #8f8; }
        #feedback.wrong { color: #f88; }
        #controls {
            margin-bottom: 20px;
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            justify-content: center;
            align-items: center;
        }
        #controls label {
            cursor: pointer;
            font-size: clamp(0.8rem, 2.5vw, 0.9rem);
            display: flex;
            align-items: center;
            gap: 6px;
        }
        #controls input {
            cursor: pointer;
            width: 18px;
            height: 18px;
        }
        #controls button {
            padding: 8px 16px;
            background: #444;
            border: 1px solid #666;
            color: #ccc;
            border-radius: 4px;
            cursor: pointer;
            font-size: clamp(0.75rem, 2.5vw, 0.85rem);
            touch-action: manipulation;
        }
        #controls button:hover, #controls button:active {
            background: #555;
        }
        #audio-prompt {
            font-size: 3rem;
            color: #666;
            margin: 20px 0;
        }
        #note-prompt {
            font-size: clamp(2.5rem, 8vw, 4rem);
            color: #fff;
            margin: 20px 0;
            font-weight: bold;
            letter-spacing: 2px;
        }
        /* Main Menu */
        #main-menu {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            padding: 20px;
        }
        #main-menu.hidden { display: none; }
        .menu-title {
            font-size: clamp(1rem, 3vw, 1.2rem);
            color: #aaa;
            margin-bottom: 10px;
        }
        .mode-cards {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            max-width: 400px;
            width: 100%;
        }
        .mode-card {
            background: rgba(255,255,255,0.08);
            border: 2px solid #444;
            border-radius: 12px;
            padding: 20px 15px;
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
        }
        .mode-card:hover {
            background: rgba(255,255,255,0.12);
            border-color: #666;
            transform: translateY(-2px);
        }
        .mode-card:active {
            transform: translateY(0);
        }
        .mode-card h3 {
            font-size: clamp(0.9rem, 3vw, 1.1rem);
            margin-bottom: 8px;
            font-weight: 400;
        }
        .mode-icon {
            font-size: 2rem;
            margin-bottom: 8px;
        }
        .mode-level {
            font-size: clamp(0.7rem, 2.2vw, 0.8rem);
            color: #8f8;
            font-weight: bold;
            margin-bottom: 4px;
        }
        .mode-accuracy {
            font-size: clamp(0.65rem, 2vw, 0.75rem);
            color: #888;
        }
        /* Quiz Screen */
        #quiz-screen {
            display: none;
            width: 100%;
            flex-direction: column;
            align-items: center;
        }
        #quiz-screen.active { display: flex; }
        .back-btn {
            padding: 8px 16px;
            background: #333;
            border: 1px solid #555;
            color: #aaa;
            border-radius: 4px;
            cursor: pointer;
            font-size: clamp(0.75rem, 2.5vw, 0.85rem);
            margin-bottom: 15px;
            align-self: flex-start;
        }
        .back-btn:hover { background: #444; }
        /* Level Complete Overlay */
        #level-complete {
            display: none;
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.85);
            z-index: 100;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 20px;
        }
        .level-complete-content {
            text-align: center;
            padding: 40px;
        }
        .level-complete-content h2 {
            color: #8f8;
            font-size: clamp(1.5rem, 5vw, 2rem);
            font-weight: 400;
            margin-bottom: 15px;
        }
        .level-complete-content .next-level-name {
            color: #aaa;
            font-size: clamp(1rem, 3vw, 1.2rem);
            margin-bottom: 25px;
        }
        .level-btns {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }
        .level-btns button {
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: clamp(0.85rem, 2.8vw, 1rem);
            touch-action: manipulation;
        }
        #continue-btn {
            background: #22aa55;
            border: none;
            color: #fff;
        }
        #continue-btn:hover { background: #2bc462; }
        #menu-btn {
            background: #444;
            border: 1px solid #666;
            color: #ccc;
        }
        #menu-btn:hover { background: #555; }
        #stay-btn {
            background: #444;
            border: 1px solid #666;
            color: #ccc;
        }
        #stay-btn:hover { background: #555; }
        #reset-stay-btn {
            background: #553322;
            border: 1px solid #774433;
            color: #daa;
        }
        #reset-stay-btn:hover { background: #664433; }
        #level-picker {
            background: #333;
            color: #ccc;
            border: 1px solid #555;
            border-radius: 4px;
            padding: 2px 6px;
            font-size: clamp(0.75rem, 2.5vw, 0.85rem);
            margin-left: 8px;
            cursor: pointer;
        }
        #level-picker option:disabled {
            color: #666;
        }
        #unlock-all-btn {
            font-size: clamp(0.65rem, 2vw, 0.75rem);
            color: #666;
            text-decoration: none;
            margin-left: 4px;
        }
        #unlock-all-btn:hover { color: #aaa; }
        /* Interval / Key Signature Buttons */
        #keysig-buttons, #circle-buttons {
            display: none;
            flex-wrap: wrap;
            gap: 8px;
            justify-content: center;
            max-width: 500px;
            padding: 10px 0;
        }
        #interval-buttons {
            display: none;
            flex-wrap: wrap;
            gap: 8px;
            justify-content: center;
            max-width: 500px;
            padding: 10px 0;
        }
        .interval-btn {
            padding: 10px 16px;
            background: #333;
            border: 2px solid #555;
            color: #ccc;
            border-radius: 6px;
            cursor: pointer;
            font-size: clamp(0.8rem, 2.5vw, 0.9rem);
            transition: all 0.15s;
            touch-action: manipulation;
        }
        .interval-btn:hover {
            background: #444;
            border-color: #777;
        }
        .interval-btn.correct {
            background: #2a6;
            border-color: #3c8;
            color: #fff;
        }
        .interval-btn.wrong {
            background: #a33;
            border-color: #c44;
            color: #fff;
        }
        .labels-hidden .key-label {
            display: none;
        }
        .octave-marker {
            width: 2px;
            height: var(--key-height);
            background: #666;
            margin: 0 2px;
            z-index: 0;
        }
        .octave-label {
            position: absolute;
            top: -20px;
            left: 50%;
            transform: translateX(-50%);
            font-size: clamp(9px, 2.2vw, 11px);
            color: #888;
            white-space: nowrap;
        }
        #stats {
            margin-top: 20px;
            background: rgba(255,255,255,0.1);
            border-radius: 8px;
            padding: 12px 15px;
            width: 100%;
            max-width: 95vw;
        }
        #stats h2 {
            font-size: clamp(0.85rem, 3vw, 1rem);
            font-weight: 300;
            margin-bottom: 10px;
            letter-spacing: 1px;
            text-align: center;
        }
        #stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(40px, 1fr));
            gap: 5px;
            max-width: 500px;
            margin: 0 auto;
        }
        .note-stat {
            text-align: center;
            padding: 6px 4px;
            background: rgba(0,0,0,0.2);
            border-radius: 4px;
        }
        .note-stat .note-name {
            font-size: clamp(0.75rem, 2.5vw, 0.9rem);
            font-weight: bold;
            margin-bottom: 2px;
        }
        .note-stat .note-accuracy {
            font-size: clamp(0.6rem, 2vw, 0.7rem);
            color: #aaa;
        }
        .note-stat.perfect { background: rgba(0,200,0,0.3); }
        .note-stat.good { background: rgba(100,200,0,0.2); }
        .note-stat.struggling { background: rgba(200,100,0,0.2); }
        .note-stat.bad { background: rgba(200,0,0,0.2); }
        .note-stat.locked { opacity: 0.4; }
        #level-info {
            margin-bottom: 15px;
            text-align: center;
            width: 100%;
        }
        #level-display {
            font-size: clamp(0.8rem, 2.8vw, 0.9rem);
            color: #aaa;
        }
        #level-progress {
            margin-top: 6px;
        }
        #level-progress-bar {
            width: 200px;
            max-width: 60vw;
            height: 6px;
            background: #333;
            border-radius: 3px;
            margin: 0 auto 4px;
            overflow: hidden;
        }
        #level-progress-fill {
            height: 100%;
            background: #22aa55;
            border-radius: 3px;
            transition: width 0.3s;
            width: 0%;
        }
        #level-progress-text {
            font-size: clamp(0.65rem, 2.2vw, 0.75rem);
            color: #777;
        }
        #streak-display {
            font-size: clamp(0.75rem, 2.5vw, 0.85rem);
            color: #888;
            margin-top: 5px;
        }
        #level-up-msg {
            color: #8f8;
            font-size: clamp(0.95rem, 3.2vw, 1.1rem);
            animation: pulse 0.5s ease-in-out;
        }
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        #response-time {
            font-size: clamp(0.7rem, 2.4vw, 0.8rem);
            color: #888;
            margin-top: 5px;
            text-align: center;
        }
        /* Notation Learning Mode */
        #notation-chapters {
            display: none;
            width: 100%;
            max-width: 500px;
            flex-direction: column;
            align-items: center;
        }
        #notation-chapters.active { display: flex; }
        .chapter-list {
            width: 100%;
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 10px;
        }
        .chapter-item {
            background: rgba(255,255,255,0.08);
            border: 2px solid #444;
            border-radius: 10px;
            padding: 15px 20px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        .chapter-item:hover { background: rgba(255,255,255,0.12); border-color: #666; }
        .chapter-item.locked { opacity: 0.4; cursor: default; }
        .chapter-item.locked:hover { background: rgba(255,255,255,0.08); border-color: #444; }
        .chapter-item.current { border-color: #4488cc; }
        .chapter-item.completed { border-color: #22aa55; }
        .chapter-num {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: #333;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1rem;
            flex-shrink: 0;
        }
        .chapter-item.completed .chapter-num { background: #22aa55; }
        .chapter-item.current .chapter-num { background: #4488cc; }
        .chapter-info h3 {
            font-size: clamp(0.9rem, 3vw, 1rem);
            font-weight: 400;
            margin-bottom: 3px;
        }
        .chapter-info p {
            font-size: clamp(0.7rem, 2.2vw, 0.8rem);
            color: #888;
        }
        #notation-lesson {
            display: none;
            width: 100%;
            max-width: 500px;
            flex-direction: column;
            align-items: center;
        }
        #notation-lesson.active { display: flex; }
        .lesson-content {
            background: rgba(255,255,255,0.05);
            border-radius: 10px;
            padding: 20px;
            width: 100%;
            margin-bottom: 15px;
            line-height: 1.6;
            font-size: clamp(0.85rem, 2.8vw, 0.95rem);
        }
        .lesson-content h3 {
            font-size: clamp(1rem, 3.2vw, 1.15rem);
            margin-bottom: 12px;
            font-weight: 400;
            color: #fff;
        }
        .lesson-content p { margin-bottom: 10px; color: #ccc; }
        .lesson-content .staff-example {
            background: #fff;
            border-radius: 8px;
            padding: 10px;
            margin: 12px 0;
            display: flex;
            justify-content: center;
            overflow-x: auto;
        }
        .lesson-content .highlight { color: #6af; font-weight: bold; }
        .lesson-content .mnemonic { color: #fa6; font-style: italic; }
        .lesson-nav {
            display: flex;
            gap: 12px;
            align-items: center;
            margin-bottom: 15px;
        }
        .lesson-nav button {
            padding: 10px 20px;
            background: #444;
            border: 1px solid #666;
            color: #ccc;
            border-radius: 6px;
            cursor: pointer;
            font-size: clamp(0.8rem, 2.5vw, 0.9rem);
            touch-action: manipulation;
        }
        .lesson-nav button:hover { background: #555; }
        .lesson-nav button.primary { background: #22aa55; border-color: #22aa55; color: #fff; }
        .lesson-nav button.primary:hover { background: #2bc462; }
        .lesson-page-indicator {
            font-size: clamp(0.75rem, 2.5vw, 0.85rem);
            color: #888;
        }
        #notation-quiz {
            display: none;
            width: 100%;
            max-width: 500px;
            flex-direction: column;
            align-items: center;
        }
        #notation-quiz.active { display: flex; }
        .mc-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            max-width: 400px;
            padding: 10px 0;
        }
        .mc-btn {
            padding: 12px 20px;
            background: #333;
            border: 2px solid #555;
            color: #ccc;
            border-radius: 8px;
            cursor: pointer;
            font-size: clamp(0.8rem, 2.5vw, 0.95rem);
            transition: all 0.15s;
            touch-action: manipulation;
            min-width: 120px;
            text-align: center;
        }
        .mc-btn:hover { background: #444; border-color: #777; }
        .mc-btn.correct { background: #2a6; border-color: #3c8; color: #fff; }
        .mc-btn.wrong { background: #a33; border-color: #c44; color: #fff; }
        /* Free Play Screen */
        #freeplay-screen {
            display: none;
            width: 100%;
            flex-direction: column;
            align-items: center;
        }
        #freeplay-screen.active { display: flex; }
        #freeplay-staff-container {
            background: #fff;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            overflow-x: auto;
            width: 100%;
            max-width: min(95vw, 700px);
            display: flex;
            justify-content: center;
            min-height: 160px;
        }
        #freeplay-keyboard-container {
            display: flex;
            overflow-x: auto;
            overflow-y: hidden;
            width: 100%;
            max-width: 100vw;
            padding: 10px 0;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: thin;
        }
        #freeplay-keyboard-container::-webkit-scrollbar { height: 8px; }
        #freeplay-keyboard-container::-webkit-scrollbar-track { background: rgba(255,255,255,0.1); border-radius: 4px; }
        #freeplay-keyboard-container::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.3); border-radius: 4px; }
        #freeplay-keyboard {
            display: flex;
            position: relative;
            cursor: pointer;
            user-select: none;
            touch-action: pan-x pan-y;
            margin: 0 auto;
            --key-width: 50px;
            --key-height: 180px;
        }
        #freeplay-keyboard.freeplay-narrow {
            flex-wrap: wrap;
            justify-content: center;
            gap: 4px 0;
        }
        #freeplay-keyboard.freeplay-narrow .octave-marker {
            display: none;
        }
        #freeplay-keyboard.freeplay-narrow .octave-group {
            flex-basis: 100%;
            justify-content: center;
        }
        #freeplay-keyboard-row {
            display: flex;
            align-items: center;
            width: 100%;
            gap: 6px;
        }
        .octave-arrow {
            background: #333;
            border: 1px solid #555;
            color: #ccc;
            font-size: clamp(1.2rem, 4vw, 1.5rem);
            padding: 12px 10px;
            border-radius: 6px;
            cursor: pointer;
            touch-action: manipulation;
            flex-shrink: 0;
        }
        .octave-arrow:hover { background: #444; }
        .octave-arrow:active { background: #555; }
        .octave-arrow:disabled { opacity: 0.3; cursor: default; }
        .octave-arrow:disabled:hover { background: #333; }
        #freeplay-octave-label {
            text-align: center;
            font-size: clamp(0.75rem, 2.5vw, 0.85rem);
            color: #888;
            margin-top: 6px;
        }
        #freeplay-controls {
            margin-top: 10px;
            display: flex;
            gap: 12px;
            justify-content: center;
            align-items: center;
        }
        #freeplay-controls label {
            cursor: pointer;
            font-size: clamp(0.8rem, 2.5vw, 0.9rem);
            display: flex;
            align-items: center;
            gap: 6px;
        }
        #freeplay-controls input {
            cursor: pointer;
            width: 18px;
            height: 18px;
        }

    </style>
</head>
<body>
    <h1>PIANO TRAINER</h1>

    <!-- Main Menu -->
    <div id="main-menu">
        <div class="menu-title">Choose a training mode</div>
        <div class="mode-cards">
            <div class="mode-card" id="card-visual">
                <div class="mode-icon">&#x1F3B5;</div>
                <h3>Note Reading</h3>
                <div class="mode-level" id="menu-visual-level">Level 1</div>
                <div class="mode-accuracy" id="menu-visual-accuracy">No attempts yet</div>
            </div>
            <div class="mode-card" id="card-audio">
                <div class="mode-icon">&#x1F50A;</div>
                <h3>Ear Training</h3>
                <div class="mode-level" id="menu-audio-level">Level 1</div>
                <div class="mode-accuracy" id="menu-audio-accuracy">No attempts yet</div>
            </div>
            <div class="mode-card" id="card-reverse">
                <div class="mode-icon">&#x1F3B9;</div>
                <h3>Note Finding</h3>
                <div class="mode-level" id="menu-reverse-level">Level 1</div>
                <div class="mode-accuracy" id="menu-reverse-accuracy">No attempts yet</div>
            </div>
            <div class="mode-card" id="card-interval">
                <div class="mode-icon">&#x1F3B6;</div>
                <h3>Intervals</h3>
                <div class="mode-level" id="menu-interval-level">Level 1</div>
                <div class="mode-accuracy" id="menu-interval-accuracy">No attempts yet</div>
            </div>
            <div class="mode-card" id="card-keysig">
                <div class="mode-icon">&#x266D;</div>
                <h3>Key Signatures</h3>
                <div class="mode-level" id="menu-keysig-level">Level 1</div>
                <div class="mode-accuracy" id="menu-keysig-accuracy">No attempts yet</div>
            </div>
            <div class="mode-card" id="card-circle">
                <div class="mode-icon">&#x1F504;</div>
                <h3>Circle of Fifths</h3>
                <div class="mode-level" id="menu-circle-level">Level 1</div>
                <div class="mode-accuracy" id="menu-circle-accuracy">No attempts yet</div>
            </div>
            <div class="mode-card" id="card-freeplay">
                <div class="mode-icon">&#x1F3B9;</div>
                <h3>Free Play</h3>
                <div class="mode-level" id="menu-freeplay-level">2 Octaves</div>
                <div class="mode-accuracy" id="menu-freeplay-accuracy">Play freely</div>
            </div>
            <div class="mode-card" id="card-notation">
                <div class="mode-icon">&#x1F3BC;</div>
                <h3>Music Notation</h3>
                <div class="mode-level" id="menu-notation-level">Chapter 1 of 17</div>
                <div class="mode-accuracy" id="menu-notation-accuracy">Not started</div>
            </div>
        </div>
        <button id="reset-btn" style="padding:8px 16px;background:#444;border:1px solid #666;color:#ccc;border-radius:4px;cursor:pointer;margin-top:10px;">Reset All Progress</button>
        <div id="app-version" style="margin-top:15px;font-size:0.7rem;color:#555;"></div>
    </div>

    <!-- Quiz Screen -->
    <div id="quiz-screen">
        <button class="back-btn" id="back-to-menu">&larr; Back to Menu</button>
        <div id="staff-container">
            <div id="staff"></div>
        </div>
        <div id="level-info">
            <div id="level-display"> <select id="level-picker"></select> <a href="#" id="unlock-all-btn"></a></div>
            <div id="level-progress">
                <div id="level-progress-bar"><div id="level-progress-fill"></div></div>
                <div id="level-progress-text"></div>
            </div>
            <div id="streak-display"></div>
        </div>
        <div id="feedback"></div>
        <div id="response-time"></div>
        <div id="controls">
            <button id="replay-btn" style="display: none;">Replay</button>
            <button id="start-btn">Start</button>
            <label><input type="checkbox" id="show-labels" checked> Show key names</label>
            <label id="delay-control" style="display:none;">Delay
                <select id="next-delay">
                    <option value="0">None</option>
                    <option value="400">0.4s</option>
                    <option value="800">0.8s</option>
                    <option value="1200" selected>1.2s</option>
                    <option value="2000">2s</option>
                    <option value="3000">3s</option>
                </select>
            </label>
        </div>
        <div id="keyboard-container">
            <div id="keyboard"></div>
        </div>
        <div id="interval-buttons"></div>
        <div id="keysig-buttons"></div>
        <div class="button-grid" id="circle-buttons" style="display:none"></div>
        <div id="stats">
            <h2>ACCURACY BY NOTE</h2>
            <div id="stats-grid"></div>
        </div>
    </div>

    <!-- Free Play Screen -->
    <div id="freeplay-screen">
        <button class="back-btn" id="freeplay-back-menu">&larr; Back to Menu</button>
        <div id="freeplay-staff-container">
            <div id="freeplay-staff"></div>
        </div>
        <div id="freeplay-keyboard-row">
            <button class="octave-arrow" id="freeplay-octave-down">&larr;</button>
            <div id="freeplay-keyboard-container">
                <div id="freeplay-keyboard"></div>
            </div>
            <button class="octave-arrow" id="freeplay-octave-up">&rarr;</button>
        </div>
        <div id="freeplay-octave-label"></div>
        <div id="freeplay-controls">
            <label><input type="checkbox" id="freeplay-note-times"> Note durations</label>
        </div>
    </div>

    <!-- Level Complete Overlay -->
    <div id="level-complete">
        <div class="level-complete-content">
            <h2>Level Complete!</h2>
            <div class="next-level-name" id="next-level-name"></div>
            <div class="level-btns">
                <button id="continue-btn">Continue to Next Level</button>
                <button id="stay-btn">Stay on this Level</button>
                <button id="reset-stay-btn">Reset &amp; Stay</button>
                <button id="menu-btn">Back to Menu</button>
            </div>
        </div>
    </div>

    <!-- Notation Chapter List -->
    <div id="notation-chapters">
        <button class="back-btn" id="notation-back-menu">&larr; Back to Menu</button>
        <h2 style="font-weight:300;letter-spacing:1px;margin-bottom:5px;">Music Notation</h2>
        <p style="color:#888;font-size:clamp(0.75rem,2.5vw,0.85rem);margin-bottom:10px;">Learn to read sheet music</p>
        <div class="chapter-list" id="chapter-list"></div>
    </div>

    <!-- Notation Lesson Screen -->
    <div id="notation-lesson">
        <button class="back-btn" id="lesson-back-chapters">&larr; Back to Chapters</button>
        <h2 id="lesson-title" style="font-weight:300;letter-spacing:1px;margin-bottom:5px;"></h2>
        <div class="lesson-page-indicator" id="lesson-page-indicator"></div>
        <div class="lesson-content" id="lesson-content"></div>
        <div class="lesson-nav">
            <button id="lesson-prev">Previous</button>
            <button id="lesson-next" class="primary">Next</button>
        </div>
    </div>

    <!-- Notation Quiz Screen -->
    <div id="notation-quiz">
        <button class="back-btn" id="quiz-back-chapters">&larr; Back to Chapters</button>
        <h2 id="nq-title" style="font-weight:300;letter-spacing:1px;margin-bottom:5px;"></h2>
        <div id="nq-level-info" style="margin-bottom:15px;text-align:center;width:100%;">
            <div id="nq-level-progress">
                <div id="nq-progress-bar" style="width:200px;max-width:60vw;height:6px;background:#333;border-radius:3px;margin:0 auto 4px;overflow:hidden;">
                    <div id="nq-progress-fill" style="height:100%;background:#22aa55;border-radius:3px;transition:width 0.3s;width:0%;"></div>
                </div>
                <div id="nq-progress-text" style="font-size:clamp(0.65rem,2.2vw,0.75rem);color:#777;"></div>
            </div>
            <div id="nq-streak" style="font-size:clamp(0.75rem,2.5vw,0.85rem);color:#888;margin-top:5px;"></div>
        </div>
        <div id="nq-staff-container" style="background:#fff;border-radius:8px;padding:15px;margin-bottom:15px;box-shadow:0 4px 20px rgba(0,0,0,0.3);overflow-x:auto;width:100%;max-width:min(95vw,400px);display:flex;justify-content:center;">
            <div id="nq-staff"></div>
        </div>
        <div id="nq-prompt" style="font-size:clamp(1rem,3.5vw,1.2rem);margin-bottom:10px;text-align:center;min-height:1.5em;"></div>
        <div class="mc-buttons" id="nq-buttons"></div>
        <div id="nq-feedback" style="font-size:clamp(1rem,3.5vw,1.2rem);min-height:2rem;margin-top:10px;text-align:center;"></div>
        <div id="nq-response-time" style="font-size:clamp(0.7rem,2.4vw,0.8rem);color:#888;margin-top:5px;text-align:center;"></div>
        <div id="nq-stats" style="margin-top:20px;background:rgba(255,255,255,0.1);border-radius:8px;padding:12px 15px;width:100%;">
            <h2 style="font-size:clamp(0.85rem,3vw,1rem);font-weight:300;margin-bottom:10px;letter-spacing:1px;text-align:center;">QUIZ ACCURACY</h2>
            <div id="nq-stats-grid" style="display:grid;grid-template-columns:repeat(auto-fill,minmax(80px,1fr));gap:5px;max-width:500px;margin:0 auto;"></div>
        </div>
    </div>

    <script>
        (() => {
  // src/data/state.js
  var state = {
    showLabels: true,
    quizMode: "visual",
    allLevelsUnlocked: false,
    pianoLoaded: false,
    currentNote: null,
    currentInterval: null,
    firstAttempt: true,
    noteDisplayTime: null,
    isProcessingClick: false,
    currentKeySig: null,
    currentCofItem: null,
    currentCofAnswer: null,
    currentCofPrompt: "",
    notationProgress: null,
    currentChapterId: null,
    currentLessonPage: 0,
    currentQuizQuestion: null,
    nqFirstAttempt: true,
    nqDisplayTime: null,
    isNotationQuizActive: false
  };
  var state_default = state;

  // src/chapters/ch01-staff-and-clefs.js
  var { Factory } = Vex.Flow;
  var ch01_staff_and_clefs_default = {
    id: 1,
    title: "The Staff & Clefs",
    subtitle: "The foundation of written music",
    pages: [
      {
        title: "The Musical Staff",
        content: `<h3>The Musical Staff</h3>
<p>All written music lives on a <span class="highlight">staff</span> (or stave) \u2014 a set of <span class="highlight">5 horizontal lines</span> with <span class="highlight">4 spaces</span> between them.</p>
<p>Notes placed higher on the staff sound higher in pitch; notes placed lower sound lower. Think of it like a ladder for sound.</p>
<p>By itself the staff is just a grid \u2014 we need a <span class="highlight">clef</span> at the beginning to tell us which notes the lines and spaces represent.</p>
<div class="staff-example" id="ch1-ex1"></div>
<p>Above is an empty treble-clef staff. The curly symbol on the left is the clef.</p>`,
        render(container) {
          const el = container.querySelector("#ch1-ex1");
          if (!el) return;
          const factory = new Factory({ renderer: { elementId: el.id, width: 300, height: 120 } });
          const score = factory.EasyScore();
          const system = factory.System({ x: 0, y: 0, width: 260 });
          system.addStave({ voices: [score.voice(score.notes("B4/w/r", { clef: "treble" }))] }).addClef("treble");
          factory.draw();
        }
      },
      {
        title: "The Treble Clef",
        content: `<h3>The Treble Clef</h3>
<p>The <span class="highlight">treble clef</span> is also called the <span class="highlight">G clef</span> because its shape is actually a stylized letter G. The curl wraps around the second line of the staff, telling you that line is the note <span class="highlight">G</span>. That's how the clef got its name \u2014 it literally points to G.</p>
<p><strong>Line notes</strong> from bottom to top: <span class="highlight">E  G  B  D  F</span></p>
<p><span class="mnemonic">Remember: "Every Good Boy Does Fine"</span></p>
<p><strong>Space notes</strong> from bottom to top: <span class="highlight">F  A  C  E</span></p>
<p><span class="mnemonic">They spell the word FACE!</span></p>
<div class="staff-example" id="ch1-ex2"></div>
<p>Here are the four line notes E, G, B, and D on the treble staff.</p>`,
        render(container) {
          const el = container.querySelector("#ch1-ex2");
          if (!el) return;
          const factory = new Factory({ renderer: { elementId: el.id, width: 300, height: 120 } });
          const score = factory.EasyScore();
          const system = factory.System({ x: 0, y: 0, width: 260 });
          const voice = score.voice(score.notes("E4/q, G4/q, B4/q, D5/q", { clef: "treble" }), { time: "4/4" });
          system.addStave({ voices: [voice] }).addClef("treble");
          factory.draw();
        }
      },
      {
        title: "The Bass Clef",
        content: `<h3>The Bass Clef</h3>
<p>The <span class="highlight">bass clef</span> is also called the <span class="highlight">F clef</span> because its shape evolved from a stylized letter F. The two dots sit on either side of the fourth line, telling you that line is the note <span class="highlight">F</span>. Just like the treble clef points to G, the bass clef points to F \u2014 that's why it's the F clef.</p>
<p><strong>Line notes</strong> from bottom to top: <span class="highlight">G  B  D  F  A</span></p>
<p><span class="mnemonic">Remember: "Good Boys Do Fine Always"</span></p>
<p><strong>Space notes</strong> from bottom to top: <span class="highlight">A  C  E  G</span></p>
<p><span class="mnemonic">Remember: "All Cows Eat Grass"</span></p>
<div class="staff-example" id="ch1-ex3"></div>
<p>Here are the bass clef line notes G, B, D, and F.</p>`,
        render(container) {
          const el = container.querySelector("#ch1-ex3");
          if (!el) return;
          const factory = new Factory({ renderer: { elementId: el.id, width: 300, height: 120 } });
          const score = factory.EasyScore();
          const system = factory.System({ x: 0, y: 0, width: 260 });
          const voice = score.voice(score.notes("G2/q, B2/q, D3/q, F3/q", { clef: "bass" }), { time: "4/4" });
          system.addStave({ voices: [voice] }).addClef("bass");
          factory.draw();
        }
      },
      {
        title: "The Grand Staff & Ledger Lines",
        content: `<h3>The Grand Staff &amp; Ledger Lines</h3>
<p>Piano music uses both clefs at once, joined by a bracket. This is called the <span class="highlight">grand staff</span>. The treble staff sits on top and the bass staff below.</p>
<p><span class="highlight">Middle C</span> (C4) sits on a small <span class="highlight">ledger line</span> right between the two staves. Ledger lines are short lines that extend the staff when notes go above or below its five lines.</p>
<div class="staff-example" id="ch1-ex4"></div>
<p>Notice how Middle C appears on a ledger line below the treble staff and above the bass staff \u2014 it is the same note written two ways.</p>`,
        render(container) {
          const el = container.querySelector("#ch1-ex4");
          if (!el) return;
          const factory = new Factory({ renderer: { elementId: el.id, width: 300, height: 200 } });
          const score = factory.EasyScore();
          const system = factory.System({ x: 0, y: 0, width: 260 });
          const trebleVoice = score.voice(score.notes("C4/w", { clef: "treble" }));
          const bassVoice = score.voice(score.notes("C4/w", { clef: "bass" }));
          system.addStave({ voices: [trebleVoice] }).addClef("treble");
          system.addStave({ voices: [bassVoice] }).addClef("bass");
          system.addConnector("brace");
          system.addConnector("singleLeft");
          factory.draw();
        }
      }
    ],
    quizPool: [
      { id: "1-1", prompt: "How many lines does a musical staff have?", render: null, options: ["4", "5", "6", "3"], correctIndex: 1 },
      { id: "1-2", prompt: "How many spaces are between the lines of a staff?", render: null, options: ["3", "5", "4", "6"], correctIndex: 2 },
      { id: "1-3", prompt: "Which clef is shown?", render(el) {
        const f = new Factory({ renderer: { elementId: el.id, width: 200, height: 120 } });
        const s = f.EasyScore();
        f.System({ x: 0, y: 0, width: 160 }).addStave({ voices: [s.voice(s.notes("B4/w/r"))] }).addClef("treble");
        f.draw();
      }, options: ["Treble clef", "Bass clef", "Alto clef", "Tenor clef"], correctIndex: 0 },
      { id: "1-4", prompt: "Which clef is shown?", render(el) {
        const f = new Factory({ renderer: { elementId: el.id, width: 200, height: 120 } });
        const s = f.EasyScore();
        f.System({ x: 0, y: 0, width: 160 }).addStave({ voices: [s.voice(s.notes("D3/w/r", { clef: "bass" }))] }).addClef("bass");
        f.draw();
      }, options: ["Alto clef", "Treble clef", "Bass clef", "Tenor clef"], correctIndex: 2 },
      { id: "1-5", prompt: "The treble clef is also known as the:", render: null, options: ["F clef", "G clef", "C clef", "D clef"], correctIndex: 1 },
      { id: "1-6", prompt: "The bass clef is also known as the:", render: null, options: ["G clef", "C clef", "D clef", "F clef"], correctIndex: 3 },
      { id: "1-7", prompt: "What is a ledger line?", render: null, options: ["A short line extending the staff", "A vertical bar line", "A line connecting two staves", "A line showing tempo"], correctIndex: 0 },
      { id: "1-8", prompt: "The grand staff combines:", render: null, options: ["Two treble clefs", "Treble and bass clefs", "Two bass clefs", "Treble and alto clefs"], correctIndex: 1 },
      { id: "1-9", prompt: "Where does Middle C sit on the grand staff?", render: null, options: ["Top of treble staff", "On a ledger line between the staves", "Bottom of bass staff", "Third line of treble staff"], correctIndex: 1 },
      { id: "1-10", prompt: "Higher position on the staff means:", render: null, options: ["Lower pitch", "Louder sound", "Higher pitch", "Faster tempo"], correctIndex: 2 }
    ]
  };

  // src/chapters/ch02-notes-on-staff.js
  var { Factory: Factory2 } = Vex.Flow;
  var ch02_notes_on_staff_default = {
    id: 2,
    title: "Notes on the Staff",
    subtitle: "How pitch is represented",
    pages: [
      {
        title: "Notes Live on Lines and Spaces",
        content: `<h3>Notes Live on Lines and Spaces</h3>
<p>Every note sits either <span class="highlight">on a line</span> or <span class="highlight">in a space</span>. Moving up one position (line to space, or space to line) moves one letter name forward in the musical alphabet.</p>
<p>The musical alphabet uses only seven letters: <span class="highlight">A B C D E F G</span>, then repeats. After G comes A again.</p>
<p>As notes move up the staff, the pitch gets higher.</p>
<div class="staff-example" id="ch2-ex1"></div>
<p>Here is a C major scale \u2014 C D E F G A B C \u2014 climbing from Middle C up to the next C.</p>`,
        render(container) {
          const el = container.querySelector("#ch2-ex1");
          if (!el) return;
          const factory = new Factory2({ renderer: { elementId: el.id, width: 340, height: 120 } });
          const score = factory.EasyScore();
          const system = factory.System({ x: 0, y: 0, width: 300 });
          const voice = score.voice(score.notes("C4/q, D4/q, E4/q, F4/q, G4/q, A4/q, B4/q, C5/q", { clef: "treble" }), { time: "8/4" });
          system.addStave({ voices: [voice] }).addClef("treble");
          factory.draw();
        }
      },
      {
        title: "Treble Clef Notes",
        content: `<h3>Treble Clef Notes</h3>
<p>Let's lock in the treble clef notes you'll see most often.</p>
<p><strong>Lines</strong> (bottom to top): <span class="highlight">E  G  B  D  F</span></p>
<p><span class="mnemonic">"Every Good Boy Does Fine"</span></p>
<p><strong>Spaces</strong> (bottom to top): <span class="highlight">F  A  C  E</span></p>
<p><span class="mnemonic">They spell FACE</span></p>
<div class="staff-example" id="ch2-ex2"></div>
<p>Above are the five line notes. Notice how each one sits directly <em>on</em> a line.</p>`,
        render(container) {
          const el = container.querySelector("#ch2-ex2");
          if (!el) return;
          const factory = new Factory2({ renderer: { elementId: el.id, width: 340, height: 120 } });
          const score = factory.EasyScore();
          const system = factory.System({ x: 0, y: 0, width: 300 });
          const voice = score.voice(score.notes("E4/h, G4/h, B4/h, D5/h, F5/h", { clef: "treble" }), { time: "10/4" });
          system.addStave({ voices: [voice] }).addClef("treble");
          factory.draw();
        }
      },
      {
        title: "Bass Clef Notes",
        content: `<h3>Bass Clef Notes</h3>
<p>The bass clef has its own set of line and space notes.</p>
<p><strong>Lines</strong> (bottom to top): <span class="highlight">G  B  D  F  A</span></p>
<p><span class="mnemonic">"Good Boys Do Fine Always"</span></p>
<p><strong>Spaces</strong> (bottom to top): <span class="highlight">A  C  E  G</span></p>
<p><span class="mnemonic">"All Cows Eat Grass"</span></p>
<div class="staff-example" id="ch2-ex3"></div>
<p>Here are the five bass clef line notes. They are different from the treble clef lines \u2014 don't mix them up!</p>`,
        render(container) {
          const el = container.querySelector("#ch2-ex3");
          if (!el) return;
          const factory = new Factory2({ renderer: { elementId: el.id, width: 340, height: 120 } });
          const score = factory.EasyScore();
          const system = factory.System({ x: 0, y: 0, width: 300 });
          const voice = score.voice(score.notes("G2/h, B2/h, D3/h, F3/h, A3/h", { clef: "bass" }), { time: "10/4" });
          system.addStave({ voices: [voice] }).addClef("bass");
          factory.draw();
        }
      },
      {
        title: "Octaves and Middle C",
        content: `<h3>Octaves and Middle C</h3>
<p>Since the alphabet repeats (A-G over and over), we use <span class="highlight">octave numbers</span> to tell notes apart. C4 is one octave higher than C3, and one octave lower than C5.</p>
<p><span class="highlight">Middle C (C4)</span> is the most important landmark. On the piano, it is near the center of the keyboard. On the grand staff, it sits on a ledger line between the two staves.</p>
<div class="staff-example" id="ch2-ex4"></div>
<p>Middle C written in both clefs. In the treble clef it hangs just below the staff; in the bass clef it sits just above.</p>`,
        render(container) {
          const el = container.querySelector("#ch2-ex4");
          if (!el) return;
          const factory = new Factory2({ renderer: { elementId: el.id, width: 300, height: 200 } });
          const score = factory.EasyScore();
          const system = factory.System({ x: 0, y: 0, width: 260 });
          system.addStave({ voices: [score.voice(score.notes("C4/w", { clef: "treble" }))] }).addClef("treble");
          system.addStave({ voices: [score.voice(score.notes("C4/w", { clef: "bass" }))] }).addClef("bass");
          system.addConnector("brace");
          system.addConnector("singleLeft");
          factory.draw();
        }
      }
    ],
    quizPool: [
      { id: "2-1", prompt: "What note is this?", render(el) {
        const f = new Factory2({ renderer: { elementId: el.id, width: 200, height: 120 } });
        const s = f.EasyScore();
        f.System({ x: 0, y: 0, width: 160 }).addStave({ voices: [s.voice(s.notes("E4/w"))] }).addClef("treble");
        f.draw();
      }, options: ["E", "F", "D", "G"], correctIndex: 0 },
      { id: "2-2", prompt: "What note is this?", render(el) {
        const f = new Factory2({ renderer: { elementId: el.id, width: 200, height: 120 } });
        const s = f.EasyScore();
        f.System({ x: 0, y: 0, width: 160 }).addStave({ voices: [s.voice(s.notes("A4/w"))] }).addClef("treble");
        f.draw();
      }, options: ["G", "B", "A", "C"], correctIndex: 2 },
      { id: "2-3", prompt: "What note is this?", render(el) {
        const f = new Factory2({ renderer: { elementId: el.id, width: 200, height: 120 } });
        const s = f.EasyScore();
        f.System({ x: 0, y: 0, width: 160 }).addStave({ voices: [s.voice(s.notes("F4/w"))] }).addClef("treble");
        f.draw();
      }, options: ["E", "G", "D", "F"], correctIndex: 3 },
      { id: "2-4", prompt: "What note is this?", render(el) {
        const f = new Factory2({ renderer: { elementId: el.id, width: 200, height: 120 } });
        const s = f.EasyScore();
        f.System({ x: 0, y: 0, width: 160 }).addStave({ voices: [s.voice(s.notes("B2/w", { clef: "bass" }))] }).addClef("bass");
        f.draw();
      }, options: ["A", "C", "B", "D"], correctIndex: 2 },
      { id: "2-5", prompt: "What note is this?", render(el) {
        const f = new Factory2({ renderer: { elementId: el.id, width: 200, height: 120 } });
        const s = f.EasyScore();
        f.System({ x: 0, y: 0, width: 160 }).addStave({ voices: [s.voice(s.notes("D3/w", { clef: "bass" }))] }).addClef("bass");
        f.draw();
      }, options: ["C", "E", "D", "F"], correctIndex: 2 },
      { id: "2-6", prompt: "Treble clef line notes from bottom: E, G, B, D, ___", render: null, options: ["A", "F", "C", "E"], correctIndex: 1 },
      { id: "2-7", prompt: "Treble clef space notes spell:", render: null, options: ["FADE", "FACE", "CAGE", "CAFE"], correctIndex: 1 },
      { id: "2-8", prompt: "Bass clef line notes from bottom: G, B, D, F, ___", render: null, options: ["A", "G", "E", "C"], correctIndex: 0 },
      { id: "2-9", prompt: "Bass clef space notes from bottom: A, C, E, ___", render: null, options: ["F", "B", "G", "D"], correctIndex: 2 },
      { id: "2-10", prompt: "Middle C is also known as:", render: null, options: ["C3", "C5", "C4", "C2"], correctIndex: 2 }
    ]
  };

  // src/chapters/ch03-note-values.js
  var { Factory: Factory3 } = Vex.Flow;
  var ch03_note_values_default = {
    id: 3,
    title: "Note Values",
    subtitle: "How long notes last",
    pages: [
      {
        title: "Notes Have Duration",
        content: `<h3>Notes Have Duration</h3>
<p>A note on the staff tells you two things: <span class="highlight">which pitch</span> to play (its position) and <span class="highlight">how long</span> to hold it (its shape).</p>
<p>Here are the most common note values, measured in beats (in 4/4 time):</p>
<p><span class="highlight">Whole note</span> \u2014 4 beats (open oval, no stem)</p>
<p><span class="highlight">Half note</span> \u2014 2 beats (open oval with stem)</p>
<p><span class="highlight">Quarter note</span> \u2014 1 beat (filled oval with stem)</p>
<p><span class="highlight">Eighth note</span> \u2014 1/2 beat (filled oval, stem, flag)</p>
<p><span class="highlight">Sixteenth note</span> \u2014 1/4 beat (filled oval, stem, double flag)</p>
<p>Each value is exactly <strong>half</strong> the duration of the one above it.</p>`,
        render: null
      },
      {
        title: "Whole and Half Notes",
        content: `<h3>Whole and Half Notes</h3>
<p>The <span class="highlight">whole note</span> is an open (hollow) oval with no stem. It lasts <span class="highlight">4 beats</span> \u2014 a full measure in 4/4 time.</p>
<div class="staff-example" id="ch3-ex1"></div>
<p>The <span class="highlight">half note</span> looks similar but adds a stem. It lasts <span class="highlight">2 beats</span>, so two half notes fill one measure.</p>
<div class="staff-example" id="ch3-ex2"></div>
<p><span class="mnemonic">Tip: "whole" = whole measure, "half" = half a measure.</span></p>`,
        render(container) {
          let el = container.querySelector("#ch3-ex1");
          if (el) {
            const f = new Factory3({ renderer: { elementId: el.id, width: 300, height: 120 } });
            const s = f.EasyScore();
            f.System({ x: 0, y: 0, width: 260 }).addStave({ voices: [s.voice(s.notes("C4/w"))] }).addClef("treble");
            f.draw();
          }
          el = container.querySelector("#ch3-ex2");
          if (el) {
            const f = new Factory3({ renderer: { elementId: el.id, width: 300, height: 120 } });
            const s = f.EasyScore();
            f.System({ x: 0, y: 0, width: 260 }).addStave({ voices: [s.voice(s.notes("C4/h, E4/h"), { time: "4/4" })] }).addClef("treble");
            f.draw();
          }
        }
      },
      {
        title: "Quarter and Eighth Notes",
        content: `<h3>Quarter and Eighth Notes</h3>
<p>The <span class="highlight">quarter note</span> has a filled (solid) oval and a stem. It gets <span class="highlight">1 beat</span>. Four quarter notes fill a 4/4 measure.</p>
<div class="staff-example" id="ch3-ex3"></div>
<p>The <span class="highlight">eighth note</span> adds a flag (or beam when grouped) to the stem. It gets <span class="highlight">half a beat</span>, so two eighths equal one quarter.</p>
<div class="staff-example" id="ch3-ex4"></div>
<p><span class="mnemonic">Look for the flag! More flags = shorter note.</span></p>`,
        render(container) {
          let el = container.querySelector("#ch3-ex3");
          if (el) {
            const f = new Factory3({ renderer: { elementId: el.id, width: 300, height: 120 } });
            const s = f.EasyScore();
            f.System({ x: 0, y: 0, width: 260 }).addStave({ voices: [s.voice(s.notes("C4/q, D4/q, E4/q, F4/q"))] }).addClef("treble");
            f.draw();
          }
          el = container.querySelector("#ch3-ex4");
          if (el) {
            const f = new Factory3({ renderer: { elementId: el.id, width: 300, height: 120 } });
            const s = f.EasyScore();
            f.System({ x: 0, y: 0, width: 260 }).addStave({ voices: [s.voice(s.notes("C4/8, D4/8, E4/8, F4/8, G4/8, A4/8, B4/8, C5/8"), { time: "4/4" })] }).addClef("treble");
            f.draw();
          }
        }
      },
      {
        title: "The Duration Tree",
        content: `<h3>The Duration Tree</h3>
<p>Note values form a neat hierarchy \u2014 each one is <span class="highlight">half the length</span> of the one above:</p>
<p>1 whole = 2 halves = 4 quarters = 8 eighths = 16 sixteenths</p>
<p><strong>Dotted notes:</strong> A <span class="highlight">dot</span> after a note adds half its value. A dotted half note = 2 + 1 = <span class="highlight">3 beats</span>. A dotted quarter = 1 + 0.5 = 1.5 beats.</p>
<p><strong>Ties:</strong> A curved line connecting two notes of the same pitch <span class="highlight">adds their durations together</span>. A half note tied to a quarter note = 3 beats (same result as a dotted half).</p>
<p><span class="mnemonic">Dots add half, ties add everything.</span></p>`,
        render: null
      }
    ],
    quizPool: [
      { id: "3-1", prompt: "What type of note is this?", render(el) {
        const f = new Factory3({ renderer: { elementId: el.id, width: 200, height: 120 } });
        const s = f.EasyScore();
        f.System({ x: 0, y: 0, width: 160 }).addStave({ voices: [s.voice(s.notes("C4/w"))] }).addClef("treble");
        f.draw();
      }, options: ["Whole note", "Half note", "Quarter note", "Eighth note"], correctIndex: 0 },
      { id: "3-2", prompt: "What type of note is this?", render(el) {
        const f = new Factory3({ renderer: { elementId: el.id, width: 200, height: 120 } });
        const s = f.EasyScore();
        f.System({ x: 0, y: 0, width: 160 }).addStave({ voices: [s.voice(s.notes("C4/h, B4/h/r"), { time: "4/4" })] }).addClef("treble");
        f.draw();
      }, options: ["Quarter note", "Whole note", "Half note", "Eighth note"], correctIndex: 2 },
      { id: "3-3", prompt: "What type of note is this?", render(el) {
        const f = new Factory3({ renderer: { elementId: el.id, width: 200, height: 120 } });
        const s = f.EasyScore();
        f.System({ x: 0, y: 0, width: 160 }).addStave({ voices: [s.voice(s.notes("C4/q, B4/q/r, B4/q/r, B4/q/r"))] }).addClef("treble");
        f.draw();
      }, options: ["Half note", "Eighth note", "Quarter note", "Sixteenth note"], correctIndex: 2 },
      { id: "3-4", prompt: "How many beats does a whole note get in 4/4 time?", render: null, options: ["1", "2", "3", "4"], correctIndex: 3 },
      { id: "3-5", prompt: "How many beats does a half note get?", render: null, options: ["4", "1", "2", "1/2"], correctIndex: 2 },
      { id: "3-6", prompt: "How many beats does a quarter note get?", render: null, options: ["2", "1", "1/2", "4"], correctIndex: 1 },
      { id: "3-7", prompt: "How many quarter notes equal one whole note?", render: null, options: ["2", "8", "3", "4"], correctIndex: 3 },
      { id: "3-8", prompt: "How many eighth notes equal one quarter note?", render: null, options: ["4", "2", "1", "8"], correctIndex: 1 },
      { id: "3-9", prompt: "A dotted half note gets how many beats?", render: null, options: ["2", "3", "4", "2.5"], correctIndex: 1 },
      { id: "3-10", prompt: "What does a tie do?", render: null, options: ["Raises pitch by half step", "Combines duration of two notes", "Separates measures", "Indicates silence"], correctIndex: 1 }
    ]
  };

  // src/chapters/ch04-rests.js
  var { Factory: Factory4 } = Vex.Flow;
  var ch04_rests_default = {
    id: 4,
    title: "Rests",
    subtitle: "The sound of silence",
    pages: [
      {
        title: "Silence Has Notation Too",
        content: `<h3>Silence Has Notation Too</h3>
<p>Music isn't just about sound \u2014 the silences between notes are just as important. <span class="highlight">Rests</span> tell you when <em>not</em> to play.</p>
<p>Every note value has a matching rest of equal duration:</p>
<p><span class="highlight">Whole rest</span> \u2014 4 beats of silence</p>
<p><span class="highlight">Half rest</span> \u2014 2 beats of silence</p>
<p><span class="highlight">Quarter rest</span> \u2014 1 beat of silence</p>
<p><span class="highlight">Eighth rest</span> \u2014 1/2 beat of silence</p>
<p><span class="highlight">Sixteenth rest</span> \u2014 1/4 beat of silence</p>
<p>Rests follow the same duration tree as notes \u2014 each is half the value of the one above.</p>`,
        render: null
      },
      {
        title: "Whole and Half Rests",
        content: `<h3>Whole and Half Rests</h3>
<p>These two look similar \u2014 both are small rectangles \u2014 but their position tells them apart:</p>
<p>The <span class="highlight">whole rest</span> hangs <em>down</em> from the fourth line (like a hole in the ground).</p>
<p>The <span class="highlight">half rest</span> sits <em>up</em> on the third line (like a hat on a head).</p>
<p><span class="mnemonic">Remember: the Whole rest hangs like it fell in a Hole. The Half rest sits up like a Hat.</span></p>
<div class="staff-example" id="ch4-ex1"></div>
<p>Above: two half rests filling one measure. Each represents 2 beats of silence.</p>`,
        render(container) {
          const el = container.querySelector("#ch4-ex1");
          if (el) {
            const f = new Factory4({ renderer: { elementId: el.id, width: 300, height: 120 } });
            const s = f.EasyScore();
            f.System({ x: 0, y: 0, width: 260 }).addStave({ voices: [s.voice(s.notes("B4/h/r, B4/h/r"), { time: "4/4" })] }).addClef("treble");
            f.draw();
          }
        }
      },
      {
        title: "Quarter, Eighth, and Sixteenth Rests",
        content: `<h3>Quarter, Eighth, and Sixteenth Rests</h3>
<p>The <span class="highlight">quarter rest</span> looks like a zigzag or lightning bolt. It gets 1 beat of silence.</p>
<p>The <span class="highlight">eighth rest</span> resembles the number 7 with a dot. It gets half a beat.</p>
<p>The <span class="highlight">sixteenth rest</span> has two flags and gets a quarter of a beat.</p>
<div class="staff-example" id="ch4-ex2"></div>
<p>Above: a quarter rest, an eighth rest, and a sixteenth rest side by side. Notice how each shorter rest has more flags.</p>
<div class="staff-example" id="ch4-ex2b"></div>
<p>Above: a mix of quarter notes and quarter rests in action \u2014 play, rest, play, rest.</p>
<p><span class="mnemonic">More flags on a rest = shorter silence, just like notes.</span></p>`,
        render(container) {
          const el = container.querySelector("#ch4-ex2");
          if (el) {
            const f = new Factory4({ renderer: { elementId: el.id, width: 300, height: 120 } });
            const s = f.EasyScore();
            f.System({ x: 0, y: 0, width: 260 }).addStave({ voices: [s.voice(s.notes("B4/q/r, B4/8/r, B4/16/r, B4/16/r, B4/h/r"))] }).addClef("treble");
            f.draw();
          }
          const el2 = container.querySelector("#ch4-ex2b");
          if (el2) {
            const f = new Factory4({ renderer: { elementId: el2.id, width: 300, height: 120 } });
            const s = f.EasyScore();
            f.System({ x: 0, y: 0, width: 260 }).addStave({ voices: [s.voice(s.notes("C4/q, B4/q/r, E4/q, B4/q/r"))] }).addClef("treble");
            f.draw();
          }
        }
      }
    ],
    quizPool: [
      { id: "4-1", prompt: "What type of rest is shown? (It hangs from a line)", render(el) {
        const f = new Factory4({ renderer: { elementId: el.id, width: 200, height: 120 } });
        const s = f.EasyScore();
        f.System({ x: 0, y: 0, width: 160 }).addStave({ voices: [s.voice(s.notes("B4/w/r"))] }).addClef("treble");
        f.draw();
      }, options: ["Half rest", "Whole rest", "Quarter rest", "Eighth rest"], correctIndex: 1 },
      { id: "4-2", prompt: "How many beats of silence does a whole rest get in 4/4?", render: null, options: ["1", "2", "3", "4"], correctIndex: 3 },
      { id: "4-3", prompt: "How many beats does a half rest get?", render: null, options: ["1", "4", "2", "1/2"], correctIndex: 2 },
      { id: "4-4", prompt: "How many beats does a quarter rest get?", render: null, options: ["2", "4", "1/2", "1"], correctIndex: 3 },
      { id: "4-5", prompt: "The whole rest hangs DOWN, the half rest sits UP. True or false?", render: null, options: ["True", "False"], correctIndex: 0 },
      { id: "4-6", prompt: "How many beats does an eighth rest get?", render: null, options: ["1", "1/4", "2", "1/2"], correctIndex: 3 },
      { id: "4-7", prompt: "A rest tells you to:", render: null, options: ["Play louder", "Be silent", "Play faster", "Repeat a note"], correctIndex: 1 },
      { id: "4-8", prompt: "Which rest looks like a zigzag or lightning bolt?", render: null, options: ["Whole rest", "Half rest", "Quarter rest", "Eighth rest"], correctIndex: 2 },
      { id: "4-9", prompt: "How many eighth rests equal one quarter rest?", render: null, options: ["4", "1", "2", "8"], correctIndex: 2 },
      { id: "4-10", prompt: "Every note value has a corresponding:", render: null, options: ["Clef", "Rest of equal duration", "Key signature", "Time signature"], correctIndex: 1 }
    ]
  };

  // src/chapters/ch05-time-signatures.js
  var { Factory: Factory5 } = Vex.Flow;
  var ch05_time_signatures_default = {
    id: 5,
    title: "Time Signatures",
    subtitle: "Organizing beats into measures",
    pages: [
      {
        title: "What Is a Time Signature?",
        content: `<h3>What Is a Time Signature?</h3>
<p>At the start of every piece you'll see two numbers stacked on the staff. This is the <span class="highlight">time signature</span>.</p>
<p>The <span class="highlight">top number</span> tells you how many beats are in each measure.</p>
<p>The <span class="highlight">bottom number</span> tells you which note value gets one beat (4 = quarter note, 8 = eighth note).</p>
<p>Vertical lines called <span class="highlight">bar lines</span> divide the staff into measures. Each measure must contain exactly the number of beats the time signature specifies.</p>
<div class="staff-example" id="ch5-ex1"></div>
<p>Above: 4/4 time \u2014 four quarter-note beats per measure. This is the most common time signature.</p>`,
        render(container) {
          const el = container.querySelector("#ch5-ex1");
          if (el) {
            const f = new Factory5({ renderer: { elementId: el.id, width: 300, height: 120 } });
            const s = f.EasyScore();
            f.System({ x: 0, y: 0, width: 260 }).addStave({ voices: [s.voice(s.notes("C4/q, D4/q, E4/q, F4/q"))] }).addClef("treble").addTimeSignature("4/4");
            f.draw();
          }
        }
      },
      {
        title: "Common Time Signatures",
        content: `<h3>Common Time Signatures</h3>
<p><span class="highlight">4/4</span> \u2014 Four quarter-note beats. Called "common time." Used in most pop, rock, and classical music.</p>
<p><span class="highlight">3/4</span> \u2014 Three quarter-note beats. The feel of a <span class="highlight">waltz</span>: ONE-two-three, ONE-two-three.</p>
<p><span class="highlight">2/4</span> \u2014 Two quarter-note beats. Often used in marches: LEFT-right, LEFT-right.</p>
<div class="staff-example" id="ch5-ex2"></div>
<p>Above: 4/4 \u2014 four quarter notes per measure.</p>
<div class="staff-example" id="ch5-ex3"></div>
<p>Above: 3/4 \u2014 three quarter notes per measure (waltz feel).</p>`,
        render(container) {
          let el = container.querySelector("#ch5-ex2");
          if (el) {
            const f = new Factory5({ renderer: { elementId: el.id, width: 300, height: 120 } });
            const s = f.EasyScore();
            f.System({ x: 0, y: 0, width: 260 }).addStave({ voices: [s.voice(s.notes("C4/q, E4/q, G4/q, C5/q"))] }).addClef("treble").addTimeSignature("4/4");
            f.draw();
          }
          el = container.querySelector("#ch5-ex3");
          if (el) {
            const f = new Factory5({ renderer: { elementId: el.id, width: 300, height: 120 } });
            const s = f.EasyScore();
            f.System({ x: 0, y: 0, width: 260 }).addStave({ voices: [s.voice(s.notes("C4/q, E4/q, G4/q"), { time: "3/4" })] }).addClef("treble").addTimeSignature("3/4");
            f.draw();
          }
        }
      },
      {
        title: "Compound Time: 6/8",
        content: `<h3>Compound Time: 6/8</h3>
<p><span class="highlight">6/8 time</span> has six eighth-note beats per measure, but they are felt as <span class="highlight">two groups of three</span>.</p>
<p>This gives the music a swinging, lilting feel \u2014 think of "Row, Row, Row Your Boat" or an Irish jig.</p>
<p>How is 6/8 different from 3/4? Both have six eighth notes per measure, but 3/4 groups them as <strong>three groups of two</strong>, while 6/8 groups them as <strong>two groups of three</strong>. The emphasis pattern is different.</p>
<div class="staff-example" id="ch5-ex4"></div>
<p>Above: 6/8 time \u2014 six eighth notes grouped in two sets of three.</p>`,
        render(container) {
          const el = container.querySelector("#ch5-ex4");
          if (el) {
            const f = new Factory5({ renderer: { elementId: el.id, width: 340, height: 120 } });
            const s = f.EasyScore();
            f.System({ x: 0, y: 0, width: 300 }).addStave({ voices: [s.voice(s.notes("C4/8, D4/8, E4/8, F4/8, G4/8, A4/8"), { time: "6/8" })] }).addClef("treble").addTimeSignature("6/8");
            f.draw();
          }
        }
      }
    ],
    quizPool: [
      { id: "5-1", prompt: "What time signature is shown?", render(el) {
        const f = new Factory5({ renderer: { elementId: el.id, width: 200, height: 120 } });
        const s = f.EasyScore();
        f.System({ x: 0, y: 0, width: 160 }).addStave({ voices: [s.voice(s.notes("B4/w/r"))] }).addClef("treble").addTimeSignature("4/4");
        f.draw();
      }, options: ["3/4", "4/4", "2/4", "6/8"], correctIndex: 1 },
      { id: "5-2", prompt: "What time signature is shown?", render(el) {
        const f = new Factory5({ renderer: { elementId: el.id, width: 200, height: 120 } });
        const s = f.EasyScore();
        f.System({ x: 0, y: 0, width: 160 }).addStave({ voices: [s.voice(s.notes("B4/h/r, B4/q/r"), { time: "3/4" })] }).addClef("treble").addTimeSignature("3/4");
        f.draw();
      }, options: ["4/4", "6/8", "2/4", "3/4"], correctIndex: 3 },
      { id: "5-3", prompt: "What time signature is shown?", render(el) {
        const f = new Factory5({ renderer: { elementId: el.id, width: 200, height: 120 } });
        const s = f.EasyScore();
        f.System({ x: 0, y: 0, width: 160 }).addStave({ voices: [s.voice(s.notes("B4/h/r"), { time: "2/4" })] }).addClef("treble").addTimeSignature("2/4");
        f.draw();
      }, options: ["3/4", "4/4", "2/4", "6/8"], correctIndex: 2 },
      { id: "5-4", prompt: "In 4/4 time, how many beats are in each measure?", render: null, options: ["2", "3", "4", "6"], correctIndex: 2 },
      { id: "5-5", prompt: "In 3/4 time, how many beats are in each measure?", render: null, options: ["2", "3", "4", "6"], correctIndex: 1 },
      { id: "5-6", prompt: "The top number in a time signature tells you:", render: null, options: ["Tempo", "Key", "Beats per measure", "Note value"], correctIndex: 2 },
      { id: "5-7", prompt: "The bottom number 4 means which note gets one beat?", render: null, options: ["Whole note", "Half note", "Quarter note", "Eighth note"], correctIndex: 2 },
      { id: "5-8", prompt: "3/4 time is commonly associated with:", render: null, options: ["March", "Waltz", "Rock music", "Jazz"], correctIndex: 1 },
      { id: "5-9", prompt: "In 6/8 time, beats are typically grouped as:", render: null, options: ["6 groups of 1", "3 groups of 2", "2 groups of 3", "1 group of 6"], correctIndex: 2 },
      { id: "5-10", prompt: "A measure is the space between two:", render: null, options: ["Clefs", "Rests", "Bar lines", "Key signatures"], correctIndex: 2 }
    ]
  };

  // src/chapters/ch06-key-signatures-and-accidentals.js
  var { Factory: Factory6 } = Vex.Flow;
  var ch06_key_signatures_and_accidentals_default = {
    id: 6,
    title: "Key Signatures & Accidentals",
    subtitle: "Sharps, flats, and naturals",
    pages: [
      {
        title: "Accidentals: Sharps, Flats, and Naturals",
        content: `<h3>Accidentals: Sharps, Flats, and Naturals</h3>
<p>Not every note is a plain A, B, C, etc. Small symbols called <span class="highlight">accidentals</span> modify a note's pitch by a half step:</p>
<p><span class="highlight">Sharp (#)</span> \u2014 raises the note by one half step.</p>
<p><span class="highlight">Flat (b)</span> \u2014 lowers the note by one half step.</p>
<p><span class="highlight">Natural</span> \u2014 cancels a previous sharp or flat, returning to the unmodified pitch.</p>
<p>On the piano, a half step is the distance from any key to the very next key (including black keys).</p>
<div class="staff-example" id="ch6-ex1"></div>
<p>Above: C, C-sharp, D, D-flat. Notice C# and Db are the same piano key \u2014 different names for the same sound.</p>`,
        render(container) {
          const el = container.querySelector("#ch6-ex1");
          if (el) {
            const f = new Factory6({ renderer: { elementId: el.id, width: 300, height: 120 } });
            const s = f.EasyScore();
            f.System({ x: 0, y: 0, width: 260 }).addStave({ voices: [s.voice(s.notes("C4/q, C#4/q, D4/q, Db4/q"))] }).addClef("treble");
            f.draw();
          }
        }
      },
      {
        title: "What Is a Key Signature?",
        content: `<h3>What Is a Key Signature?</h3>
<p>If a piece uses certain sharps or flats throughout, writing them on every note would be tedious. Instead, we place them once at the beginning of each line \u2014 this is the <span class="highlight">key signature</span>.</p>
<p>A key signature tells you: "Every time you see this note, play it sharp (or flat) unless a natural sign says otherwise."</p>
<p>For example, <span class="highlight">G Major</span> has one sharp \u2014 F#. Instead of marking every F with a sharp, the key signature places one sharp on the F line.</p>
<div class="staff-example" id="ch6-ex2"></div>
<p>Above: G major key signature (one sharp: F#), followed by a simple melody.</p>`,
        render(container) {
          const el = container.querySelector("#ch6-ex2");
          if (el) {
            const f = new Factory6({ renderer: { elementId: el.id, width: 300, height: 120 } });
            const s = f.EasyScore();
            f.System({ x: 0, y: 0, width: 260 }).addStave({ voices: [s.voice(s.notes("G4/q, A4/q, B4/q, G4/q"))] }).addClef("treble").addKeySignature("G");
            f.draw();
          }
        }
      },
      {
        title: "The Order of Sharps and Flats",
        content: `<h3>The Order of Sharps and Flats</h3>
<p>Sharps and flats always appear in a fixed order:</p>
<p><span class="highlight">Sharps:</span> F C G D A E B</p>
<p><span class="mnemonic">"Father Charles Goes Down And Ends Battle"</span></p>
<p><span class="highlight">Flats:</span> B E A D G C F (the reverse!)</p>
<p><span class="mnemonic">"Battle Ends And Down Goes Charles' Father"</span></p>
<p>If a key has 2 sharps, they will always be F# and C#. If it has 3 flats, they are always Bb, Eb, and Ab.</p>
<div class="staff-example" id="ch6-ex3"></div>
<p>Above: D major \u2014 two sharps (F# and C#).</p>`,
        render(container) {
          const el = container.querySelector("#ch6-ex3");
          if (el) {
            const f = new Factory6({ renderer: { elementId: el.id, width: 300, height: 120 } });
            const s = f.EasyScore();
            f.System({ x: 0, y: 0, width: 260 }).addStave({ voices: [s.voice(s.notes("D4/h, A4/h"), { time: "4/4" })] }).addClef("treble").addKeySignature("D");
            f.draw();
          }
        }
      },
      {
        title: "Identifying Key Signatures",
        content: `<h3>Identifying Key Signatures</h3>
<p>Quick tricks to name a major key from its signature:</p>
<p><strong>Sharp keys:</strong> Look at the <span class="highlight">last sharp</span> and go up one half step \u2014 that's your key. Example: last sharp is C# \u2192 key is D major.</p>
<p><strong>Flat keys:</strong> Look at the <span class="highlight">second-to-last flat</span> \u2014 that's your key. Example: flats are Bb, Eb, Ab \u2192 second-to-last is Eb \u2192 key is Eb major.</p>
<p><strong>Special cases:</strong> C major has no sharps or flats. F major has just one flat (Bb) \u2014 the "second-to-last" trick doesn't apply, so just memorize it.</p>
<div class="staff-example" id="ch6-ex4"></div>
<p>Above: Eb major \u2014 three flats (Bb, Eb, Ab). The second-to-last flat is Eb, confirming the key.</p>`,
        render(container) {
          const el = container.querySelector("#ch6-ex4");
          if (el) {
            const f = new Factory6({ renderer: { elementId: el.id, width: 300, height: 120 } });
            const s = f.EasyScore();
            f.System({ x: 0, y: 0, width: 260 }).addStave({ voices: [s.voice(s.notes("Eb4/h, Bb4/h"), { time: "4/4" })] }).addClef("treble").addKeySignature("Eb");
            f.draw();
          }
        }
      }
    ],
    quizPool: [
      { id: "6-1", prompt: "What does a sharp (#) do to a note?", render: null, options: ["Lowers by half step", "Raises by half step", "Doubles duration", "Cancels a flat"], correctIndex: 1 },
      { id: "6-2", prompt: "What does a flat (b) do to a note?", render: null, options: ["Raises by half step", "Cancels a sharp", "Lowers by half step", "Halves duration"], correctIndex: 2 },
      { id: "6-3", prompt: "What does a natural sign do?", render: null, options: ["Raises by half step", "Lowers by half step", "Cancels a sharp or flat", "Doubles the note"], correctIndex: 2 },
      { id: "6-4", prompt: "What key signature is shown?", render(el) {
        const f = new Factory6({ renderer: { elementId: el.id, width: 200, height: 120 } });
        const s = f.EasyScore();
        f.System({ x: 0, y: 0, width: 160 }).addStave({ voices: [s.voice(s.notes("B4/w/r"))] }).addClef("treble").addKeySignature("G");
        f.draw();
      }, options: ["C Major", "D Major", "G Major", "F Major"], correctIndex: 2 },
      { id: "6-5", prompt: "What key signature is shown?", render(el) {
        const f = new Factory6({ renderer: { elementId: el.id, width: 200, height: 120 } });
        const s = f.EasyScore();
        f.System({ x: 0, y: 0, width: 160 }).addStave({ voices: [s.voice(s.notes("B4/w/r"))] }).addClef("treble").addKeySignature("F");
        f.draw();
      }, options: ["G Major", "C Major", "Bb Major", "F Major"], correctIndex: 3 },
      { id: "6-6", prompt: "The order of sharps begins with:", render: null, options: ["C#", "G#", "F#", "B#"], correctIndex: 2 },
      { id: "6-7", prompt: "The order of flats begins with:", render: null, options: ["Eb", "Ab", "Bb", "Db"], correctIndex: 2 },
      { id: "6-8", prompt: "C Major has how many sharps or flats?", render: null, options: ["1 sharp", "1 flat", "None", "2 sharps"], correctIndex: 2 },
      { id: "6-9", prompt: "For sharp keys, the key name is one half step above:", render: null, options: ["The first sharp", "The last sharp", "Middle C", "The clef"], correctIndex: 1 },
      { id: "6-10", prompt: "What key signature is shown?", render(el) {
        const f = new Factory6({ renderer: { elementId: el.id, width: 200, height: 120 } });
        const s = f.EasyScore();
        f.System({ x: 0, y: 0, width: 160 }).addStave({ voices: [s.voice(s.notes("B4/w/r"))] }).addClef("treble").addKeySignature("D");
        f.draw();
      }, options: ["A Major", "G Major", "D Major", "E Major"], correctIndex: 2 }
    ]
  };

  // src/chapters/ch07-half-steps-and-whole-steps.js
  var { Factory: Factory7 } = Vex.Flow;
  var ch07_half_steps_and_whole_steps_default = {
    id: 7,
    title: "Half Steps & Whole Steps",
    subtitle: "The building blocks of music",
    pages: [
      {
        title: "What Is a Half Step?",
        content: `<h3>What Is a Half Step?</h3>
<p>A <span class="highlight">half step</span> is the smallest distance between two notes in Western music. On the piano, it's from one key to the <em>very next key</em> \u2014 white or black.</p>
<p>Most white keys have a black key between them, making the distance from one white key to the next a whole step. But <span class="highlight">E\u2192F</span> and <span class="highlight">B\u2192C</span> are natural half steps \u2014 there's no black key between them.</p>
<p><span class="mnemonic">Remember: E-F and B-C are the "no-gap" pairs.</span></p>
<div class="staff-example" id="ch7-ex1"></div>
<p>Above: C to C# (white to black key) \u2014 a half step.</p>
<div class="staff-example" id="ch7-ex2"></div>
<p>Above: E to F (two white keys, no black key between) \u2014 also a half step.</p>`,
        render(container) {
          const el1 = container.querySelector("#ch7-ex1");
          if (el1) {
            const f = new Factory7({ renderer: { elementId: el1.id, width: 300, height: 120 } });
            const s = f.EasyScore();
            f.System({ x: 0, y: 0, width: 260 }).addStave({ voices: [s.voice(s.notes("C4/h, C#4/h"))] }).addClef("treble");
            f.draw();
          }
          const el2 = container.querySelector("#ch7-ex2");
          if (el2) {
            const f = new Factory7({ renderer: { elementId: el2.id, width: 300, height: 120 } });
            const s = f.EasyScore();
            f.System({ x: 0, y: 0, width: 260 }).addStave({ voices: [s.voice(s.notes("E4/h, F4/h"))] }).addClef("treble");
            f.draw();
          }
        }
      },
      {
        title: "What Is a Whole Step?",
        content: `<h3>What Is a Whole Step?</h3>
<p>A <span class="highlight">whole step</span> equals <span class="highlight">two half steps</span>. On the keyboard, a whole step always skips exactly one key.</p>
<p>C\u2192D is a whole step (skips C#). D\u2192E is a whole step (skips D#).</p>
<p>Think of it this way: if you can fit one key in between, it's a whole step.</p>
<div class="staff-example" id="ch7-ex3"></div>
<p>Above: C to D, then D to E \u2014 both whole steps.</p>`,
        render(container) {
          const el = container.querySelector("#ch7-ex3");
          if (el) {
            const f = new Factory7({ renderer: { elementId: el.id, width: 300, height: 120 } });
            const s = f.EasyScore();
            f.System({ x: 0, y: 0, width: 260 }).addStave({ voices: [s.voice(s.notes("C4/h, D4/h"))] }).addClef("treble");
            f.draw();
          }
        }
      },
      {
        title: "The Piano Keyboard Pattern",
        content: `<h3>The Piano Keyboard Pattern</h3>
<p>The pattern of whole and half steps creates the distinctive layout of the piano keyboard. Between white keys:</p>
<p style="text-align:center; font-size:1.1em; letter-spacing:2px; margin:12px 0;">
<strong>C</strong> <span style="color:#2196F3">W</span> <strong>D</strong> <span style="color:#2196F3">W</span> <strong>E</strong> <span style="color:#e53935">H</span> <strong>F</strong> <span style="color:#2196F3">W</span> <strong>G</strong> <span style="color:#2196F3">W</span> <strong>A</strong> <span style="color:#2196F3">W</span> <strong>B</strong> <span style="color:#e53935">H</span> <strong>C</strong>
</p>
<p><span style="color:#2196F3"><strong>W</strong></span> = Whole step (black key between) &nbsp; <span style="color:#e53935"><strong>H</strong></span> = Half step (no black key)</p>
<p>This <span class="highlight">W-W-H-W-W-W-H</span> pattern repeats every octave \u2014 it's the foundation of the major scale (Chapter 8).</p>
<p><span class="mnemonic">The half steps always land between E-F and B-C.</span></p>`
      },
      {
        title: "Counting Half Steps",
        content: `<h3>Counting Half Steps</h3>
<p>To count half steps between two notes, count every key (black and white) from the starting note to the target \u2014 don't count the starting note itself.</p>
<p><span class="highlight">C to E</span> = 4 half steps (C\u2192C#\u2192D\u2192D#\u2192E)</p>
<p><span class="highlight">C to G</span> = 7 half steps (C\u2192C#\u2192D\u2192D#\u2192E\u2192F\u2192F#\u2192G)</p>
<p>This skill is essential: intervals, scales, and chords are all defined by specific half-step distances.</p>`
      }
    ],
    quizPool: [
      { id: "7-1", prompt: "What is a half step?", render: null, options: ["The smallest distance between two notes", "A skip of two keys", "The distance between C and E", "The distance between octaves"], correctIndex: 0 },
      { id: "7-2", prompt: "How many half steps from E to F?", render: null, options: ["1", "2", "3", "0"], correctIndex: 0 },
      { id: "7-3", prompt: "How many half steps from B to C?", render: null, options: ["2", "3", "0", "1"], correctIndex: 3 },
      { id: "7-4", prompt: "What is a whole step?", render: null, options: ["Three half steps", "One half step", "Two half steps", "Four half steps"], correctIndex: 2 },
      { id: "7-5", prompt: "How many half steps from C to D?", render: null, options: ["1", "2", "3", "4"], correctIndex: 1 },
      { id: "7-6", prompt: "Which pair of white keys has NO black key between them?", render: null, options: ["C and D", "D and E", "E and F", "G and A"], correctIndex: 2 },
      { id: "7-7", prompt: "How many half steps from C to E?", render: null, options: ["2", "3", "4", "5"], correctIndex: 2 },
      { id: "7-8", prompt: "How many half steps from C to G?", render: null, options: ["5", "6", "7", "8"], correctIndex: 2 },
      { id: "7-9", prompt: "A whole step on the piano always skips ___ key(s):", render: null, options: ["0", "1", "2", "3"], correctIndex: 1 },
      { id: "7-10", prompt: "Which of these is a half step?", render: null, options: ["C to D", "D to F", "F to F#", "G to B"], correctIndex: 2 }
    ]
  };

  // src/chapters/ch08-major-scale.js
  var { Factory: Factory8 } = Vex.Flow;
  var ch08_major_scale_default = {
    id: 8,
    title: "The Major Scale",
    subtitle: "The most important pattern in music",
    pages: [
      {
        title: "What Is a Scale?",
        content: `<h3>What Is a Scale?</h3>
<p>A <span class="highlight">scale</span> is a set of notes arranged in order by pitch. Think of it as the "palette" of notes a piece of music draws from.</p>
<p>The <span class="highlight">major scale</span> is the most common \u2014 it sounds bright and happy. You've already heard it: Do-Re-Mi-Fa-Sol-La-Ti-Do.</p>
<div class="staff-example" id="ch8-ex1"></div>
<p>Above: The C major scale \u2014 all white keys from C to C.</p>`,
        render(container) {
          const el = container.querySelector("#ch8-ex1");
          if (el) {
            const f = new Factory8({ renderer: { elementId: el.id, width: 340, height: 120 } });
            const s = f.EasyScore();
            f.System({ x: 0, y: 0, width: 300 }).addStave({ voices: [s.voice(s.notes("C4/q, D4/q, E4/q, F4/q, G4/q, A4/q, B4/q, C5/q"), { time: "8/4" })] }).addClef("treble");
            f.draw();
          }
        }
      },
      {
        title: "The Major Scale Formula",
        content: `<h3>The Major Scale Formula</h3>
<p>Every major scale follows the same pattern of whole and half steps:</p>
<p style="text-align:center; font-size:1.2em; margin:12px 0;"><span class="highlight">W - W - H - W - W - W - H</span></p>
<p>In C major this is easy to see \u2014 all white keys:</p>
<p style="text-align:center;">C <span style="color:#2196F3">W</span> D <span style="color:#2196F3">W</span> E <span style="color:#e53935">H</span> F <span style="color:#2196F3">W</span> G <span style="color:#2196F3">W</span> A <span style="color:#2196F3">W</span> B <span style="color:#e53935">H</span> C</p>
<p>The half steps always fall between degrees <span class="highlight">3-4</span> and <span class="highlight">7-8</span>.</p>
<div class="staff-example" id="ch8-ex2"></div>
<p>C major scale for reference \u2014 notice how it uses no sharps or flats.</p>`,
        render(container) {
          const el = container.querySelector("#ch8-ex2");
          if (el) {
            const f = new Factory8({ renderer: { elementId: el.id, width: 340, height: 120 } });
            const s = f.EasyScore();
            f.System({ x: 0, y: 0, width: 300 }).addStave({ voices: [s.voice(s.notes("C4/q, D4/q, E4/q, F4/q, G4/q, A4/q, B4/q, C5/q"), { time: "8/4" })] }).addClef("treble");
            f.draw();
          }
        }
      },
      {
        title: "Building Major Scales",
        content: `<h3>Building Major Scales</h3>
<p>Start on <em>any</em> note and apply <span class="highlight">W-W-H-W-W-W-H</span> \u2014 you'll get a major scale.</p>
<p><strong>G major:</strong> G-A-B-C-D-E-F#-G (one sharp)</p>
<p><strong>F major:</strong> F-G-A-Bb-C-D-E-F (one flat)</p>
<p>This is exactly <em>why</em> key signatures exist \u2014 they tell you which sharps or flats a scale needs.</p>
<div class="staff-example" id="ch8-ex3"></div>
<p>Above: G major scale. The key signature shows one sharp (F#).</p>`,
        render(container) {
          const el = container.querySelector("#ch8-ex3");
          if (el) {
            const f = new Factory8({ renderer: { elementId: el.id, width: 340, height: 120 } });
            const s = f.EasyScore();
            f.System({ x: 0, y: 0, width: 300 }).addStave({ voices: [s.voice(s.notes("G4/q, A4/q, B4/q, C5/q, D5/q, E5/q, F#5/q, G5/q"), { time: "8/4" })] }).addClef("treble").addKeySignature("G");
            f.draw();
          }
        }
      },
      {
        title: "Scale Degrees",
        content: `<h3>Scale Degrees</h3>
<p>Each note in a scale has a number and a name:</p>
<p><span class="highlight">1 = Tonic</span> (home base)<br>
2 = Supertonic<br>
3 = Mediant<br>
<span class="highlight">4 = Subdominant</span><br>
<span class="highlight">5 = Dominant</span> (strongest pull to tonic)<br>
6 = Submediant<br>
7 = Leading Tone (wants to resolve up to tonic)</p>
<p>The three most important: <span class="highlight">1 (Tonic)</span>, <span class="highlight">4 (Subdominant)</span>, and <span class="highlight">5 (Dominant)</span>. These form the backbone of harmony.</p>`
      },
      {
        title: "Why Scales Matter",
        content: `<h3>Why Scales Matter</h3>
<p>Scales are the <span class="highlight">foundation</span> of nearly everything in music:</p>
<p><strong>Melodies</strong> \u2014 most melodies use notes from a single scale. Knowing the scale helps you predict what comes next.</p>
<p><strong>Chords</strong> \u2014 chords are built from scale notes (you'll learn this in Chapter 10).</p>
<p><strong>Sight reading</strong> \u2014 when you know a key, you know which notes to expect, making reading much faster.</p>
<p><strong>Improvisation</strong> \u2014 scales give you the "safe" notes to play over a chord progression.</p>`
      }
    ],
    quizPool: [
      { id: "8-1", prompt: "The major scale formula (in whole and half steps) is:", render: null, options: ["W-H-W-W-H-W-W", "W-W-H-W-W-W-H", "H-W-W-H-W-W-W", "W-W-W-H-W-W-H"], correctIndex: 1 },
      { id: "8-2", prompt: "How many notes are in a major scale (including the octave)?", render: null, options: ["6", "7", "8", "12"], correctIndex: 2 },
      { id: "8-3", prompt: "In a major scale, the half steps fall between degrees:", render: null, options: ["1-2 and 5-6", "2-3 and 6-7", "3-4 and 7-8", "4-5 and 1-2"], correctIndex: 2 },
      { id: "8-4", prompt: "C major uses:", render: null, options: ["One sharp", "One flat", "No sharps or flats", "Two sharps"], correctIndex: 2 },
      { id: "8-5", prompt: "What note is the 5th degree of C major?", render: null, options: ["E", "F", "G", "A"], correctIndex: 2 },
      { id: "8-6", prompt: "G major has one sharp. Which note is sharp?", render: null, options: ["C#", "G#", "F#", "D#"], correctIndex: 2 },
      { id: "8-7", prompt: "F major has one flat. Which note is flat?", render: null, options: ["Eb", "Ab", "Db", "Bb"], correctIndex: 3 },
      { id: "8-8", prompt: "The 1st degree of a scale is called the:", render: null, options: ["Dominant", "Mediant", "Leading tone", "Tonic"], correctIndex: 3 },
      { id: "8-9", prompt: "The 5th degree of a scale is called the:", render: null, options: ["Tonic", "Dominant", "Subdominant", "Mediant"], correctIndex: 1 },
      { id: "8-10", prompt: "What major scale is shown?", render(el) {
        const f = new Factory8({ renderer: { elementId: el.id, width: 340, height: 120 } });
        const s = f.EasyScore();
        f.System({ x: 0, y: 0, width: 300 }).addStave({ voices: [s.voice(s.notes("D4/q, E4/q, F#4/q, G4/q, A4/q, B4/q, C#5/q, D5/q"), { time: "8/4" })] }).addClef("treble").addKeySignature("D");
        f.draw();
      }, options: ["C Major", "D Major", "G Major", "A Major"], correctIndex: 1 }
    ]
  };

  // src/chapters/ch09-minor-scale.js
  var { Factory: Factory9 } = Vex.Flow;
  var ch09_minor_scale_default = {
    id: 9,
    title: "The Minor Scale",
    subtitle: "The other side of the coin",
    pages: [
      {
        title: "Major vs. Minor",
        content: `<h3>Major vs. Minor</h3>
<p><span class="highlight">Major</span> scales sound bright and happy. <span class="highlight">Minor</span> scales sound darker, sadder, or more dramatic.</p>
<p>The natural minor formula: <span class="highlight">W-H-W-W-H-W-W</span></p>
<p>Here's the amazing thing: C major (C D E F G A B C) and A minor (A B C D E F G A) use the <em>exact same white keys</em> \u2014 just starting on different notes!</p>
<div class="staff-example" id="ch9-ex1"></div>
<p>Above: A natural minor scale \u2014 all white keys from A to A.</p>`,
        render(container) {
          const el = container.querySelector("#ch9-ex1");
          if (el) {
            const f = new Factory9({ renderer: { elementId: el.id, width: 340, height: 120 } });
            const s = f.EasyScore();
            f.System({ x: 0, y: 0, width: 300 }).addStave({ voices: [s.voice(s.notes("A3/q, B3/q, C4/q, D4/q, E4/q, F4/q, G4/q, A4/q", { clef: "bass" }), { time: "8/4" })] }).addClef("bass");
            f.draw();
          }
        }
      },
      {
        title: "Relative Major and Minor",
        content: `<h3>Relative Major and Minor</h3>
<p>Every major key has a <span class="highlight">relative minor</span> that shares the exact same key signature.</p>
<p>To find the relative minor, start on the <span class="highlight">6th degree</span> of the major scale (or count down 3 half steps from the major key).</p>
<p><strong>Common pairs:</strong></p>
<p>C major \u2192 <span class="highlight">A minor</span><br>
G major \u2192 <span class="highlight">E minor</span><br>
F major \u2192 <span class="highlight">D minor</span></p>
<div class="staff-example" id="ch9-ex2"></div>
<p>Above: C major scale \u2014 A minor uses the same notes, starting on A.</p>`,
        render(container) {
          const el = container.querySelector("#ch9-ex2");
          if (el) {
            const f = new Factory9({ renderer: { elementId: el.id, width: 340, height: 120 } });
            const s = f.EasyScore();
            f.System({ x: 0, y: 0, width: 300 }).addStave({ voices: [s.voice(s.notes("C4/q, D4/q, E4/q, F4/q, G4/q, A4/q, B4/q, C5/q"), { time: "8/4" })] }).addClef("treble");
            f.draw();
          }
        }
      },
      {
        title: "Harmonic and Melodic Minor",
        content: `<h3>Harmonic and Melodic Minor</h3>
<p>The natural minor has two important variations:</p>
<p><span class="highlight">Harmonic minor</span>: raise the 7th degree by a half step. This creates a <em>leading tone</em> that pulls strongly back to the tonic, and gives the scale a distinctive, almost exotic sound.</p>
<p>A harmonic minor: A B C D E F <span class="highlight">G#</span> A</p>
<p><span class="highlight">Melodic minor</span>: raise <em>both</em> the 6th and 7th going up; revert to natural minor going down.</p>
<p>For now, just know these variations exist \u2014 you'll mostly encounter natural minor.</p>
<div class="staff-example" id="ch9-ex3"></div>
<p>Above: A harmonic minor \u2014 notice the G# creating a larger gap before A.</p>`,
        render(container) {
          const el = container.querySelector("#ch9-ex3");
          if (el) {
            const f = new Factory9({ renderer: { elementId: el.id, width: 340, height: 120 } });
            const s = f.EasyScore();
            f.System({ x: 0, y: 0, width: 300 }).addStave({ voices: [s.voice(s.notes("A3/q, B3/q, C4/q, D4/q, E4/q, F4/q, G#4/q, A4/q", { clef: "bass" }), { time: "8/4" })] }).addClef("bass");
            f.draw();
          }
        }
      },
      {
        title: "Finding Minor Keys",
        content: `<h3>Finding Minor Keys</h3>
<p>A key signature alone doesn't tell you if a piece is major or minor \u2014 you have to listen and look at the music.</p>
<p><strong>Clues that a piece is in a minor key:</strong></p>
<p>The melody starts or ends on the minor tonic. The "home" note feels darker. Look for raised 7th degrees (accidentals not in the key signature).</p>
<p><strong>Common major/minor pairs:</strong></p>
<p>C/Am &bull; G/Em &bull; D/Bm &bull; F/Dm &bull; Bb/Gm &bull; Eb/Cm</p>
<p><span class="mnemonic">Same key signature, different home note.</span></p>`
      }
    ],
    quizPool: [
      { id: "9-1", prompt: "The natural minor scale formula is:", render: null, options: ["W-W-H-W-W-W-H", "W-H-W-W-H-W-W", "H-W-W-H-W-W-W", "W-W-H-W-W-H-W"], correctIndex: 1 },
      { id: "9-2", prompt: "Minor scales generally sound:", render: null, options: ["Bright and happy", "Dark or sad", "Fast and energetic", "Loud and bold"], correctIndex: 1 },
      { id: "9-3", prompt: "What is the relative minor of C major?", render: null, options: ["D minor", "E minor", "A minor", "G minor"], correctIndex: 2 },
      { id: "9-4", prompt: "What is the relative minor of G major?", render: null, options: ["B minor", "D minor", "E minor", "A minor"], correctIndex: 2 },
      { id: "9-5", prompt: "The relative minor starts on which degree of the major scale?", render: null, options: ["3rd", "4th", "5th", "6th"], correctIndex: 3 },
      { id: "9-6", prompt: "A minor and C major share the same:", render: null, options: ["Tempo", "Key signature", "Time signature", "Clef"], correctIndex: 1 },
      { id: "9-7", prompt: "In harmonic minor, which degree is raised?", render: null, options: ["3rd", "5th", "6th", "7th"], correctIndex: 3 },
      { id: "9-8", prompt: "What note is raised in A harmonic minor?", render: null, options: ["F", "E", "G", "D"], correctIndex: 2 },
      { id: "9-9", prompt: "How many half steps down from a major key to its relative minor?", render: null, options: ["1", "2", "3", "4"], correctIndex: 2 },
      { id: "9-10", prompt: "What is the relative major of D minor?", render: null, options: ["C major", "D major", "F major", "G major"], correctIndex: 2 }
    ]
  };

  // src/chapters/ch10-chords.js
  var { Factory: Factory10 } = Vex.Flow;
  var ch10_chords_default = {
    id: 10,
    title: "Chords \u2014 Major & Minor Triads",
    subtitle: "Playing notes together",
    pages: [
      {
        title: "What Is a Chord?",
        content: `<h3>What Is a Chord?</h3>
<p>A <span class="highlight">chord</span> is three or more notes played at the same time. The simplest chord is a <span class="highlight">triad</span> \u2014 three notes stacked in intervals of a third.</p>
<p>Chords provide <span class="highlight">harmony</span>, the vertical dimension of music that supports the melody.</p>
<div class="staff-example" id="ch10-ex1"></div>
<p>Above: A C major chord (C-E-G) \u2014 three notes stacked on the staff.</p>`,
        render(container) {
          const el = container.querySelector("#ch10-ex1");
          if (el) {
            const f = new Factory10({ renderer: { elementId: el.id, width: 200, height: 120 } });
            const s = f.EasyScore();
            f.System({ x: 0, y: 0, width: 160 }).addStave({ voices: [s.voice(s.notes("(C4 E4 G4)/w"))] }).addClef("treble");
            f.draw();
          }
        }
      },
      {
        title: "Building Major Triads",
        content: `<h3>Building Major Triads</h3>
<p>A <span class="highlight">major triad</span> is built: Root + <span class="highlight">4 half steps</span> + <span class="highlight">3 half steps</span>.</p>
<p><strong>C major:</strong> C-E-G &nbsp; <strong>G major:</strong> G-B-D &nbsp; <strong>F major:</strong> F-A-C</p>
<p>Major triads sound bright and stable \u2014 they're the "happy" chords.</p>
<div class="staff-example" id="ch10-ex2"></div>
<p>Above: C major (C-E-G) and G major (G-B-D) triads.</p>
<div class="staff-example" id="ch10-ex3"></div>
<p>Above: F major triad (F-A-C).</p>`,
        render(container) {
          const el1 = container.querySelector("#ch10-ex2");
          if (el1) {
            const f = new Factory10({ renderer: { elementId: el1.id, width: 300, height: 120 } });
            const s = f.EasyScore();
            f.System({ x: 0, y: 0, width: 260 }).addStave({ voices: [s.voice(s.notes("(C4 E4 G4)/h, (G3 B3 D4)/h"))] }).addClef("treble");
            f.draw();
          }
          const el2 = container.querySelector("#ch10-ex3");
          if (el2) {
            const f = new Factory10({ renderer: { elementId: el2.id, width: 200, height: 120 } });
            const s = f.EasyScore();
            f.System({ x: 0, y: 0, width: 160 }).addStave({ voices: [s.voice(s.notes("(F3 A3 C4)/w"))] }).addClef("treble");
            f.draw();
          }
        }
      },
      {
        title: "Building Minor Triads",
        content: `<h3>Building Minor Triads</h3>
<p>A <span class="highlight">minor triad</span> reverses the intervals: Root + <span class="highlight">3 half steps</span> + <span class="highlight">4 half steps</span>.</p>
<p>Compare: <strong>C major</strong> = C-E-G vs <strong>C minor</strong> = C-Eb-G</p>
<p>The only difference is the <span class="highlight">3rd</span> \u2014 it's lowered by one half step. This small change transforms the mood from bright to dark.</p>
<div class="staff-example" id="ch10-ex4"></div>
<p>Above: C major (C-E-G) then C minor (C-Eb-G) \u2014 hear how the feel changes with just one note.</p>`,
        render(container) {
          const el = container.querySelector("#ch10-ex4");
          if (el) {
            const f = new Factory10({ renderer: { elementId: el.id, width: 300, height: 120 } });
            const s = f.EasyScore();
            f.System({ x: 0, y: 0, width: 260 }).addStave({ voices: [s.voice(s.notes("(C4 E4 G4)/h, (C4 Eb4 G4)/h"))] }).addClef("treble");
            f.draw();
          }
        }
      },
      {
        title: "Common Triads to Know",
        content: `<h3>Common Triads to Know</h3>
<p><strong>Major triads:</strong></p>
<p>C (C-E-G) &bull; D (D-F#-A) &bull; E (E-G#-B) &bull; F (F-A-C) &bull; G (G-B-D) &bull; A (A-C#-E) &bull; Bb (Bb-D-F)</p>
<p><strong>Minor triads:</strong></p>
<p>Am (A-C-E) &bull; Dm (D-F-A) &bull; Em (E-G-B) &bull; Gm (G-Bb-D)</p>
<p><span class="mnemonic">Minor chords are labeled with a lowercase "m" after the root: Am, Dm, Em.</span></p>
<p>Major chords use just the letter name. "C" means C major; "Cm" means C minor.</p>`
      },
      {
        title: "Inversions",
        content: `<h3>Inversions</h3>
<p>A chord's notes can be rearranged into different <span class="highlight">inversions</span>:</p>
<p><strong>Root position:</strong> C-E-G (root on bottom)<br>
<strong>1st inversion:</strong> E-G-C (3rd on bottom)<br>
<strong>2nd inversion:</strong> G-C-E (5th on bottom)</p>
<p>Same chord, different voicing. Inversions create smoother transitions between chords.</p>
<div class="staff-example" id="ch10-ex5"></div>
<p>Above: C major in root position and 1st inversion.</p>
<div class="staff-example" id="ch10-ex6"></div>
<p>Above: C major in 2nd inversion (G on bottom).</p>`,
        render(container) {
          const el1 = container.querySelector("#ch10-ex5");
          if (el1) {
            const f = new Factory10({ renderer: { elementId: el1.id, width: 300, height: 120 } });
            const s = f.EasyScore();
            f.System({ x: 0, y: 0, width: 260 }).addStave({ voices: [s.voice(s.notes("(C4 E4 G4)/h, (E4 G4 C5)/h"))] }).addClef("treble");
            f.draw();
          }
          const el2 = container.querySelector("#ch10-ex6");
          if (el2) {
            const f = new Factory10({ renderer: { elementId: el2.id, width: 200, height: 120 } });
            const s = f.EasyScore();
            f.System({ x: 0, y: 0, width: 160 }).addStave({ voices: [s.voice(s.notes("(G3 C4 E4)/w"))] }).addClef("treble");
            f.draw();
          }
        }
      }
    ],
    quizPool: [
      { id: "10-1", prompt: "A triad is made up of how many notes?", render: null, options: ["2", "3", "4", "5"], correctIndex: 1 },
      { id: "10-2", prompt: "A major triad is built with:", render: null, options: ["Root + 3 half steps + 4 half steps", "Root + 4 half steps + 3 half steps", "Root + 2 half steps + 2 half steps", "Root + 5 half steps + 2 half steps"], correctIndex: 1 },
      { id: "10-3", prompt: "What notes make up a C major triad?", render: null, options: ["C-D-E", "C-Eb-G", "C-E-G", "C-F-A"], correctIndex: 2 },
      { id: "10-4", prompt: "What notes make up a G major triad?", render: null, options: ["G-A-B", "G-Bb-D", "G-B-D", "G-C-E"], correctIndex: 2 },
      { id: "10-5", prompt: "A minor triad is built with:", render: null, options: ["Root + 4 half steps + 3 half steps", "Root + 3 half steps + 3 half steps", "Root + 3 half steps + 4 half steps", "Root + 4 half steps + 4 half steps"], correctIndex: 2 },
      { id: "10-6", prompt: "What notes make up an A minor triad?", render: null, options: ["A-C-E", "A-C#-E", "A-D-F", "A-Cb-E"], correctIndex: 0 },
      { id: "10-7", prompt: "The difference between C major and C minor is:", render: null, options: ["The root", "The 3rd", "The 5th", "The octave"], correctIndex: 1 },
      { id: "10-8", prompt: "What chord is this?", render(el) {
        const f = new Factory10({ renderer: { elementId: el.id, width: 200, height: 120 } });
        const s = f.EasyScore();
        f.System({ x: 0, y: 0, width: 160 }).addStave({ voices: [s.voice(s.notes("(C4 E4 G4)/w"))] }).addClef("treble");
        f.draw();
      }, options: ["C minor", "F major", "C major", "G major"], correctIndex: 2 },
      { id: "10-9", prompt: "In first inversion, which note is on the bottom?", render: null, options: ["The root", "The 3rd", "The 5th", "The 7th"], correctIndex: 1 },
      { id: "10-10", prompt: "What chord is this?", render(el) {
        const f = new Factory10({ renderer: { elementId: el.id, width: 200, height: 120 } });
        const s = f.EasyScore();
        f.System({ x: 0, y: 0, width: 160 }).addStave({ voices: [s.voice(s.notes("(A3 C4 E4)/w"))] }).addClef("treble");
        f.draw();
      }, options: ["C major", "A major", "E minor", "A minor"], correctIndex: 3 }
    ]
  };

  // src/chapters/ch11-chord-progressions.js
  var { Factory: Factory11 } = Vex.Flow;
  var ch11_chord_progressions_default = {
    id: 11,
    title: "Chord Progressions",
    subtitle: "How chords work together",
    pages: [
      {
        title: "Chords in a Key",
        content: `<h3>Chords in a Key</h3>
<p>When you build a triad on each note of a major scale, you get seven chords \u2014 some major, some minor, one diminished:</p>
<p style="text-align:center; margin:12px 0;">
<strong>I</strong> &bull; <strong>ii</strong> &bull; <strong>iii</strong> &bull; <strong>IV</strong> &bull; <strong>V</strong> &bull; <strong>vi</strong> &bull; <strong>vii&deg;</strong>
</p>
<p>In C major: <span class="highlight">C(I)</span> &bull; Dm(ii) &bull; Em(iii) &bull; <span class="highlight">F(IV)</span> &bull; <span class="highlight">G(V)</span> &bull; Am(vi) &bull; Bdim(vii&deg;)</p>
<p><span class="mnemonic">Uppercase = major, lowercase = minor. This pattern is the same in every major key.</span></p>`
      },
      {
        title: "The I, IV, and V Chords",
        content: `<h3>The I, IV, and V Chords</h3>
<p>The three most important chords in any key:</p>
<p><span class="highlight">I (Tonic)</span> \u2014 home, stability<br>
<span class="highlight">IV (Subdominant)</span> \u2014 departure, movement<br>
<span class="highlight">V (Dominant)</span> \u2014 tension, wants to resolve back to I</p>
<p>In C major: C, F, G. In G major: G, C, D.</p>
<p>Thousands of songs use <em>only</em> these three chords!</p>
<div class="staff-example" id="ch11-ex1"></div>
<p>Above: I and IV chords in C major (C and F).</p>
<div class="staff-example" id="ch11-ex2"></div>
<p>Above: V chord in C major (G).</p>`,
        render(container) {
          const el1 = container.querySelector("#ch11-ex1");
          if (el1) {
            const f = new Factory11({ renderer: { elementId: el1.id, width: 300, height: 120 } });
            const s = f.EasyScore();
            f.System({ x: 0, y: 0, width: 260 }).addStave({ voices: [s.voice(s.notes("(C4 E4 G4)/h, (F3 A3 C4)/h"))] }).addClef("treble");
            f.draw();
          }
          const el2 = container.querySelector("#ch11-ex2");
          if (el2) {
            const f = new Factory11({ renderer: { elementId: el2.id, width: 200, height: 120 } });
            const s = f.EasyScore();
            f.System({ x: 0, y: 0, width: 160 }).addStave({ voices: [s.voice(s.notes("(G3 B3 D4)/w"))] }).addClef("treble");
            f.draw();
          }
        }
      },
      {
        title: "The I-V-vi-IV Progression",
        content: `<h3>The I-V-vi-IV Progression</h3>
<p>The most common chord progression in pop music:</p>
<p style="text-align:center; font-size:1.2em; margin:12px 0;"><span class="highlight">I \u2192 V \u2192 vi \u2192 IV</span></p>
<p>In C major: <strong>C \u2192 G \u2192 Am \u2192 F</strong></p>
<p>You've heard this in "Let It Be," "No Woman No Cry," "Someone Like You," and hundreds more.</p>
<div class="staff-example" id="ch11-ex3"></div>
<p>Above: The I-V-vi-IV progression in C major.</p>`,
        render(container) {
          const el = container.querySelector("#ch11-ex3");
          if (el) {
            const f = new Factory11({ renderer: { elementId: el.id, width: 300, height: 120 } });
            const s = f.EasyScore();
            f.System({ x: 0, y: 0, width: 260 }).addStave({ voices: [s.voice(s.notes("(C4 E4 G4)/q, (G3 B3 D4)/q, (A3 C4 E4)/q, (F3 A3 C4)/q"))] }).addClef("treble");
            f.draw();
          }
        }
      },
      {
        title: "Other Common Progressions",
        content: `<h3>Other Common Progressions</h3>
<p><span class="highlight">I-IV-V-I</span> \u2014 Classic resolution. The foundation of blues, rock, and folk. Ends with a strong return home.</p>
<p><span class="highlight">I-vi-IV-V</span> \u2014 The "50s progression." Doo-wop, early rock and roll.</p>
<p><span class="highlight">ii-V-I</span> \u2014 The jazz turnaround. The most important progression in jazz harmony.</p>
<p><span class="highlight">12-bar blues</span> \u2014 A 12-measure pattern using I, IV, and V that defines blues, early rock, and jazz.</p>
<p>Once you can hear these patterns, you'll start recognizing them everywhere.</p>`
      },
      {
        title: "Reading Chord Symbols",
        content: `<h3>Reading Chord Symbols</h3>
<p>On lead sheets and charts, chords are written above the melody line using shorthand:</p>
<p><span class="highlight">C</span> = C major &nbsp; <span class="highlight">Cm</span> = C minor &nbsp; <span class="highlight">C7</span> = C dominant 7th</p>
<p><span class="highlight">G/B</span> = G major with B in the bass (a "slash chord")</p>
<p>Now you know how to <em>build</em> each of these from the formulas you've learned. When you see "Dm" on a chart, you know it means D-F-A.</p>
<p><span class="mnemonic">Letter alone = major. Letter + "m" = minor. That's the most important distinction.</span></p>`
      }
    ],
    quizPool: [
      { id: "11-1", prompt: "In C major, what is the IV chord?", render: null, options: ["G major", "A minor", "F major", "D minor"], correctIndex: 2 },
      { id: "11-2", prompt: "In C major, what is the V chord?", render: null, options: ["F major", "G major", "A minor", "E minor"], correctIndex: 1 },
      { id: "11-3", prompt: "In G major, what is the I chord?", render: null, options: ["C major", "D major", "G major", "A major"], correctIndex: 2 },
      { id: "11-4", prompt: "Roman numeral 'vi' indicates a:", render: null, options: ["Major chord", "Minor chord", "Diminished chord", "Augmented chord"], correctIndex: 1 },
      { id: "11-5", prompt: "The most common pop progression is:", render: null, options: ["I-IV-V-I", "ii-V-I", "I-V-vi-IV", "I-vi-ii-V"], correctIndex: 2 },
      { id: "11-6", prompt: "In C major, the I-V-vi-IV progression is:", render: null, options: ["C-F-Am-G", "C-G-Am-F", "C-G-Em-F", "C-F-G-Am"], correctIndex: 1 },
      { id: "11-7", prompt: "The V chord naturally wants to resolve to the:", render: null, options: ["IV chord", "vi chord", "I chord", "ii chord"], correctIndex: 2 },
      { id: "11-8", prompt: "In C major, which chord is built on the 2nd degree?", render: null, options: ["C major", "D minor", "E minor", "F major"], correctIndex: 1 },
      { id: "11-9", prompt: "What does 'Cm' mean as a chord symbol?", render: null, options: ["C major", "C minor", "C diminished", "C with a melody"], correctIndex: 1 },
      { id: "11-10", prompt: "In G major, the I-IV-V chords are:", render: null, options: ["G-C-D", "G-B-D", "G-D-A", "G-F-C"], correctIndex: 0 }
    ]
  };

  // src/chapters/ch12-dynamics-and-articulation.js
  var { Factory: Factory12 } = Vex.Flow;
  var ch12_dynamics_and_articulation_default = {
    id: 12,
    title: "Dynamics & Expression",
    subtitle: "How loud and how soft",
    pages: [
      {
        title: "Volume in Music",
        content: `<h3>Volume in Music</h3>
<p>Music isn't all the same volume \u2014 composers indicate how loud or soft to play using <span class="highlight">dynamic markings</span>.</p>
<p>These markings are Italian abbreviations written <span class="highlight">below the staff</span>. They range from very soft to very loud.</p>
<p>The basic range from softest to loudest:</p>
<p style="text-align:center; font-size:1.3em; font-style:italic; letter-spacing:0.3em;"><span class="highlight">pp &nbsp; p &nbsp; mp &nbsp; mf &nbsp; f &nbsp; ff</span></p>
<div class="staff-example" id="ch12-ex1"></div>
<p>Above: a staff with a <span class="highlight">p</span> (piano / soft) marking below.</p>`,
        render(container) {
          const el = container.querySelector("#ch12-ex1");
          if (!el) return;
          const f = new Factory12({ renderer: { elementId: el.id, width: 300, height: 140 } });
          const s = f.EasyScore();
          const voice = s.voice(s.notes("C4/q, E4/q, G4/q, C5/q"));
          f.System({ x: 0, y: 0, width: 260 }).addStave({ voices: [voice] }).addClef("treble");
          f.draw();
          const ctx = f.getContext();
          ctx.setFont("Times", 16, "bold italic");
          ctx.fillText("p", 60, 130);
        }
      },
      {
        title: "The Dynamic Markings",
        content: `<h3>The Dynamic Markings</h3>
<p>Here are the six standard dynamic levels, from softest to loudest:</p>
<table style="width:100%; text-align:left; border-collapse:collapse; margin:0.5em 0;">
<tr><td style="padding:4px 8px; font-style:italic; font-size:1.2em;"><b>pp</b></td><td>pianissimo \u2014 <span class="highlight">very soft</span></td></tr>
<tr><td style="padding:4px 8px; font-style:italic; font-size:1.2em;"><b>p</b></td><td>piano \u2014 <span class="highlight">soft</span></td></tr>
<tr><td style="padding:4px 8px; font-style:italic; font-size:1.2em;"><b>mp</b></td><td>mezzo piano \u2014 <span class="highlight">moderately soft</span></td></tr>
<tr><td style="padding:4px 8px; font-style:italic; font-size:1.2em;"><b>mf</b></td><td>mezzo forte \u2014 <span class="highlight">moderately loud</span></td></tr>
<tr><td style="padding:4px 8px; font-style:italic; font-size:1.2em;"><b>f</b></td><td>forte \u2014 <span class="highlight">loud</span></td></tr>
<tr><td style="padding:4px 8px; font-style:italic; font-size:1.2em;"><b>ff</b></td><td>fortissimo \u2014 <span class="highlight">very loud</span></td></tr>
</table>
<p><span class="mnemonic">Fun fact: The instrument "piano" is short for "pianoforte" \u2014 meaning "soft-loud" \u2014 because it was the first keyboard that could play both!</span></p>`,
        render: null
      },
      {
        title: "Gradual Changes \u2014 Crescendo & Decrescendo",
        content: `<h3>Gradual Changes</h3>
<p>Music often changes volume gradually rather than jumping from one level to another.</p>
<p><span class="highlight">Crescendo</span> (cresc. or hairpin opening to the right): get <b>gradually louder</b></p>
<svg width="120" height="30" style="display:block; margin:0.3em auto;"><line x1="5" y1="15" x2="115" y2="5" stroke="currentColor" stroke-width="2"/><line x1="5" y1="15" x2="115" y2="25" stroke="currentColor" stroke-width="2"/></svg>
<p><span class="highlight">Decrescendo</span> (decresc. or dim., hairpin opening to the left): get <b>gradually softer</b></p>
<svg width="120" height="30" style="display:block; margin:0.3em auto;"><line x1="5" y1="5" x2="115" y2="15" stroke="currentColor" stroke-width="2"/><line x1="5" y1="25" x2="115" y2="15" stroke="currentColor" stroke-width="2"/></svg>
<p>These hairpin symbols appear below the staff, spanning the notes where the change happens.</p>
<div class="staff-example" id="ch12-ex2"></div>`,
        render(container) {
          const el = container.querySelector("#ch12-ex2");
          if (!el) return;
          const f = new Factory12({ renderer: { elementId: el.id, width: 300, height: 140 } });
          const s = f.EasyScore();
          const voice = s.voice(s.notes("C4/q, D4/q, E4/q, F4/q"));
          f.System({ x: 0, y: 0, width: 260 }).addStave({ voices: [voice] }).addClef("treble");
          f.draw();
          const ctx = f.getContext();
          ctx.beginPath();
          ctx.moveTo(55, 120);
          ctx.lineTo(230, 110);
          ctx.moveTo(55, 120);
          ctx.lineTo(230, 130);
          ctx.stroke();
        }
      },
      {
        title: "Other Expression Marks",
        content: `<h3>Other Expression Marks</h3>
<p>Beyond dynamics, composers use other symbols to shape how individual notes are played:</p>
<p><span class="highlight">sfz</span> (sforzando) \u2014 a sudden strong accent on one note</p>
<p><span class="highlight">fp</span> (fortepiano) \u2014 loud, then immediately soft</p>
<p><span class="highlight">Accent (&gt;)</span> \u2014 emphasize this particular note</p>
<p><span class="highlight">Fermata (\u{1D110})</span> \u2014 hold this note longer than its written value; the performer decides how long</p>
<p>These marks add character and emotion to music \u2014 they're the difference between playing <em>notes</em> and playing <em>music</em>.</p>
<div class="staff-example" id="ch12-ex3"></div>
<p>Above: a note with a fermata \u2014 hold it as long as you feel is right.</p>`,
        render(container) {
          const el = container.querySelector("#ch12-ex3");
          if (!el) return;
          const f = new Factory12({ renderer: { elementId: el.id, width: 200, height: 140 } });
          const s = f.EasyScore();
          const notes = s.notes("C4/w");
          notes[0].addModifier(new VexFlow.Articulation("a@a").setPosition(VexFlow.Modifier.Position.ABOVE));
          f.System({ x: 0, y: 0, width: 160 }).addStave({ voices: [s.voice(notes)] }).addClef("treble");
          f.draw();
        }
      }
    ],
    quizPool: [
      { id: "12-1", prompt: "What does f mean?", render: null, options: ["Soft", "Moderately loud", "Loud", "Very loud"], correctIndex: 2 },
      { id: "12-2", prompt: "What does p mean?", render: null, options: ["Soft", "Loud", "Moderately soft", "Very soft"], correctIndex: 0 },
      { id: "12-3", prompt: "What does pp mean?", render: null, options: ["Moderately soft", "Very soft", "Soft", "Silent"], correctIndex: 1 },
      { id: "12-4", prompt: "What does ff mean?", render: null, options: ["Moderately loud", "Loud", "Very loud", "As loud as possible"], correctIndex: 2 },
      { id: "12-5", prompt: "What does mp mean?", render: null, options: ["Very soft", "Soft", "Moderately soft", "Moderately loud"], correctIndex: 2 },
      { id: "12-6", prompt: "What does mf mean?", render: null, options: ["Moderately soft", "Moderately loud", "Loud", "Very loud"], correctIndex: 1 },
      { id: "12-7", prompt: "This symbol means:", render(el) {
        const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
        svg.setAttribute("width", "120");
        svg.setAttribute("height", "30");
        svg.innerHTML = `<line x1="5" y1="15" x2="115" y2="5" stroke="currentColor" stroke-width="2"/><line x1="5" y1="15" x2="115" y2="25" stroke="currentColor" stroke-width="2"/>`;
        el.appendChild(svg);
      }, options: ["Get softer", "Get louder", "Stay the same", "Accent"], correctIndex: 1 },
      { id: "12-8", prompt: "This symbol means:", render(el) {
        const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
        svg.setAttribute("width", "120");
        svg.setAttribute("height", "30");
        svg.innerHTML = `<line x1="5" y1="5" x2="115" y2="15" stroke="currentColor" stroke-width="2"/><line x1="5" y1="25" x2="115" y2="15" stroke="currentColor" stroke-width="2"/>`;
        el.appendChild(svg);
      }, options: ["Get louder", "Get softer", "Pause", "Repeat"], correctIndex: 1 },
      { id: "12-9", prompt: "Order from softest to loudest: pp, f, mp, ff", render: null, options: ["pp, mp, f, ff", "mp, pp, f, ff", "pp, f, mp, ff", "f, mp, pp, ff"], correctIndex: 0 },
      { id: "12-10", prompt: "What does sfz mean?", render: null, options: ["Very soft", "Gradually louder", "A sudden strong accent", "Slowly"], correctIndex: 2 }
    ]
  };

  // src/chapters/ch13-tempo-and-expression.js
  var { Factory: Factory13 } = Vex.Flow;
  var ch13_tempo_and_expression_default = {
    id: 13,
    title: "Tempo Markings",
    subtitle: "How fast or slow",
    pages: [
      {
        title: "What Is Tempo?",
        content: `<h3>What Is Tempo?</h3>
<p><span class="highlight">Tempo</span> is the speed of the music \u2014 how fast the beats go by.</p>
<p>Tempo is measured in <span class="highlight">BPM</span> (beats per minute). At 60 BPM, there's one beat per second. At 120 BPM, two beats per second.</p>
<p>Tempo markings are written <span class="highlight">above the staff</span> at the beginning of a piece, or wherever the tempo changes.</p>
<p>Composers indicate tempo two ways: Italian terms (like <em>Allegro</em>) or exact BPM (like \u2669 = 120), or both.</p>
<div class="staff-example" id="ch13-ex1"></div>`,
        render(container) {
          const el = container.querySelector("#ch13-ex1");
          if (!el) return;
          const f = new Factory13({ renderer: { elementId: el.id, width: 300, height: 140 } });
          const s = f.EasyScore();
          f.System({ x: 0, y: 0, width: 260 }).addStave({ voices: [s.voice(s.notes("C4/q, D4/q, E4/q, F4/q"))] }).addClef("treble");
          f.draw();
          const ctx = f.getContext();
          ctx.setFont("Times", 13, "bold italic");
          ctx.fillText("Allegro  \u2669 = 120", 50, 15);
        }
      },
      {
        title: "Common Tempo Terms",
        content: `<h3>Common Tempo Terms</h3>
<p>From slowest to fastest:</p>
<table style="width:100%; text-align:left; border-collapse:collapse; margin:0.5em 0;">
<tr><td style="padding:3px 8px;"><b>Grave</b></td><td>~40 BPM \u2014 very slow, solemn</td></tr>
<tr><td style="padding:3px 8px;"><b>Largo</b></td><td>~50 BPM \u2014 slow, broad</td></tr>
<tr><td style="padding:3px 8px;"><b>Adagio</b></td><td>~70 BPM \u2014 slow, at ease</td></tr>
<tr><td style="padding:3px 8px;"><b>Andante</b></td><td>~80 BPM \u2014 walking pace</td></tr>
<tr><td style="padding:3px 8px;"><b>Moderato</b></td><td>~100 BPM \u2014 moderate speed</td></tr>
<tr><td style="padding:3px 8px;"><b>Allegro</b></td><td>~130 BPM \u2014 fast, lively</td></tr>
<tr><td style="padding:3px 8px;"><b>Vivace</b></td><td>~160 BPM \u2014 very fast, vivid</td></tr>
<tr><td style="padding:3px 8px;"><b>Presto</b></td><td>~180 BPM \u2014 extremely fast</td></tr>
</table>
<p><span class="mnemonic">You don't need to memorize exact BPMs \u2014 just know the relative order from slow to fast.</span></p>`,
        render: null
      },
      {
        title: "Changing Tempo",
        content: `<h3>Changing Tempo</h3>
<p>Music doesn't always stay at one speed. Composers indicate gradual changes:</p>
<p><span class="highlight">rit.</span> (ritardando) \u2014 gradually <b>slow down</b></p>
<p><span class="highlight">accel.</span> (accelerando) \u2014 gradually <b>speed up</b></p>
<p><span class="highlight">a tempo</span> \u2014 return to the <b>original tempo</b> after a rit. or accel.</p>
<p><span class="highlight">rubato</span> \u2014 flexible tempo with slight push and pull (common in Romantic piano music like Chopin)</p>
<p>These markings appear above or below the staff where the change begins.</p>`,
        render: null
      },
      {
        title: "Tempo in Practice",
        content: `<h3>Tempo in Practice</h3>
<p>When you see a tempo marking, set your metronome to that BPM before playing.</p>
<p><span class="mnemonic">Pro tip: Always start slower than the written tempo and work your way up. Speed comes from accuracy, not the other way around.</span></p>
<p>Italian terms give the <em>character</em> and mood. BPM gives the exact speed. Many pieces use both: <b>"Allegro (\u2669 = 132)"</b> \u2014 the word sets the mood, the number sets the speed.</p>
<p>The existing practice modes in this app can be played at different speeds to build your tempo control.</p>`,
        render: null
      }
    ],
    quizPool: [
      { id: "13-1", prompt: "What does Allegro mean?", render: null, options: ["Slow", "Walking pace", "Fast and lively", "Extremely fast"], correctIndex: 2 },
      { id: "13-2", prompt: "What does Adagio mean?", render: null, options: ["Fast", "Moderate", "Slow, at ease", "Walking pace"], correctIndex: 2 },
      { id: "13-3", prompt: "What does Presto mean?", render: null, options: ["Slow", "Moderate", "Fast", "Extremely fast"], correctIndex: 3 },
      { id: "13-4", prompt: "What does Andante mean?", render: null, options: ["Very slow", "Walking pace", "Fast", "Very fast"], correctIndex: 1 },
      { id: "13-5", prompt: "What does rit. mean?", render: null, options: ["Speed up", "Slow down gradually", "Return to tempo", "Play freely"], correctIndex: 1 },
      { id: "13-6", prompt: "What does accel. mean?", render: null, options: ["Slow down", "Speed up gradually", "Hold the note", "Return to tempo"], correctIndex: 1 },
      { id: "13-7", prompt: "What does a tempo mean?", render: null, options: ["Play faster", "Play slower", "Return to the original tempo", "End the piece"], correctIndex: 2 },
      { id: "13-8", prompt: "Order from slowest to fastest: Allegro, Largo, Presto, Andante", render: null, options: ["Largo, Andante, Allegro, Presto", "Andante, Largo, Allegro, Presto", "Largo, Allegro, Andante, Presto", "Presto, Allegro, Andante, Largo"], correctIndex: 0 },
      { id: "13-9", prompt: "BPM stands for:", render: null, options: ["Bars per measure", "Beats per minute", "Bass per measure", "Beats per melody"], correctIndex: 1 },
      { id: "13-10", prompt: "What does Moderato mean?", render: null, options: ["Very slow", "Moderate speed", "Fast", "Extremely fast"], correctIndex: 1 }
    ]
  };

  // src/chapters/ch14-repeat-signs.js
  var { Factory: Factory14 } = Vex.Flow;
  var ch14_repeat_signs_default = {
    id: 14,
    title: "Repeat Signs & Navigation",
    subtitle: "Finding your way through the music",
    pages: [
      {
        title: "Repeat Barlines",
        content: `<h3>Repeat Barlines</h3>
<p>The most common navigation symbol in music: <span class="highlight">repeat barlines</span> tell you to play a section again.</p>
<p>A <span class="highlight">start repeat</span> has two dots on the right side of a thick barline. An <span class="highlight">end repeat</span> has two dots on the left side.</p>
<p>When you reach an end repeat, go back to the matching start repeat. If there's no start repeat, go back to the very beginning.</p>
<div class="staff-example" id="ch14-ex1"></div>
<p>Above: a passage enclosed in repeat barlines \u2014 play it, then play it again.</p>`,
        render(container) {
          const el = container.querySelector("#ch14-ex1");
          if (!el) return;
          const f = new Factory14({ renderer: { elementId: el.id, width: 300, height: 120 } });
          const s = f.EasyScore();
          const stave = f.System({ x: 0, y: 0, width: 260 }).addStave({ voices: [s.voice(s.notes("C4/q, D4/q, E4/q, F4/q"))] }).addClef("treble");
          stave.setBegBarType(VexFlow.Barline.type.REPEAT_BEGIN);
          stave.setEndBarType(VexFlow.Barline.type.REPEAT_END);
          f.draw();
        }
      },
      {
        title: "First and Second Endings",
        content: `<h3>First and Second Endings</h3>
<p>Sometimes you repeat a section but <span class="highlight">change the ending</span> the second time through.</p>
<p><span class="highlight">1st ending</span> (bracket labeled "1."): play this ending the first time.</p>
<p><span class="highlight">2nd ending</span> (bracket labeled "2."): on the repeat, skip the 1st ending and play this instead.</p>
<p>These are called <span class="highlight">volta brackets</span>.</p>
<p>Flow: Play measures \u2192 1st ending \u2192 repeat back \u2192 play measures \u2192 skip to 2nd ending \u2192 continue.</p>
<div class="staff-example" id="ch14-ex2"></div>`,
        render(container) {
          const el = container.querySelector("#ch14-ex2");
          if (!el) return;
          const f = new Factory14({ renderer: { elementId: el.id, width: 340, height: 140 } });
          const s = f.EasyScore();
          const stave = f.System({ x: 0, y: 0, width: 300 }).addStave({ voices: [s.voice(s.notes("C4/q, D4/q, E4/q, F4/q"))] }).addClef("treble");
          stave.setEndBarType(VexFlow.Barline.type.REPEAT_END);
          f.draw();
          const ctx = f.getContext();
          ctx.setFont("Times", 11, "bold");
          ctx.beginPath();
          ctx.moveTo(200, 12);
          ctx.lineTo(200, 3);
          ctx.lineTo(290, 3);
          ctx.stroke();
          ctx.fillText("1.", 205, 14);
        }
      },
      {
        title: "D.C. and D.S.",
        content: `<h3>D.C. and D.S.</h3>
<p><span class="highlight">D.C.</span> (Da Capo) \u2014 go back to the <b>very beginning</b></p>
<p><span class="highlight">D.S.</span> (Dal Segno) \u2014 go back to the <b>segno sign</b> <span style="font-size:1.4em;">\u{1D10B}</span></p>
<p>Both are usually followed by "al Fine" or "al Coda":</p>
<p><span class="highlight">D.C. al Fine</span> \u2014 go to the beginning, play until you see "Fine" (the end)</p>
<p><span class="highlight">D.S. al Coda</span> \u2014 go to the segno <span style="font-size:1.2em;">\u{1D10B}</span>, play until the coda sign <span style="font-size:1.2em;">\u{1D10C}</span>, then jump to the Coda section</p>
<p><span class="mnemonic">Think of D.C. as "go home" and D.S. as "go to the bookmark."</span></p>`,
        render: null
      },
      {
        title: "The Coda and Fine",
        content: `<h3>The Coda and Fine</h3>
<p><span class="highlight">Coda</span> <span style="font-size:1.4em;">\u{1D10C}</span> \u2014 a special ending section, usually at the bottom of the page, separated from the main music.</p>
<p><span class="highlight">Fine</span> (pronounced "FEE-neh") \u2014 marks <b>the end</b>, especially when the piece doesn't end at the last measure on the page.</p>
<p>A typical flow with these markings:</p>
<ol>
<li>Play through the piece</li>
<li>See "D.S. al Coda"</li>
<li>Jump back to the segno sign <span style="font-size:1.2em;">\u{1D10B}</span></li>
<li>Play until you see the coda sign <span style="font-size:1.2em;">\u{1D10C}</span></li>
<li>Jump to the Coda section</li>
<li>Play the Coda to the end</li>
</ol>
<p>This saves page space by avoiding rewriting repeated sections.</p>`,
        render: null
      },
      {
        title: "Putting It All Together",
        content: `<h3>Putting It All Together</h3>
<p>Here's how to read through a piece with navigation markings \u2014 a "roadmap":</p>
<p><b>Example piece:</b> Measures 1\u20138 with repeat signs, then a D.S. al Coda.</p>
<ol>
<li>Play measures 1\u20138</li>
<li>Hit the end repeat \u2192 go back and play 1\u20138 again</li>
<li>Continue to "D.S. al Coda" \u2192 jump back to <span style="font-size:1.2em;">\u{1D10B}</span></li>
<li>Play until <span style="font-size:1.2em;">\u{1D10C}</span> \u2192 jump to the Coda</li>
<li>Play the Coda section to the end</li>
</ol>
<p><span class="mnemonic">Practice tip: Before playing a new piece, trace the roadmap with your finger first so you know where you're going. No surprises!</span></p>
<p>Priority order when you see multiple markings: repeat signs first, then D.C./D.S., then check for endings and codas.</p>`,
        render: null
      }
    ],
    quizPool: [
      { id: "14-1", prompt: "What do repeat barlines tell you to do?", render: null, options: ["Play louder", "Play the section again", "Skip ahead", "Slow down"], correctIndex: 1 },
      { id: "14-2", prompt: "When you see a 2nd ending bracket, you should:", render: null, options: ["Play it both times", "Play it the first time only", "Skip the 1st ending and play this on the repeat", "Go back to the beginning"], correctIndex: 2 },
      { id: "14-3", prompt: "What does D.C. stand for?", render: null, options: ["Da Coda", "Dal Capo", "Da Capo", "Dal Coda"], correctIndex: 2 },
      { id: "14-4", prompt: "What does D.C. al Fine mean?", render: null, options: ["Go to the coda", "Go to the beginning and play until Fine", "Play the ending", "Repeat the last measure"], correctIndex: 1 },
      { id: "14-5", prompt: "What does D.S. mean?", render: null, options: ["Go to the beginning", "Go to the coda", "Go back to the segno sign", "Go to the fine"], correctIndex: 2 },
      { id: "14-6", prompt: "The segno sign (\u{1D10B}) is used with:", render: null, options: ["D.C.", "D.S.", "Fine", "Repeat barlines"], correctIndex: 1 },
      { id: "14-7", prompt: "What is a Coda?", render: null, options: ["A repeat sign", "The beginning of a piece", "A special ending section", "A tempo marking"], correctIndex: 2 },
      { id: "14-8", prompt: "What does Fine mean?", render: null, options: ["Fast", "The end", "Repeat", "The beginning"], correctIndex: 1 },
      { id: "14-9", prompt: "In a passage with 1st and 2nd endings, how many times do you play the main section?", render: null, options: ["1", "2", "3", "4"], correctIndex: 1 },
      { id: "14-10", prompt: "D.S. al Coda means:", render: null, options: ["Go to the beginning, play to coda sign, jump to coda", "Go to the segno, play to coda sign, jump to coda", "Go to the coda and play to the end", "Repeat from the coda sign"], correctIndex: 1 }
    ]
  };

  // src/chapters/ch15-intervals-in-depth.js
  var { Factory: Factory15 } = Vex.Flow;
  var ch15_intervals_in_depth_default = {
    id: 15,
    title: "Intervals in Depth",
    subtitle: "Measuring the distance between notes",
    pages: [
      {
        title: "What Is an Interval?",
        content: `<h3>What Is an Interval?</h3>
<p>An <span class="highlight">interval</span> is the distance between two notes, measured by both <span class="highlight">quantity</span> (a number) and <span class="highlight">quality</span> (a type).</p>
<p>We touched on half steps and whole steps in Chapter 7 \u2014 intervals give us a richer, more precise vocabulary for describing distances.</p>
<p>The <b>number</b> comes from counting letter names inclusively. C to E = a <span class="highlight">3rd</span> (C\u2011D\u2011E \u2014 three letter names).</p>
<div class="staff-example" id="ch15-ex1"></div>
<p>Above: C and E on the staff \u2014 an interval of a 3rd.</p>`,
        render(container) {
          const el = container.querySelector("#ch15-ex1");
          if (!el) return;
          const f = new Factory15({ renderer: { elementId: el.id, width: 200, height: 120 } });
          const s = f.EasyScore();
          f.System({ x: 0, y: 0, width: 160 }).addStave({ voices: [s.voice(s.notes("C4/h, E4/h"))] }).addClef("treble");
          f.draw();
        }
      },
      {
        title: "Interval Numbers",
        content: `<h3>Interval Numbers</h3>
<p>Count inclusively from the bottom note to the top:</p>
<table style="width:100%; text-align:left; border-collapse:collapse; margin:0.5em 0;">
<tr><td style="padding:3px 8px;"><b>C \u2192 C</b></td><td>Unison (1st)</td></tr>
<tr><td style="padding:3px 8px;"><b>C \u2192 D</b></td><td>2nd</td></tr>
<tr><td style="padding:3px 8px;"><b>C \u2192 E</b></td><td>3rd</td></tr>
<tr><td style="padding:3px 8px;"><b>C \u2192 F</b></td><td>4th</td></tr>
<tr><td style="padding:3px 8px;"><b>C \u2192 G</b></td><td>5th</td></tr>
<tr><td style="padding:3px 8px;"><b>C \u2192 A</b></td><td>6th</td></tr>
<tr><td style="padding:3px 8px;"><b>C \u2192 B</b></td><td>7th</td></tr>
<tr><td style="padding:3px 8px;"><b>C \u2192 C</b></td><td>Octave (8th)</td></tr>
</table>
<p>The number tells you the general size, but not the <em>exact</em> size in half steps \u2014 that's where <span class="highlight">quality</span> comes in (next page).</p>
<div class="staff-example" id="ch15-ex2"></div>`,
        render(container) {
          const el = container.querySelector("#ch15-ex2");
          if (!el) return;
          const f = new Factory15({ renderer: { elementId: el.id, width: 300, height: 120 } });
          const s = f.EasyScore();
          f.System({ x: 0, y: 0, width: 260 }).addStave({ voices: [s.voice(s.notes("C4/h, E4/h, G4/h, C5/h"), { time: "4/2" })] }).addClef("treble");
          f.draw();
          const ctx = f.getContext();
          ctx.setFont("Times", 11, "bold");
          ctx.fillText("3rd", 70, 110);
          ctx.fillText("5th", 140, 110);
          ctx.fillText("8ve", 210, 110);
        }
      },
      {
        title: "Interval Quality \u2014 Major and Minor",
        content: `<h3>Interval Quality \u2014 Major and Minor</h3>
<p>The <span class="highlight">quality</span> tells you the exact number of half steps:</p>
<p>For <b>2nds, 3rds, 6ths, and 7ths</b>, the quality is either <span class="highlight">major</span> (M) or <span class="highlight">minor</span> (m). Minor is always one half step smaller than major.</p>
<table style="width:100%; text-align:left; border-collapse:collapse; margin:0.5em 0;">
<tr><td style="padding:3px 8px;"><b>m2</b> = 1 half step</td><td><b>M2</b> = 2 half steps</td></tr>
<tr><td style="padding:3px 8px;"><b>m3</b> = 3 half steps</td><td><b>M3</b> = 4 half steps</td></tr>
<tr><td style="padding:3px 8px;"><b>m6</b> = 8 half steps</td><td><b>M6</b> = 9 half steps</td></tr>
<tr><td style="padding:3px 8px;"><b>m7</b> = 10 half steps</td><td><b>M7</b> = 11 half steps</td></tr>
</table>
<p><span class="mnemonic">Quick trick: If both notes are in the major scale of the lower note, it's a major interval.</span></p>`,
        render: null
      },
      {
        title: "Perfect Intervals",
        content: `<h3>Perfect Intervals</h3>
<p><b>4ths, 5ths, unisons, and octaves</b> use <span class="highlight">"perfect"</span> instead of major/minor:</p>
<table style="width:100%; text-align:left; border-collapse:collapse; margin:0.5em 0;">
<tr><td style="padding:3px 8px;"><b>P1</b> (perfect unison)</td><td>0 half steps</td></tr>
<tr><td style="padding:3px 8px;"><b>P4</b> (perfect 4th)</td><td>5 half steps</td></tr>
<tr><td style="padding:3px 8px;"><b>P5</b> (perfect 5th)</td><td>7 half steps</td></tr>
<tr><td style="padding:3px 8px;"><b>P8</b> (perfect octave)</td><td>12 half steps</td></tr>
</table>
<p>These are called "perfect" because they sound especially <span class="highlight">stable and consonant</span>.</p>
<p><span class="highlight">Augmented</span> = one half step wider than perfect. <span class="highlight">Diminished</span> = one half step narrower.</p>
<div class="staff-example" id="ch15-ex3"></div>
<p>Above: a perfect 4th (C\u2013F) and a perfect 5th (C\u2013G).</p>`,
        render(container) {
          const el = container.querySelector("#ch15-ex3");
          if (!el) return;
          const f = new Factory15({ renderer: { elementId: el.id, width: 300, height: 120 } });
          const s = f.EasyScore();
          f.System({ x: 0, y: 0, width: 260 }).addStave({ voices: [s.voice(s.notes("C4/h, F4/h, C4/h, G4/h"), { time: "4/2" })] }).addClef("treble");
          f.draw();
          const ctx = f.getContext();
          ctx.setFont("Times", 11, "bold");
          ctx.fillText("P4", 85, 110);
          ctx.fillText("P5", 195, 110);
        }
      },
      {
        title: "Why Intervals Matter",
        content: `<h3>Why Intervals Matter</h3>
<p>Intervals are the <span class="highlight">building blocks of everything</span> in music:</p>
<p>Melodies move by intervals \u2014 a tune is just a sequence of intervals. Chords are stacked intervals \u2014 a major triad is M3 + m3 (from Chapter 10, now you know the precise names).</p>
<p>Recognizing intervals helps you:</p>
<ul>
<li><b>Sight-read</b> faster \u2014 you see a 3rd on the staff and know the distance instantly</li>
<li><b>Train your ear</b> \u2014 the app's Interval Training mode builds this skill</li>
<li><b>Transpose</b> music \u2014 shift every interval by the same amount to change key</li>
</ul>
<p><span class="mnemonic">Everything in music \u2014 scales, chords, melodies, harmony \u2014 is built from intervals.</span></p>`
      }
    ],
    quizPool: [
      { id: "15-1", prompt: "C to E is what interval number?", render: null, options: ["2nd", "3rd", "4th", "5th"], correctIndex: 1 },
      { id: "15-2", prompt: "C to G is what interval number?", render: null, options: ["4th", "5th", "6th", "7th"], correctIndex: 1 },
      { id: "15-3", prompt: "How many half steps in a minor 3rd?", render: null, options: ["2", "3", "4", "5"], correctIndex: 1 },
      { id: "15-4", prompt: "How many half steps in a major 3rd?", render: null, options: ["2", "3", "4", "5"], correctIndex: 2 },
      { id: "15-5", prompt: "How many half steps in a perfect 5th?", render: null, options: ["5", "6", "7", "8"], correctIndex: 2 },
      { id: "15-6", prompt: "How many half steps in a perfect 4th?", render: null, options: ["4", "5", "6", "7"], correctIndex: 1 },
      { id: "15-7", prompt: "A major triad is built from which two intervals?", render: null, options: ["P4 + P5", "M3 + m3", "m3 + M3", "M2 + M2"], correctIndex: 1 },
      { id: "15-8", prompt: "What quality do 4ths and 5ths use?", render: null, options: ["Major/minor", "Perfect", "Augmented", "Diminished"], correctIndex: 1 },
      { id: "15-9", prompt: "C to A is what interval?", render: null, options: ["Minor 6th", "Major 6th", "Minor 7th", "Major 7th"], correctIndex: 1 },
      { id: "15-10", prompt: "If a perfect 5th is 7 half steps, a diminished 5th is:", render: null, options: ["6 half steps", "7 half steps", "8 half steps", "5 half steps"], correctIndex: 0 }
    ]
  };

  // src/chapters/ch16-circle-of-fifths.js
  var { Factory: Factory16 } = Vex.Flow;
  var ch16_circle_of_fifths_default = {
    id: 16,
    title: "Circle of Fifths",
    subtitle: "The map of all keys",
    pages: [
      {
        title: "What Is the Circle of Fifths?",
        content: `<h3>What Is the Circle of Fifths?</h3>
<p>The <span class="highlight">Circle of Fifths</span> is a visual diagram that arranges all 12 major keys in a circle.</p>
<p>Moving <b>clockwise</b>, each key is a <span class="highlight">perfect 5th</span> (7 half steps) higher than the last:</p>
<p style="text-align:center;">C \u2192 G \u2192 D \u2192 A \u2192 E \u2192 B \u2192 F\u266F/G\u266D \u2192 D\u266D \u2192 A\u266D \u2192 E\u266D \u2192 B\u266D \u2192 F \u2192 C</p>
<p>It's the single most useful diagram in music theory \u2014 a <span class="highlight">"map"</span> of how all keys relate to each other.</p>
<p><span class="mnemonic">Think of it as a clock: C is at 12 o'clock, and every hour clockwise adds a sharp.</span></p>`,
        render: null
      },
      {
        title: "Sharps Go Clockwise",
        content: `<h3>Sharps Go Clockwise</h3>
<p>Starting at C (no sharps or flats) and moving clockwise, each key adds <span class="highlight">one sharp</span>:</p>
<table style="width:100%; text-align:left; border-collapse:collapse; margin:0.5em 0;">
<tr><td style="padding:3px 8px;"><b>C</b></td><td>0 sharps</td></tr>
<tr><td style="padding:3px 8px;"><b>G</b></td><td>1 sharp (F\u266F)</td></tr>
<tr><td style="padding:3px 8px;"><b>D</b></td><td>2 sharps (F\u266F C\u266F)</td></tr>
<tr><td style="padding:3px 8px;"><b>A</b></td><td>3 sharps (F\u266F C\u266F G\u266F)</td></tr>
<tr><td style="padding:3px 8px;"><b>E</b></td><td>4 sharps</td></tr>
<tr><td style="padding:3px 8px;"><b>B</b></td><td>5 sharps</td></tr>
<tr><td style="padding:3px 8px;"><b>F\u266F</b></td><td>6 sharps</td></tr>
</table>
<p>Order of sharps: <span class="highlight">F\u266F C\u266F G\u266F D\u266F A\u266F E\u266F</span></p>
<div class="staff-example" id="ch16-ex1"></div>
<p>Above: G major (1 sharp) and D major (2 sharps) key signatures.</p>`,
        render(container) {
          const el = container.querySelector("#ch16-ex1");
          if (!el) return;
          const f = new Factory16({ renderer: { elementId: el.id, width: 300, height: 120 } });
          const s = f.EasyScore();
          const sys = f.System({ x: 0, y: 0, width: 260 });
          sys.addStave({ voices: [s.voice(s.notes("B4/w/r"))] }).addClef("treble").addKeySignature("G");
          f.draw();
          const el2 = document.createElement("div");
          el2.id = "ch16-ex1b";
          el.parentNode.insertBefore(el2, el.nextSibling);
          const f2 = new Factory16({ renderer: { elementId: el2.id, width: 300, height: 120 } });
          const s2 = f2.EasyScore();
          f2.System({ x: 0, y: 0, width: 260 }).addStave({ voices: [s2.voice(s2.notes("B4/w/r"))] }).addClef("treble").addKeySignature("D");
          f2.draw();
        }
      },
      {
        title: "Flats Go Counter-Clockwise",
        content: `<h3>Flats Go Counter-Clockwise</h3>
<p>Moving <b>counter-clockwise</b> from C, each key adds <span class="highlight">one flat</span>:</p>
<table style="width:100%; text-align:left; border-collapse:collapse; margin:0.5em 0;">
<tr><td style="padding:3px 8px;"><b>C</b></td><td>0 flats</td></tr>
<tr><td style="padding:3px 8px;"><b>F</b></td><td>1 flat (B\u266D)</td></tr>
<tr><td style="padding:3px 8px;"><b>B\u266D</b></td><td>2 flats (B\u266D E\u266D)</td></tr>
<tr><td style="padding:3px 8px;"><b>E\u266D</b></td><td>3 flats</td></tr>
<tr><td style="padding:3px 8px;"><b>A\u266D</b></td><td>4 flats</td></tr>
<tr><td style="padding:3px 8px;"><b>D\u266D</b></td><td>5 flats</td></tr>
<tr><td style="padding:3px 8px;"><b>G\u266D</b></td><td>6 flats</td></tr>
</table>
<p>Order of flats: <span class="highlight">B\u266D E\u266D A\u266D D\u266D G\u266D C\u266D</span> \u2014 it's the order of sharps <em>reversed</em>!</p>
<div class="staff-example" id="ch16-ex2"></div>
<p>Above: F major (1 flat) and B\u266D major (2 flats) key signatures.</p>`,
        render(container) {
          const el = container.querySelector("#ch16-ex2");
          if (!el) return;
          const f = new Factory16({ renderer: { elementId: el.id, width: 300, height: 120 } });
          const s = f.EasyScore();
          f.System({ x: 0, y: 0, width: 260 }).addStave({ voices: [s.voice(s.notes("B4/w/r"))] }).addClef("treble").addKeySignature("F");
          f.draw();
          const el2 = document.createElement("div");
          el2.id = "ch16-ex2b";
          el.parentNode.insertBefore(el2, el.nextSibling);
          const f2 = new Factory16({ renderer: { elementId: el2.id, width: 300, height: 120 } });
          const s2 = f2.EasyScore();
          f2.System({ x: 0, y: 0, width: 260 }).addStave({ voices: [s2.voice(s2.notes("B4/w/r"))] }).addClef("treble").addKeySignature("Bb");
          f2.draw();
        }
      },
      {
        title: "Relative Minors on the Circle",
        content: `<h3>Relative Minors on the Circle</h3>
<p>Each major key has a <span class="highlight">relative minor</span> that shares the same key signature (from Chapter 9).</p>
<p>On the Circle of Fifths, the relative minor sits on an inner ring \u2014 or equivalently, <b>3 positions clockwise</b> from the major key:</p>
<table style="width:100%; text-align:left; border-collapse:collapse; margin:0.5em 0;">
<tr><td style="padding:3px 8px;"><b>C major</b> \u2192 A minor</td><td>(0 sharps/flats)</td></tr>
<tr><td style="padding:3px 8px;"><b>G major</b> \u2192 E minor</td><td>(1 sharp)</td></tr>
<tr><td style="padding:3px 8px;"><b>F major</b> \u2192 D minor</td><td>(1 flat)</td></tr>
<tr><td style="padding:3px 8px;"><b>D major</b> \u2192 B minor</td><td>(2 sharps)</td></tr>
<tr><td style="padding:3px 8px;"><b>B\u266D major</b> \u2192 G minor</td><td>(2 flats)</td></tr>
</table>
<p><span class="mnemonic">Now you can see ALL relative major/minor pairs at once \u2014 the circle connects everything from Chapters 9, 11, and 15.</span></p>`,
        render: null
      },
      {
        title: "Using the Circle",
        content: `<h3>Using the Circle</h3>
<p>The Circle of Fifths is a practical tool you'll use constantly:</p>
<ul>
<li><b>Find a key signature:</b> count clockwise for sharps, counter-clockwise for flats</li>
<li><b>Find related keys:</b> neighbors on the circle differ by just one sharp or flat \u2014 they share the most notes</li>
<li><b>Understand progressions:</b> the V\u2192I resolution is one step <em>counter-clockwise</em>; chord progressions often move around the circle</li>
<li><b>I\u2011IV\u2011V chords:</b> in any key, IV is one step counter-clockwise, V is one step clockwise \u2014 they're always neighbors!</li>
</ul>
<p><span class="mnemonic">The Circle of Fifths is your "map" of music. Keys, scales, chords, progressions \u2014 it shows how everything connects.</span></p>`,
        render: null
      }
    ],
    quizPool: [
      { id: "16-1", prompt: "Moving clockwise on the Circle of Fifths, each key is a ___ higher:", render: null, options: ["Perfect 4th", "Perfect 5th", "Major 3rd", "Minor 3rd"], correctIndex: 1 },
      { id: "16-2", prompt: "How many sharps does G major have?", render: null, options: ["0", "1", "2", "3"], correctIndex: 1 },
      { id: "16-3", prompt: "How many sharps does D major have?", render: null, options: ["1", "2", "3", "4"], correctIndex: 1 },
      { id: "16-4", prompt: "How many flats does F major have?", render: null, options: ["0", "1", "2", "3"], correctIndex: 1 },
      { id: "16-5", prompt: "How many flats does B\u266D major have?", render: null, options: ["1", "2", "3", "4"], correctIndex: 1 },
      { id: "16-6", prompt: "The order of sharps begins with:", render: null, options: ["B\u266D E\u266D A\u266D", "F\u266F C\u266F G\u266F", "C\u266F F\u266F G\u266F", "G\u266F D\u266F A\u266F"], correctIndex: 1 },
      { id: "16-7", prompt: "The relative minor of G major is:", render: null, options: ["B minor", "D minor", "E minor", "A minor"], correctIndex: 2 },
      { id: "16-8", prompt: "On the circle, keys that are neighbors differ by:", render: null, options: ["3 sharps or flats", "2 sharps or flats", "1 sharp or flat", "No sharps or flats"], correctIndex: 2 },
      { id: "16-9", prompt: "Which key has 3 sharps?", render: null, options: ["G major", "D major", "A major", "E major"], correctIndex: 2 },
      { id: "16-10", prompt: "Moving counter-clockwise from C, the first key is:", render: null, options: ["G major", "F major", "D major", "B\u266D major"], correctIndex: 1 }
    ]
  };

  // src/chapters/ch17-seventh-chords.js
  var { Factory: Factory17 } = Vex.Flow;
  var ch17_seventh_chords_default = {
    id: 17,
    title: "Seventh Chords",
    subtitle: "Adding color to your chords",
    pages: [
      {
        title: "Beyond Triads",
        content: `<h3>Beyond Triads</h3>
<p>In Chapter 10, we built <span class="highlight">triads</span> \u2014 three-note chords (root, 3rd, 5th).</p>
<p>A <span class="highlight">seventh chord</span> adds one more note: the <b>7th above the root</b> \u2014 four notes total.</p>
<p>Seventh chords sound richer, more colorful, and often more "tense" than triads. They're essential in jazz, pop, blues, and classical music.</p>
<div class="staff-example" id="ch17-ex1a"></div>
<p>Above: C major triad (3 notes).</p>
<div class="staff-example" id="ch17-ex1b"></div>
<p>Above: C major seventh chord (4 notes) \u2014 hear how much richer it sounds?</p>`,
        render(container) {
          const el1 = container.querySelector("#ch17-ex1a");
          if (el1) {
            const f = new Factory17({ renderer: { elementId: el1.id, width: 200, height: 120 } });
            const s = f.EasyScore();
            f.System({ x: 0, y: 0, width: 160 }).addStave({ voices: [s.voice(s.notes("(C4 E4 G4)/w"))] }).addClef("treble");
            f.draw();
          }
          const el2 = container.querySelector("#ch17-ex1b");
          if (el2) {
            const f = new Factory17({ renderer: { elementId: el2.id, width: 200, height: 120 } });
            const s = f.EasyScore();
            f.System({ x: 0, y: 0, width: 160 }).addStave({ voices: [s.voice(s.notes("(C4 E4 G4 B4)/w"))] }).addClef("treble");
            f.draw();
          }
        }
      },
      {
        title: "Major Seventh Chords",
        content: `<h3>Major Seventh Chords</h3>
<p>A <span class="highlight">major seventh chord</span> (Cmaj7) = major triad + <b>major 7th</b> on top.</p>
<p>Formula: Root + M3 + m3 + M3</p>
<p><b>Cmaj7 = C\u2013E\u2013G\u2013B</b> (the B is 11 half steps above C \u2014 a major 7th)</p>
<p>Sound: <em>dreamy, smooth, sophisticated</em> \u2014 common in jazz and bossa nova.</p>
<div class="staff-example" id="ch17-ex2"></div>
<p>Above: Cmaj7 \u2014 notice the B sitting just a half step below the octave C.</p>`,
        render(container) {
          const el = container.querySelector("#ch17-ex2");
          if (!el) return;
          const f = new Factory17({ renderer: { elementId: el.id, width: 200, height: 120 } });
          const s = f.EasyScore();
          f.System({ x: 0, y: 0, width: 160 }).addStave({ voices: [s.voice(s.notes("(C4 E4 G4 B4)/w"))] }).addClef("treble");
          f.draw();
        }
      },
      {
        title: "Dominant Seventh Chords",
        content: `<h3>Dominant Seventh Chords</h3>
<p>A <span class="highlight">dominant seventh chord</span> (C7) = major triad + <b>minor 7th</b> on top.</p>
<p>Formula: Root + M3 + m3 + m3</p>
<p><b>C7 = C\u2013E\u2013G\u2013B\u266D</b> (the B\u266D is 10 half steps above C \u2014 a minor 7th)</p>
<p>Sound: <em>strong, tense, wants to resolve</em> \u2014 the "engine" of V\u2192I progressions.</p>
<p>The <span class="highlight">V7\u2192I</span> progression is the strongest resolution in music (e.g., G7\u2192C in the key of C).</p>
<div class="staff-example" id="ch17-ex3"></div>
<p>Above: C7 \u2014 compare with Cmaj7: only one note different (B\u266D vs B).</p>`,
        render(container) {
          const el = container.querySelector("#ch17-ex3");
          if (!el) return;
          const f = new Factory17({ renderer: { elementId: el.id, width: 200, height: 120 } });
          const s = f.EasyScore();
          f.System({ x: 0, y: 0, width: 160 }).addStave({ voices: [s.voice(s.notes("(C4 E4 G4 Bb4)/w"))] }).addClef("treble");
          f.draw();
        }
      },
      {
        title: "Minor Seventh Chords",
        content: `<h3>Minor Seventh Chords</h3>
<p>A <span class="highlight">minor seventh chord</span> (Cm7) = minor triad + <b>minor 7th</b> on top.</p>
<p>Formula: Root + m3 + M3 + m3</p>
<p><b>Cm7 = C\u2013E\u266D\u2013G\u2013B\u266D</b></p>
<p><b>Am7 = A\u2013C\u2013E\u2013G</b> (all white keys \u2014 try it on the piano!)</p>
<p>Sound: <em>mellow, warm</em> \u2014 the workhorse of jazz and R&amp;B.</p>
<p>The <span class="highlight">ii\u2013V\u2013I</span> progression in jazz uses all seventh chords: <b>Dm7 \u2192 G7 \u2192 Cmaj7</b></p>
<div class="staff-example" id="ch17-ex4"></div>
<p>Above: Am7 \u2014 four white keys, one of the easiest seventh chords to play.</p>`,
        render(container) {
          const el = container.querySelector("#ch17-ex4");
          if (!el) return;
          const f = new Factory17({ renderer: { elementId: el.id, width: 200, height: 120 } });
          const s = f.EasyScore();
          f.System({ x: 0, y: 0, width: 160 }).addStave({ voices: [s.voice(s.notes("(A3 C4 E4 G4)/w"))] }).addClef("treble");
          f.draw();
        }
      },
      {
        title: "Recognizing Seventh Chords",
        content: `<h3>Recognizing Seventh Chords</h3>
<p>Here are the three main types to know:</p>
<table style="width:100%; text-align:left; border-collapse:collapse; margin:0.5em 0;">
<tr><td style="padding:4px 8px;"><b>maj7</b></td><td>Major triad + major 7th</td><td><em>Dreamy</em></td><td>Cmaj7 or C\u03947</td></tr>
<tr><td style="padding:4px 8px;"><b>7</b> (dom.)</td><td>Major triad + minor 7th</td><td><em>Tense, resolves</em></td><td>C7</td></tr>
<tr><td style="padding:4px 8px;"><b>m7</b></td><td>Minor triad + minor 7th</td><td><em>Mellow</em></td><td>Cm7 or C\u20137</td></tr>
</table>
<p>There's also the <b>dim7</b> (diminished seventh) \u2014 we'll save that for later.</p>
<p><span class="mnemonic">When you see chord symbols like Dm7\u2013G7\u2013Cmaj7, you now know exactly what notes to play!</span></p>`,
        render: null
      }
    ],
    quizPool: [
      { id: "17-1", prompt: "A seventh chord has how many notes?", render: null, options: ["2", "3", "4", "5"], correctIndex: 2 },
      { id: "17-2", prompt: "What notes make up Cmaj7?", render: null, options: ["C\u2013E\u2013G\u2013B\u266D", "C\u2013E\u266D\u2013G\u2013B\u266D", "C\u2013E\u2013G\u2013B", "C\u2013E\u266D\u2013G\u2013B"], correctIndex: 2 },
      { id: "17-3", prompt: "What notes make up C7 (dominant seventh)?", render: null, options: ["C\u2013E\u2013G\u2013B", "C\u2013E\u2013G\u2013B\u266D", "C\u2013E\u266D\u2013G\u2013B\u266D", "C\u2013E\u266D\u2013G\u2013B"], correctIndex: 1 },
      { id: "17-4", prompt: "A dominant seventh chord has a ___ 7th on top:", render: null, options: ["Major", "Minor", "Perfect", "Diminished"], correctIndex: 1 },
      { id: "17-5", prompt: "A major seventh chord has a ___ 7th on top:", render: null, options: ["Major", "Minor", "Perfect", "Augmented"], correctIndex: 0 },
      { id: "17-6", prompt: "Which chord wants to resolve most strongly?", render: null, options: ["Cmaj7", "Cm7", "C7 (dominant)", "C minor triad"], correctIndex: 2 },
      { id: "17-7", prompt: "What notes make up Am7?", render: null, options: ["A\u2013C\u266F\u2013E\u2013G", "A\u2013C\u2013E\u2013G\u266F", "A\u2013C\u2013E\u2013G", "A\u2013C\u266F\u2013E\u2013G\u266F"], correctIndex: 2 },
      { id: "17-8", prompt: "The ii\u2013V\u2013I in C major is:", render: null, options: ["Dm\u2013G\u2013C", "Dm7\u2013G7\u2013Cmaj7", "Cm7\u2013F7\u2013B\u266Dmaj7", "Em7\u2013A7\u2013Dmaj7"], correctIndex: 1 },
      { id: "17-9", prompt: "How many half steps from C to B (major 7th)?", render: null, options: ["10", "11", "12", "9"], correctIndex: 1 },
      { id: "17-10", prompt: "How many half steps from C to B\u266D (minor 7th)?", render: null, options: ["9", "10", "11", "12"], correctIndex: 1 }
    ]
  };

  // src/chapters/index.js
  var NOTATION_CHAPTERS = [ch01_staff_and_clefs_default, ch02_notes_on_staff_default, ch03_note_values_default, ch04_rests_default, ch05_time_signatures_default, ch06_key_signatures_and_accidentals_default, ch07_half_steps_and_whole_steps_default, ch08_major_scale_default, ch09_minor_scale_default, ch10_chords_default, ch11_chord_progressions_default, ch12_dynamics_and_articulation_default, ch13_tempo_and_expression_default, ch14_repeat_signs_default, ch15_intervals_in_depth_default, ch16_circle_of_fifths_default, ch17_seventh_chords_default];

  // src/data/constants.js
  var STORAGE_KEY = "pianoTrainerProgress";

  // src/data/levels.js
  var DIFFICULTY_LEVELS = [
    { name: "C Position", notes: ["C4", "E4", "G4"], threshold: 0.8, minAttempts: 3 },
    { name: "C Position+", notes: ["C4", "D4", "E4", "F4", "G4"], threshold: 0.8, minAttempts: 3 },
    { name: "Full Treble Octave", notes: ["C4", "D4", "E4", "F4", "G4", "A4", "B4"], threshold: 0.8, minAttempts: 3 },
    { name: "Bass C Position", notes: ["C3", "E3", "G3"], threshold: 0.8, minAttempts: 3 },
    { name: "Bass C Position+", notes: ["C3", "D3", "E3", "F3", "G3"], threshold: 0.8, minAttempts: 3 },
    { name: "Both Clefs Basic", notes: ["C3", "E3", "G3", "C4", "E4", "G4"], threshold: 0.8, minAttempts: 4 },
    { name: "Both Clefs Expanded", notes: ["C3", "D3", "E3", "F3", "G3", "C4", "D4", "E4", "F4", "G4"], threshold: 0.8, minAttempts: 4 },
    { name: "Full Range", notes: ["G2", "A2", "B2", "C3", "D3", "E3", "F3", "G3", "C4", "D4", "E4", "F4", "G4", "A4", "B4"], threshold: 0.8, minAttempts: 3 },
    { name: "High Treble", notes: ["G2", "A2", "B2", "C3", "D3", "E3", "F3", "G3", "C4", "D4", "E4", "F4", "G4", "A4", "B4", "C5", "D5", "E5"], threshold: 0.75, minAttempts: 3 },
    { name: "Ledger Lines", notes: ["G2", "A2", "B2", "C3", "D3", "E3", "F3", "G3", "A3", "B3", "C4", "D4", "E4", "F4", "G4", "A4", "B4", "C5", "D5", "E5"], threshold: 0.75, minAttempts: 3 },
    { name: "Accidentals", notes: ["C4", "C#4", "D4", "D#4", "E4", "F4", "F#4", "G4", "G#4", "A4", "A#4", "B4"], threshold: 0.75, minAttempts: 3 }
  ];
  var ALL_NOTES = [...new Set(DIFFICULTY_LEVELS.flatMap((l) => l.notes))];

  // src/data/intervals.js
  var INTERVALS = {
    "m2": { semitones: 1, name: "Minor 2nd" },
    "M2": { semitones: 2, name: "Major 2nd" },
    "m3": { semitones: 3, name: "Minor 3rd" },
    "M3": { semitones: 4, name: "Major 3rd" },
    "P4": { semitones: 5, name: "Perfect 4th" },
    "TT": { semitones: 6, name: "Tritone" },
    "P5": { semitones: 7, name: "Perfect 5th" },
    "m6": { semitones: 8, name: "Minor 6th" },
    "M6": { semitones: 9, name: "Major 6th" },
    "m7": { semitones: 10, name: "Minor 7th" },
    "M7": { semitones: 11, name: "Major 7th" },
    "P8": { semitones: 12, name: "Octave" }
  };
  var INTERVAL_LEVELS = [
    { name: "Perfect Intervals", intervals: ["P4", "P5", "P8"], threshold: 0.8, minAttempts: 3 },
    { name: "Major Intervals", intervals: ["M2", "M3", "P4", "P5", "P8"], threshold: 0.75, minAttempts: 3 },
    { name: "Minor Intervals", intervals: ["m2", "M2", "m3", "M3", "P4", "P5"], threshold: 0.75, minAttempts: 2 },
    { name: "All Simple", intervals: ["m2", "M2", "m3", "M3", "P4", "TT", "P5"], threshold: 0.7, minAttempts: 2 },
    { name: "Extended", intervals: ["m2", "M2", "m3", "M3", "P4", "TT", "P5", "m6", "M6"], threshold: 0.7, minAttempts: 2 },
    { name: "All Intervals", intervals: ["m2", "M2", "m3", "M3", "P4", "TT", "P5", "m6", "M6", "m7", "M7", "P8"], threshold: 0.7, minAttempts: 2 }
  ];
  var ALL_INTERVALS = [...new Set(INTERVAL_LEVELS.flatMap((l) => l.intervals))];

  // src/data/keysigs.js
  var KEY_SIGNATURES = {
    "C": { sharps: 0, flats: 0, name: "C Major", vexKey: "C" },
    "G": { sharps: 1, flats: 0, name: "G Major", vexKey: "G" },
    "D": { sharps: 2, flats: 0, name: "D Major", vexKey: "D" },
    "A": { sharps: 3, flats: 0, name: "A Major", vexKey: "A" },
    "E": { sharps: 4, flats: 0, name: "E Major", vexKey: "E" },
    "B": { sharps: 5, flats: 0, name: "B Major", vexKey: "B" },
    "F#": { sharps: 6, flats: 0, name: "F# Major", vexKey: "F#" },
    "F": { sharps: 0, flats: 1, name: "F Major", vexKey: "F" },
    "Bb": { sharps: 0, flats: 2, name: "Bb Major", vexKey: "Bb" },
    "Eb": { sharps: 0, flats: 3, name: "Eb Major", vexKey: "Eb" },
    "Ab": { sharps: 0, flats: 4, name: "Ab Major", vexKey: "Ab" },
    "Db": { sharps: 0, flats: 5, name: "Db Major", vexKey: "Db" },
    "Gb": { sharps: 0, flats: 6, name: "Gb Major", vexKey: "Gb" }
  };
  var KEYSIG_LEVELS = [
    { name: "No Accidentals", keys: ["C", "G", "F"], threshold: 0.8, minAttempts: 3 },
    { name: "One Sharp/Flat", keys: ["C", "G", "F", "D", "Bb"], threshold: 0.8, minAttempts: 3 },
    { name: "Two Sharps/Flats", keys: ["C", "G", "D", "A", "F", "Bb", "Eb"], threshold: 0.75, minAttempts: 2 },
    { name: "Three Sharps/Flats", keys: ["C", "G", "D", "A", "E", "F", "Bb", "Eb", "Ab"], threshold: 0.75, minAttempts: 2 },
    { name: "All Keys", keys: ["C", "G", "D", "A", "E", "B", "F#", "F", "Bb", "Eb", "Ab", "Db", "Gb"], threshold: 0.7, minAttempts: 2 }
  ];
  var ALL_KEYSIGS = [...new Set(KEYSIG_LEVELS.flatMap((l) => l.keys))];

  // src/data/cof.js
  var COF_DATA = {
    "C": { sharps: 0, flats: 0, fifthUp: "G", fourthUp: "F", relMinor: "Am", I: "C", IV: "F", V: "G" },
    "G": { sharps: 1, flats: 0, fifthUp: "D", fourthUp: "C", relMinor: "Em", I: "G", IV: "C", V: "D" },
    "D": { sharps: 2, flats: 0, fifthUp: "A", fourthUp: "G", relMinor: "Bm", I: "D", IV: "G", V: "A" },
    "A": { sharps: 3, flats: 0, fifthUp: "E", fourthUp: "D", relMinor: "F#m", I: "A", IV: "D", V: "E" },
    "E": { sharps: 4, flats: 0, fifthUp: "B", fourthUp: "A", relMinor: "C#m", I: "E", IV: "A", V: "B" },
    "B": { sharps: 5, flats: 0, fifthUp: "F#", fourthUp: "E", relMinor: "G#m", I: "B", IV: "E", V: "F#" },
    "F#": { sharps: 6, flats: 0, fifthUp: "Db", fourthUp: "B", relMinor: "D#m", I: "F#", IV: "B", V: "C#" },
    "Db": { sharps: 0, flats: 5, fifthUp: "Ab", fourthUp: "Gb", relMinor: "Bbm", I: "Db", IV: "Gb", V: "Ab" },
    "Ab": { sharps: 0, flats: 4, fifthUp: "Eb", fourthUp: "Db", relMinor: "Fm", I: "Ab", IV: "Db", V: "Eb" },
    "Eb": { sharps: 0, flats: 3, fifthUp: "Bb", fourthUp: "Ab", relMinor: "Cm", I: "Eb", IV: "Ab", V: "Bb" },
    "Bb": { sharps: 0, flats: 2, fifthUp: "F", fourthUp: "Eb", relMinor: "Gm", I: "Bb", IV: "Eb", V: "F" },
    "F": { sharps: 0, flats: 1, fifthUp: "C", fourthUp: "Bb", relMinor: "Dm", I: "F", IV: "Bb", V: "C" }
  };
  var COF_KEYS = Object.keys(COF_DATA);
  var COF_LEVELS = [
    { name: "Fifths Up", items: COF_KEYS.map((k) => `fifth_up_${k}`), threshold: 0.8, minAttempts: 3 },
    { name: "Fourths Up", items: COF_KEYS.map((k) => `fourth_up_${k}`), threshold: 0.8, minAttempts: 3 },
    { name: "Sharps & Flats", items: COF_KEYS.map((k) => `sig_${k}`), threshold: 0.8, minAttempts: 3 },
    { name: "Relative Minors", items: COF_KEYS.flatMap((k) => [`rel_minor_${k}`, `rel_major_${k}`]), threshold: 0.8, minAttempts: 3 },
    { name: "I-IV-V Chords", items: ["C", "G", "D", "A", "F", "Bb", "Eb"].flatMap((k) => [`chord_I_${k}`, `chord_IV_${k}`, `chord_V_${k}`]), threshold: 0.8, minAttempts: 3 },
    { name: "Full Circle", items: null, threshold: 0.8, minAttempts: 2 }
  ];
  COF_LEVELS[5].items = COF_LEVELS.slice(0, 5).flatMap((l) => l.items);
  var ALL_COF_ITEMS = [...new Set(COF_LEVELS.flatMap((l) => l.items))];

  // src/app/audio.js
  var NOTE_ORDER = ["C", "C#", "D", "D#", "E", "F", "F#", "G", "G#", "A", "A#", "B"];
  function noteToMidi(noteStr) {
    const parsed = parseNote(noteStr);
    if (!parsed) return 0;
    const noteName = parsed.name + parsed.accidental;
    const idx = NOTE_ORDER.indexOf(noteName);
    return (parsed.octave + 1) * 12 + idx;
  }
  function midiToNote(midi) {
    const octave = Math.floor(midi / 12) - 1;
    const idx = midi % 12;
    return NOTE_ORDER[idx] + octave;
  }
  var SAMPLE_BASE_URL = "https://tonejs.github.io/audio/salamander/";
  var piano = new Tone.Sampler({
    urls: {
      A0: "A0.mp3",
      C1: "C1.mp3",
      "D#1": "Ds1.mp3",
      "F#1": "Fs1.mp3",
      A1: "A1.mp3",
      C2: "C2.mp3",
      "D#2": "Ds2.mp3",
      "F#2": "Fs2.mp3",
      A2: "A2.mp3",
      C3: "C3.mp3",
      "D#3": "Ds3.mp3",
      "F#3": "Fs3.mp3",
      A3: "A3.mp3",
      C4: "C4.mp3",
      "D#4": "Ds4.mp3",
      "F#4": "Fs4.mp3",
      A4: "A4.mp3",
      C5: "C5.mp3",
      "D#5": "Ds5.mp3",
      "F#5": "Fs5.mp3",
      A5: "A5.mp3",
      C6: "C6.mp3",
      "D#6": "Ds6.mp3",
      "F#6": "Fs6.mp3",
      A6: "A6.mp3",
      C7: "C7.mp3",
      "D#7": "Ds7.mp3",
      C8: "C8.mp3"
    },
    release: 1,
    baseUrl: SAMPLE_BASE_URL
  }).toDestination();
  piano.onsampleload = () => {
  };
  Tone.loaded().then(() => {
    state_default.pianoLoaded = true;
  });
  function playNote(noteName, octave) {
    if (!state_default.pianoLoaded) return;
    piano.triggerAttackRelease(`${noteName}${octave}`, "4n");
  }
  function playNoteStr(noteStr) {
    const parsed = parseNote(noteStr);
    if (parsed) playNote(parsed.name + parsed.accidental, parsed.octave);
  }
  function startNoteStr(noteStr) {
    const parsed = parseNote(noteStr);
    if (parsed && state_default.pianoLoaded) {
      piano.triggerAttack(`${parsed.name}${parsed.accidental}${parsed.octave}`);
    }
  }
  function stopNoteStr(noteStr) {
    const parsed = parseNote(noteStr);
    if (parsed && state_default.pianoLoaded) {
      piano.triggerRelease(`${parsed.name}${parsed.accidental}${parsed.octave}`);
    }
  }
  function parseNote(noteStr) {
    const match = noteStr.match(/^([A-G])(#|b)?(\d)$/);
    if (!match) return null;
    return {
      name: match[1],
      accidental: match[2] || "",
      octave: parseInt(match[3]),
      full: noteStr
    };
  }
  function getClefForNote(noteStr) {
    const parsed = parseNote(noteStr);
    if (!parsed) return "treble";
    if (parsed.octave >= 4) return "treble";
    return "bass";
  }
  function levelHasBothClefs() {
    if (state_default.quizMode === "interval" || state_default.quizMode === "keysig") return false;
    const notes = getActiveNotes();
    let hasTreble = false, hasBass = false;
    for (const n of notes) {
      const clef = getClefForNote(n);
      if (clef === "treble") hasTreble = true;
      else hasBass = true;
      if (hasTreble && hasBass) return true;
    }
    return false;
  }
  function getKeyboardRange() {
    const activeNotes = getActiveNotes();
    let minOctave = 9, maxOctave = 0;
    for (const noteStr of activeNotes) {
      const parsed = parseNote(noteStr);
      if (parsed) {
        minOctave = Math.min(minOctave, parsed.octave);
        maxOctave = Math.max(maxOctave, parsed.octave);
      }
    }
    if (minOctave > maxOctave) {
      minOctave = 4;
      maxOctave = 4;
    }
    return { start: minOctave, end: maxOctave };
  }

  // src/app/quiz.js
  var { Factory: Factory18 } = Vex.Flow;
  function beginQuiz() {
    document.getElementById("start-btn").style.display = "none";
    document.getElementById("level-complete").style.display = "none";
    renderQuizNote(pickNextNote());
  }
  function pickNextNote() {
    if (state_default.quizMode === "interval") {
      return generateInterval();
    }
    if (state_default.quizMode === "keysig") {
      return generateKeySig();
    }
    if (state_default.quizMode === "circle") {
      return generateCofQuestion();
    }
    const progress = getCurrentProgress();
    const activeNotes = getActiveNotes();
    progress.roundNumber++;
    const candidates = activeNotes.filter((note) => note !== state_default.currentNote).map((note) => {
      if (!progress.noteMemory[note]) {
        progress.noteMemory[note] = { easiness: 2.5, interval: 1, repetitions: 0, lastSeen: 0, priority: 1 };
      }
      const mem = progress.noteMemory[note];
      const roundsSince = progress.roundNumber - mem.lastSeen;
      const isDue = roundsSince >= mem.interval;
      let score = mem.priority;
      if (isDue) score += 10;
      if (roundsSince > mem.interval * 2) score += 5;
      score += Math.random() * 0.5;
      return { note, score };
    }).sort((a, b) => b.score - a.score);
    state_default.currentNote = candidates[0].note;
    state_default.firstAttempt = true;
    return state_default.currentNote;
  }
  function renderQuizNote(noteStr) {
    try {
      const staffDiv = document.getElementById("staff");
      staffDiv.innerHTML = "";
      if (state_default.quizMode === "interval") {
        staffDiv.innerHTML = '<div id="audio-prompt">&#x1F50A; Interval</div>';
        document.getElementById("replay-btn").style.display = "inline-block";
        playCurrentInterval();
        state_default.noteDisplayTime = Date.now();
        return;
      }
      if (state_default.quizMode === "keysig") {
        document.getElementById("replay-btn").style.display = "none";
        const keySig = KEY_SIGNATURES[state_default.currentKeySig];
        const containerWidth2 = Math.min(window.innerWidth * 0.9, 400);
        const staffWidth2 = Math.max(containerWidth2 - 40, 140);
        const staffHeight2 = Math.min(150, Math.max(window.innerWidth * 0.35, 100));
        const factory2 = new Factory18({
          renderer: { elementId: "staff", width: containerWidth2, height: staffHeight2 }
        });
        const score2 = factory2.EasyScore();
        const system2 = factory2.System({ x: 0, y: 0, width: staffWidth2 });
        const voice = score2.voice(score2.notes("B4/w/r", { clef: "treble" }));
        system2.addStave({ voices: [voice] }).addClef("treble").addKeySignature(keySig.vexKey);
        factory2.draw();
        state_default.noteDisplayTime = Date.now();
        return;
      }
      if (state_default.quizMode === "circle") {
        document.getElementById("replay-btn").style.display = "none";
        staffDiv.innerHTML = `<div id="note-prompt">${state_default.currentCofPrompt}</div>`;
        state_default.noteDisplayTime = Date.now();
        return;
      }
      const parsed = parseNote(noteStr);
      if (!parsed) return;
      if (state_default.quizMode === "audio") {
        staffDiv.innerHTML = '<div id="audio-prompt">&#x1F50A;</div>';
        document.getElementById("replay-btn").style.display = "inline-block";
        playNoteStr(noteStr);
        state_default.noteDisplayTime = Date.now();
        return;
      }
      if (state_default.quizMode === "reverse") {
        staffDiv.innerHTML = `<div id="note-prompt">${noteStr}</div>`;
        document.getElementById("replay-btn").style.display = "none";
        state_default.noteDisplayTime = Date.now();
        return;
      }
      document.getElementById("replay-btn").style.display = "none";
      const clef = getClefForNote(noteStr);
      const vexNote = `${parsed.name}${parsed.accidental}${parsed.octave}/w`;
      const useGrandStaff = levelHasBothClefs();
      const containerWidth = Math.min(window.innerWidth * 0.9, 400);
      const staffWidth = Math.max(containerWidth - 40, 140);
      const staffHeight = useGrandStaff ? Math.min(250, Math.max(window.innerHeight * 0.28, 180)) : Math.min(150, Math.max(window.innerWidth * 0.35, 100));
      const factory = new Factory18({
        renderer: { elementId: "staff", width: containerWidth, height: staffHeight }
      });
      const score = factory.EasyScore();
      const system = factory.System({ x: 0, y: 0, width: staffWidth });
      if (useGrandStaff) {
        const trebleNotes = clef === "treble" ? vexNote : "B4/w/r";
        const bassNotes = clef === "bass" ? vexNote : "D3/w/r";
        const trebleVoice = score.voice(score.notes(trebleNotes, { clef: "treble" }));
        const bassVoice = score.voice(score.notes(bassNotes, { clef: "bass" }));
        system.addStave({ voices: [trebleVoice] }).addClef("treble");
        system.addStave({ voices: [bassVoice] }).addClef("bass");
        system.addConnector("brace");
        system.addConnector("singleLeft");
      } else {
        const voice = score.voice(score.notes(vexNote, { clef }));
        system.addStave({ voices: [voice] }).addClef(clef);
      }
      factory.draw();
      state_default.noteDisplayTime = Date.now();
    } catch (error) {
      console.error("Error rendering note:", error);
    }
  }
  function replayCurrentNote() {
    if (state_default.quizMode === "interval" && state_default.currentInterval) {
      playCurrentInterval();
    } else if (state_default.currentNote && (state_default.quizMode === "audio" || state_default.quizMode === "reverse")) {
      playNoteStr(state_default.currentNote);
    }
  }
  function generateInterval() {
    const progress = getCurrentProgress();
    const activeIntervals = getActiveNotes();
    progress.roundNumber++;
    const candidates = activeIntervals.filter((iv) => !state_default.currentInterval || iv !== state_default.currentInterval.interval).map((iv) => {
      if (!progress.noteMemory[iv]) {
        progress.noteMemory[iv] = { easiness: 2.5, interval: 1, repetitions: 0, lastSeen: 0, priority: 1 };
      }
      const mem = progress.noteMemory[iv];
      const roundsSince = progress.roundNumber - mem.lastSeen;
      const isDue = roundsSince >= mem.interval;
      let score = mem.priority;
      if (isDue) score += 10;
      if (roundsSince > mem.interval * 2) score += 5;
      score += Math.random() * 0.5;
      return { interval: iv, score };
    }).sort((a, b) => b.score - a.score);
    const chosenInterval = candidates[0].interval;
    const semitones = INTERVALS[chosenInterval].semitones;
    const minMidi = noteToMidi("C3");
    const maxMidi = noteToMidi("C5");
    const rootMidi = minMidi + Math.floor(Math.random() * (maxMidi - minMidi - semitones + 1));
    const targetMidi = rootMidi + semitones;
    state_default.currentInterval = {
      root: midiToNote(rootMidi),
      target: midiToNote(targetMidi),
      interval: chosenInterval
    };
    state_default.currentNote = chosenInterval;
    state_default.firstAttempt = true;
    return chosenInterval;
  }
  function playCurrentInterval() {
    if (!state_default.currentInterval) return;
    playNoteStr(state_default.currentInterval.root);
    setTimeout(() => playNoteStr(state_default.currentInterval.target), 600);
  }
  function buildIntervalButtons() {
    const container = document.getElementById("interval-buttons");
    container.innerHTML = "";
    container.style.display = "flex";
    const activeIntervals = getActiveNotes();
    for (const iv of activeIntervals) {
      const btn = document.createElement("button");
      btn.className = "interval-btn";
      btn.textContent = INTERVALS[iv].name;
      btn.dataset.interval = iv;
      btn.addEventListener("click", () => handleIntervalClick(iv, btn));
      btn.addEventListener("touchstart", (e) => {
        e.preventDefault();
        handleIntervalClick(iv, btn);
      }, { passive: false });
      container.appendChild(btn);
    }
  }
  function handleIntervalClick(intervalName, btnElement) {
    if (state_default.isProcessingClick || !state_default.currentInterval) return;
    const responseTime = Date.now() - state_default.noteDisplayTime;
    if (intervalName === state_default.currentInterval.interval) {
      state_default.isProcessingClick = true;
      recordAttempt(state_default.currentInterval.interval, true, responseTime);
      btnElement.classList.add("correct");
      showFeedback(true, INTERVALS[state_default.currentInterval.interval].name);
      setTimeout(() => {
        btnElement.classList.remove("correct");
        generateInterval();
        renderQuizNote(state_default.currentNote);
        state_default.isProcessingClick = false;
      }, 400);
    } else {
      recordAttempt(state_default.currentInterval.interval, false, responseTime);
      btnElement.classList.add("wrong");
      showFeedback(false, INTERVALS[state_default.currentInterval.interval].name);
      setTimeout(() => btnElement.classList.remove("wrong"), 200);
    }
  }
  function generateKeySig() {
    const progress = getCurrentProgress();
    const activeKeys = getActiveNotes();
    progress.roundNumber++;
    const candidates = activeKeys.filter((k) => k !== state_default.currentKeySig).map((k) => {
      if (!progress.noteMemory[k]) {
        progress.noteMemory[k] = { easiness: 2.5, interval: 1, repetitions: 0, lastSeen: 0, priority: 1 };
      }
      const mem = progress.noteMemory[k];
      const roundsSince = progress.roundNumber - mem.lastSeen;
      const isDue = roundsSince >= mem.interval;
      let score = mem.priority;
      if (isDue) score += 10;
      if (roundsSince > mem.interval * 2) score += 5;
      score += Math.random() * 0.5;
      return { key: k, score };
    }).sort((a, b) => b.score - a.score);
    state_default.currentKeySig = candidates[0].key;
    state_default.currentNote = state_default.currentKeySig;
    state_default.firstAttempt = true;
    return state_default.currentKeySig;
  }
  function buildKeySigButtons() {
    const container = document.getElementById("keysig-buttons");
    container.innerHTML = "";
    container.style.display = "flex";
    const activeKeys = getActiveNotes();
    for (const k of activeKeys) {
      const btn = document.createElement("button");
      btn.className = "interval-btn";
      btn.textContent = KEY_SIGNATURES[k].name;
      btn.dataset.key = k;
      btn.addEventListener("click", () => handleKeySigClick(k, btn));
      btn.addEventListener("touchstart", (e) => {
        e.preventDefault();
        handleKeySigClick(k, btn);
      }, { passive: false });
      container.appendChild(btn);
    }
  }
  function handleKeySigClick(keyName, btnElement) {
    if (state_default.isProcessingClick || !state_default.currentKeySig) return;
    const responseTime = Date.now() - state_default.noteDisplayTime;
    if (keyName === state_default.currentKeySig) {
      state_default.isProcessingClick = true;
      recordAttempt(state_default.currentKeySig, true, responseTime);
      btnElement.classList.add("correct");
      showFeedback(true, KEY_SIGNATURES[state_default.currentKeySig].name);
      setTimeout(() => {
        btnElement.classList.remove("correct");
        generateKeySig();
        renderQuizNote(state_default.currentNote);
        state_default.isProcessingClick = false;
      }, 400);
    } else {
      recordAttempt(state_default.currentKeySig, false, responseTime);
      btnElement.classList.add("wrong");
      showFeedback(false, KEY_SIGNATURES[state_default.currentKeySig].name);
      setTimeout(() => btnElement.classList.remove("wrong"), 200);
    }
  }
  function generateCofQuestion() {
    const progress = getCurrentProgress();
    const activeItems = getActiveNotes();
    progress.roundNumber++;
    const candidates = activeItems.filter((item) => item !== state_default.currentCofItem).map((item) => {
      if (!progress.noteMemory[item]) {
        progress.noteMemory[item] = { easiness: 2.5, interval: 1, repetitions: 0, lastSeen: 0, priority: 1 };
      }
      const mem = progress.noteMemory[item];
      const roundsSince = progress.roundNumber - mem.lastSeen;
      const isDue = roundsSince >= mem.interval;
      let score = mem.priority;
      if (isDue) score += 10;
      if (roundsSince > mem.interval * 2) score += 5;
      score += Math.random() * 0.5;
      return { item, score };
    }).sort((a, b) => b.score - a.score);
    state_default.currentCofItem = candidates[0].item;
    state_default.firstAttempt = true;
    const parts = state_default.currentCofItem.split("_");
    const type = parts.slice(0, -1).join("_");
    const key = parts[parts.length - 1];
    const data = COF_DATA[key];
    let prompt, answer, distractorPool;
    if (type === "fifth_up") {
      prompt = `What key is a 5th above ${key}?`;
      answer = data.fifthUp;
      distractorPool = COF_KEYS.filter((k) => k !== answer);
    } else if (type === "fourth_up") {
      prompt = `What key is a 4th above ${key}?`;
      answer = data.fourthUp;
      distractorPool = COF_KEYS.filter((k) => k !== answer);
    } else if (type === "sig") {
      if (data.sharps > 0) {
        prompt = `How many sharps in ${key} major?`;
        answer = String(data.sharps);
        distractorPool = ["0", "1", "2", "3", "4", "5", "6"].filter((n) => n !== answer);
      } else if (data.flats > 0) {
        prompt = `How many flats in ${key} major?`;
        answer = String(data.flats);
        distractorPool = ["0", "1", "2", "3", "4", "5", "6"].filter((n) => n !== answer);
      } else {
        prompt = `How many sharps or flats in ${key} major?`;
        answer = "0";
        distractorPool = ["1", "2", "3", "4", "5", "6"];
      }
    } else if (type === "rel_minor") {
      prompt = `What is the relative minor of ${key} major?`;
      answer = data.relMinor;
      distractorPool = COF_KEYS.map((k) => COF_DATA[k].relMinor).filter((m) => m !== answer);
    } else if (type === "rel_major") {
      const minorName = data.relMinor;
      prompt = `What is the relative major of ${minorName}?`;
      answer = key;
      distractorPool = COF_KEYS.filter((k) => k !== answer);
    } else if (type === "chord_I") {
      prompt = `In ${key} major, what is the I chord?`;
      answer = key;
      distractorPool = COF_KEYS.filter((k) => k !== answer);
    } else if (type === "chord_IV") {
      prompt = `In ${key} major, what is the IV chord?`;
      answer = data.IV;
      distractorPool = COF_KEYS.filter((k) => k !== answer);
    } else if (type === "chord_V") {
      prompt = `In ${key} major, what is the V chord?`;
      answer = data.V;
      distractorPool = COF_KEYS.filter((k) => k !== answer);
    }
    state_default.currentCofAnswer = answer;
    state_default.currentCofPrompt = prompt;
    const distractors = [];
    const shuffled = distractorPool.sort(() => Math.random() - 0.5);
    for (let i = 0; i < 3 && i < shuffled.length; i++) {
      distractors.push(shuffled[i]);
    }
    const options = [answer, ...distractors].sort(() => Math.random() - 0.5);
    buildCofAnswerButtons(options);
    state_default.currentNote = state_default.currentCofItem;
    return state_default.currentCofItem;
  }
  function buildCofAnswerButtons(options) {
    const container = document.getElementById("circle-buttons");
    container.innerHTML = "";
    container.style.display = "flex";
    for (const opt of options) {
      const btn = document.createElement("button");
      btn.className = "interval-btn";
      btn.textContent = opt;
      btn.addEventListener("click", () => handleCofClick(opt, btn));
      btn.addEventListener("touchstart", (e) => {
        e.preventDefault();
        handleCofClick(opt, btn);
      }, { passive: false });
      container.appendChild(btn);
    }
  }
  function handleCofClick(selected, btnElement) {
    if (state_default.isProcessingClick || !state_default.currentCofAnswer) return;
    const responseTime = Date.now() - state_default.noteDisplayTime;
    if (selected === state_default.currentCofAnswer) {
      state_default.isProcessingClick = true;
      recordAttempt(state_default.currentCofItem, true, responseTime);
      btnElement.classList.add("correct");
      showFeedback(true, state_default.currentCofAnswer);
      setTimeout(() => {
        btnElement.classList.remove("correct");
        generateCofQuestion();
        renderQuizNote(state_default.currentNote);
        state_default.isProcessingClick = false;
      }, 400);
    } else {
      recordAttempt(state_default.currentCofItem, false, responseTime);
      btnElement.classList.add("wrong");
      showFeedback(false, state_default.currentCofAnswer);
      setTimeout(() => btnElement.classList.remove("wrong"), 200);
    }
  }

  // src/app/ui.js
  function showMainMenu() {
    updateMenuStats();
    state_default.isNotationQuizActive = false;
    document.getElementById("main-menu").classList.remove("hidden");
    document.getElementById("quiz-screen").classList.remove("active");
    document.getElementById("freeplay-screen").classList.remove("active");
    document.getElementById("level-complete").style.display = "none";
    document.getElementById("interval-buttons").style.display = "none";
    document.getElementById("keysig-buttons").style.display = "none";
    document.getElementById("circle-buttons").style.display = "none";
    document.getElementById("notation-chapters").classList.remove("active");
    document.getElementById("notation-lesson").classList.remove("active");
    document.getElementById("notation-quiz").classList.remove("active");
  }
  function showQuizScreen(mode) {
    state_default.isNotationQuizActive = false;
    state_default.quizMode = mode;
    saveProgress();
    document.getElementById("main-menu").classList.add("hidden");
    document.getElementById("quiz-screen").classList.add("active");
    document.getElementById("level-complete").style.display = "none";
    updateLevelDisplay();
    updateStreakDisplay();
    updateStatsDisplay();
    document.getElementById("delay-control").style.display = mode === "audio" ? "" : "none";
    document.getElementById("keyboard-container").style.display = "none";
    document.getElementById("interval-buttons").style.display = "none";
    document.getElementById("keysig-buttons").style.display = "none";
    document.getElementById("circle-buttons").style.display = "none";
    if (mode === "interval") {
      buildIntervalButtons();
    } else if (mode === "keysig") {
      buildKeySigButtons();
    } else if (mode === "circle") {
      document.getElementById("circle-buttons").style.display = "flex";
    } else {
      document.getElementById("keyboard-container").style.display = "flex";
      rebuildKeyboard();
    }
    showWaitingState();
  }
  function showWaitingState() {
    const staffDiv = document.getElementById("staff");
    staffDiv.innerHTML = "";
    document.getElementById("start-btn").style.display = "inline-block";
    document.getElementById("replay-btn").style.display = "none";
    document.getElementById("feedback").textContent = "";
    document.getElementById("response-time").textContent = "";
  }
  function showFeedback(isCorrect, itemStr) {
    const feedback = document.getElementById("feedback");
    feedback.textContent = isCorrect ? "Correct!" : `Wrong - that was ${itemStr}`;
    feedback.className = isCorrect ? "correct" : "wrong";
  }
  function updateStreakDisplay() {
    const progress = getCurrentProgress();
    const streakDisplay = document.getElementById("streak-display");
    streakDisplay.textContent = `Streak: ${progress.currentStreak} | Best: ${progress.longestStreak}`;
  }
  function updateLevelDisplay() {
    const progress = getCurrentProgress();
    const levels = getLevelsForMode(state_default.quizMode);
    const level = levels[progress.currentLevel];
    const levelDisplay = document.getElementById("level-display");
    const modeLabel = { visual: "Note Reading", audio: "Ear Training", reverse: "Note Finding", interval: "Intervals", keysig: "Key Signatures", circle: "Circle of Fifths" }[state_default.quizMode];
    levelDisplay.childNodes[0].textContent = `${modeLabel} - Level ${progress.currentLevel + 1}: ${level.name} `;
    populateLevelPicker();
    updateLevelProgress();
  }
  function updateLevelProgress() {
    const progress = getCurrentProgress();
    const levels = getLevelsForMode(state_default.quizMode);
    const level = levels[progress.currentLevel];
    const items = getLevelItems(level);
    let totalCorrect = 0, totalAttempts = 0;
    let itemsReady = 0;
    for (const item of items) {
      const stat = progress.noteStats[item];
      if (!stat) continue;
      totalCorrect += stat.correct;
      totalAttempts += stat.total;
      if (stat.total >= level.minAttempts) itemsReady++;
    }
    const accuracy = totalAttempts > 0 ? totalCorrect / totalAttempts : 0;
    const accuracyPct = Math.round(accuracy * 100);
    const thresholdPct = Math.round(level.threshold * 100);
    const allReady = itemsReady === items.length;
    const attemptProgress = itemsReady / items.length;
    const accuracyProgress = Math.min(1, accuracy / level.threshold);
    const overallProgress = Math.min(1, attemptProgress * 0.4 + accuracyProgress * 0.6);
    const fill = document.getElementById("level-progress-fill");
    fill.style.width = `${Math.round(overallProgress * 100)}%`;
    fill.style.background = accuracy >= level.threshold && allReady ? "#22aa55" : accuracy >= level.threshold ? "#cc8800" : "#4488cc";
    const text = document.getElementById("level-progress-text");
    text.textContent = `${accuracyPct}% accuracy (need ${thresholdPct}%) \xB7 ${itemsReady}/${items.length} notes practiced (need ${level.minAttempts} each)`;
  }
  function updateStatsDisplay() {
    const grid = document.getElementById("stats-grid");
    grid.innerHTML = "";
    const progress = getCurrentProgress();
    const activeItems = getActiveNotes();
    let sortedActive;
    if (state_default.quizMode === "interval" || state_default.quizMode === "keysig") {
      sortedActive = [...activeItems];
    } else {
      sortedActive = [...activeItems].sort((a, b) => {
        const pa = parseNote(a), pb = parseNote(b);
        if (pa.octave !== pb.octave) return pa.octave - pb.octave;
        const order = "CDEFGAB";
        return order.indexOf(pa.name) - order.indexOf(pb.name);
      });
    }
    for (const item of sortedActive) {
      const stat = progress.noteStats[item];
      if (!stat) continue;
      const accuracy = stat.total > 0 ? Math.round(stat.correct / stat.total * 100) : null;
      const div = document.createElement("div");
      div.className = "note-stat";
      if (accuracy !== null) {
        if (accuracy === 100) div.classList.add("perfect");
        else if (accuracy >= 80) div.classList.add("good");
        else if (accuracy >= 50) div.classList.add("struggling");
        else div.classList.add("bad");
      }
      const displayName = state_default.quizMode === "interval" ? INTERVALS[item].name : state_default.quizMode === "keysig" ? KEY_SIGNATURES[item].name : item;
      div.innerHTML = `
            <div class="note-name">${displayName}</div>
            <div class="note-accuracy">${accuracy !== null ? `${accuracy}%` : "-"}</div>
        `;
      grid.appendChild(div);
    }
  }
  function updateMenuStats() {
    const modes = ["visual", "audio", "reverse", "interval", "keysig", "circle"];
    for (const mode of modes) {
      const progress = modeProgress[mode];
      const levels = getLevelsForMode(mode);
      const level = levels[progress.currentLevel];
      document.getElementById(`menu-${mode}-level`).textContent = `Level ${progress.currentLevel + 1}: ${level.name}`;
      let total = 0, correct = 0;
      Object.values(progress.noteStats).forEach((s) => {
        total += s.total;
        correct += s.correct;
      });
      const acc = total > 0 ? Math.round(correct / total * 100) : null;
      document.getElementById(`menu-${mode}-accuracy`).textContent = acc !== null ? `${acc}% accuracy (${total} attempts)` : "No attempts yet";
    }
    const notProg = getNotationProgress();
    const chapNum = getNotationCurrentChapter(notProg);
    document.getElementById("menu-notation-level").textContent = `Chapter ${chapNum} of ${NOTATION_CHAPTERS.length}`;
    const completedCount = Object.values(notProg.chapters).filter((c) => c.quizPassed).length;
    document.getElementById("menu-notation-accuracy").textContent = completedCount > 0 ? `${completedCount}/${NOTATION_CHAPTERS.length} chapters complete` : "Not started";
  }
  function populateLevelPicker() {
    const progress = getCurrentProgress();
    const levels = getLevelsForMode(state_default.quizMode);
    const picker = document.getElementById("level-picker");
    picker.innerHTML = "";
    for (let i = 0; i < levels.length; i++) {
      const opt = document.createElement("option");
      opt.value = i;
      opt.textContent = `Lv ${i + 1}: ${levels[i].name}`;
      opt.disabled = !state_default.allLevelsUnlocked && i > progress.currentLevel;
      picker.appendChild(opt);
    }
    picker.value = progress.currentLevel;
    const unlockBtn = document.getElementById("unlock-all-btn");
    unlockBtn.textContent = state_default.allLevelsUnlocked ? "[lock]" : "[unlock all]";
  }
  var NOTE_NAMES = ["C", "D", "E", "F", "G", "A", "B"];
  var BLACK_KEY_MAP = { C: "C#", D: "D#", F: "F#", G: "G#", A: "A#" };
  var HAS_BLACK_AFTER = /* @__PURE__ */ new Set(["C", "D", "F", "G", "A"]);
  var TOUCH_SCROLL_THRESHOLD = 10;
  function rebuildKeyboard() {
    const keyboard = document.getElementById("keyboard");
    keyboard.innerHTML = "";
    if (state_default.quizMode === "interval") {
      document.getElementById("keyboard-container").style.display = "none";
      return;
    }
    document.getElementById("keyboard-container").style.display = "flex";
    const range = getKeyboardRange();
    const activeNotes = getActiveNotes();
    const hasAccidentals = activeNotes.some((n) => n.includes("#"));
    const numOctaves = range.end - range.start + 1;
    const totalWhiteKeys = numOctaves * 7;
    const availableWidth = window.innerWidth - 20;
    const fittedKeyWidth = Math.floor(availableWidth / totalWhiteKeys);
    const keyWidth = Math.min(50, Math.max(40, fittedKeyWidth));
    keyboard.style.setProperty("--key-width", `${keyWidth}px`);
    const keyHeight = Math.min(160, Math.max(120, keyWidth * 3));
    keyboard.style.setProperty("--key-height", `${keyHeight}px`);
    for (let oct = range.start; oct <= range.end; oct++) {
      const octaveWrapper = document.createElement("div");
      octaveWrapper.style.position = "relative";
      octaveWrapper.style.display = "flex";
      if (numOctaves > 1) {
        const octaveLabel = document.createElement("span");
        octaveLabel.className = "octave-label";
        octaveLabel.textContent = `Octave ${oct}`;
        octaveWrapper.appendChild(octaveLabel);
      }
      for (const note of NOTE_NAMES) {
        const noteStr = `${note}${oct}`;
        const whiteKey = document.createElement("div");
        whiteKey.className = "key white";
        whiteKey.dataset.note = noteStr;
        const label = document.createElement("span");
        label.className = "key-label";
        label.textContent = noteStr;
        whiteKey.appendChild(label);
        const handleWhiteKeyDown = () => {
          whiteKey.classList.add("active");
          handleKeyClick(noteStr, whiteKey);
        };
        const handleWhiteKeyUp = () => whiteKey.classList.remove("active");
        whiteKey.addEventListener("mousedown", handleWhiteKeyDown);
        whiteKey.addEventListener("mouseup", handleWhiteKeyUp);
        whiteKey.addEventListener("mouseleave", handleWhiteKeyUp);
        addTouchHandlers(whiteKey, handleWhiteKeyDown, handleWhiteKeyUp);
        octaveWrapper.appendChild(whiteKey);
        if (HAS_BLACK_AFTER.has(note)) {
          const blackNoteStr = `${BLACK_KEY_MAP[note]}${oct}`;
          const blackKey = document.createElement("div");
          blackKey.className = "key black";
          blackKey.dataset.note = blackNoteStr;
          const bLabel = document.createElement("span");
          bLabel.className = "key-label";
          bLabel.textContent = blackNoteStr;
          blackKey.appendChild(bLabel);
          const handleBlackKeyDown = () => {
            blackKey.classList.add("active");
            if (hasAccidentals && activeNotes.includes(blackNoteStr)) {
              handleKeyClick(blackNoteStr, blackKey);
            } else {
              blackKey.classList.add("wrong");
              setTimeout(() => blackKey.classList.remove("wrong"), 200);
            }
          };
          const handleBlackKeyUp = () => blackKey.classList.remove("active");
          blackKey.addEventListener("mousedown", handleBlackKeyDown);
          blackKey.addEventListener("mouseup", handleBlackKeyUp);
          blackKey.addEventListener("mouseleave", handleBlackKeyUp);
          addTouchHandlers(blackKey, handleBlackKeyDown, handleBlackKeyUp);
          octaveWrapper.appendChild(blackKey);
        }
      }
      keyboard.appendChild(octaveWrapper);
      if (oct < range.end) {
        const separator = document.createElement("div");
        separator.className = "octave-marker";
        keyboard.appendChild(separator);
      }
    }
    keyboard.classList.toggle("labels-hidden", !state_default.showLabels);
    const container = document.getElementById("keyboard-container");
    container.scrollLeft = (keyboard.scrollWidth - container.clientWidth) / 2;
  }
  function handleKeyClick(noteStr, keyElement) {
    if (state_default.isProcessingClick) return;
    const responseTime = Date.now() - state_default.noteDisplayTime;
    const parsed = parseNote(noteStr);
    if (noteStr === state_default.currentNote) {
      state_default.isProcessingClick = true;
      recordAttempt(state_default.currentNote, true, responseTime);
      playNote(parsed.name + parsed.accidental, parsed.octave);
      keyElement.classList.add("correct");
      showFeedback(true, noteStr);
      const delay = state_default.quizMode === "audio" ? parseInt(document.getElementById("next-delay").value) : 400;
      setTimeout(() => {
        keyElement.classList.remove("correct");
        const nextNote = pickNextNote();
        renderQuizNote(nextNote);
        state_default.isProcessingClick = false;
      }, delay);
    } else {
      recordAttempt(state_default.currentNote, false, responseTime);
      keyElement.classList.add("wrong");
      showFeedback(false, state_default.currentNote);
      setTimeout(() => keyElement.classList.remove("wrong"), 200);
    }
  }
  function addTouchHandlers(el, onDown, onUp) {
    let startX, startY, scrolled;
    el.addEventListener("touchstart", (e) => {
      const t = e.touches[0];
      startX = t.clientX;
      startY = t.clientY;
      scrolled = false;
    }, { passive: true });
    el.addEventListener("touchmove", (e) => {
      if (scrolled) return;
      const t = e.touches[0];
      if (Math.abs(t.clientX - startX) > TOUCH_SCROLL_THRESHOLD || Math.abs(t.clientY - startY) > TOUCH_SCROLL_THRESHOLD) {
        scrolled = true;
        onUp();
      }
    }, { passive: true });
    el.addEventListener("touchend", (e) => {
      if (!scrolled) {
        e.preventDefault();
        onDown();
        setTimeout(onUp, 150);
      }
    }, { passive: false });
  }
  var { Factory: Factory19 } = Vex.Flow;
  var CHROMATIC = ["C", "C#", "D", "D#", "E", "F", "F#", "G", "G#", "A", "A#", "B"];
  var WHITE_INDICES = /* @__PURE__ */ new Set([0, 2, 4, 5, 7, 9, 11]);
  var freePlayStartMidi = 48;
  var freePlayNoteTimes = false;
  var FREEPLAY_MIN_START = 24;
  var FREEPLAY_MAX_START = 84;
  function showFreePlayScreen() {
    document.getElementById("main-menu").classList.add("hidden");
    document.getElementById("freeplay-screen").classList.add("active");
    freePlayStartMidi = 48;
    freePlayNoteBuffer = [];
    renderEmptyGrandStaff();
    buildFreePlayKeyboard();
  }
  function shiftFreePlayOctave(delta) {
    const noteIdx = freePlayStartMidi % 12;
    let shift;
    if (delta > 0) {
      shift = noteIdx === 0 ? 5 : 7;
    } else {
      shift = noteIdx === 0 ? -7 : -5;
    }
    const next = freePlayStartMidi + shift;
    if (next < FREEPLAY_MIN_START || next > FREEPLAY_MAX_START) return;
    freePlayStartMidi = next;
    buildFreePlayKeyboard();
  }
  var freePlayNoteBuffer = [];
  var BEAT_VALUES = { w: 4, h: 2, q: 1, "8": 0.5, "16": 0.25 };
  var MAX_BEATS = 8;
  function toggleFreePlayNoteTimes(enabled) {
    freePlayNoteTimes = enabled;
  }
  function durationToNoteValue(ms) {
    if (ms >= 1400) return "w";
    if (ms >= 700) return "h";
    if (ms >= 350) return "q";
    if (ms >= 175) return "8";
    return "16";
  }
  function addFreePlayNote(noteStr, duration) {
    const dur = duration || "w";
    const beats = BEAT_VALUES[dur] || 4;
    const currentBeats = freePlayNoteBuffer.reduce((sum, n) => sum + n.beats, 0);
    if (currentBeats + beats > MAX_BEATS) {
      freePlayNoteBuffer = [];
    }
    freePlayNoteBuffer.push({ noteStr, dur, clef: getClefForNote(noteStr), beats });
    renderFreePlayStaff();
  }
  function addFreePlayTouchHandlers(el, noteStr, handleDown, handleUp) {
    let startX, startY, scrolled;
    el.addEventListener("touchstart", (e) => {
      const t = e.touches[0];
      startX = t.clientX;
      startY = t.clientY;
      scrolled = false;
      if (freePlayNoteTimes) {
        handleDown();
      }
    }, { passive: true });
    el.addEventListener("touchmove", (e) => {
      if (scrolled) return;
      const t = e.touches[0];
      if (Math.abs(t.clientX - startX) > TOUCH_SCROLL_THRESHOLD || Math.abs(t.clientY - startY) > TOUCH_SCROLL_THRESHOLD) {
        scrolled = true;
        handleUp();
      }
    }, { passive: true });
    el.addEventListener("touchend", (e) => {
      if (scrolled) return;
      e.preventDefault();
      if (freePlayNoteTimes) {
        handleUp();
      } else {
        handleDown();
        setTimeout(handleUp, 150);
      }
    }, { passive: false });
  }
  function buildFreePlayKeyboard() {
    const keyboard = document.getElementById("freeplay-keyboard");
    keyboard.innerHTML = "";
    const startMidi = freePlayStartMidi;
    const endMidi = startMidi + 23;
    const notes = [];
    for (let midi = startMidi; midi <= endMidi; midi++) {
      const octave = Math.floor(midi / 12) - 1;
      const chrIdx = midi % 12;
      const name = CHROMATIC[chrIdx];
      notes.push({ name, octave, noteStr: `${name}${octave}`, isWhite: WHITE_INDICES.has(chrIdx) });
    }
    const groups = [];
    let cur = null;
    for (const note of notes) {
      if (!cur || note.octave !== cur.octave) {
        cur = { octave: note.octave, notes: [] };
        groups.push(cur);
      }
      cur.notes.push(note);
    }
    const whiteCount = notes.filter((n) => n.isWhite).length;
    const availableWidth = window.innerWidth - 20;
    const narrow = availableWidth < whiteCount * 40;
    const maxGroupWhites = Math.max(...groups.map((g) => g.notes.filter((n) => n.isWhite).length));
    const sizingWhites = narrow ? maxGroupWhites : whiteCount;
    const keyWidth = Math.min(60, Math.max(30, availableWidth / sizingWhites - 2));
    keyboard.style.setProperty("--key-width", `${keyWidth}px`);
    const keyHeight = Math.min(160, Math.max(120, keyWidth * 3));
    keyboard.style.setProperty("--key-height", `${keyHeight}px`);
    keyboard.classList.toggle("freeplay-narrow", narrow);
    for (let g = 0; g < groups.length; g++) {
      const group = groups[g];
      const wrapper = document.createElement("div");
      wrapper.className = "octave-group";
      wrapper.style.position = "relative";
      wrapper.style.display = "flex";
      if (groups.length > 1) {
        const label = document.createElement("span");
        label.className = "octave-label";
        label.textContent = `Octave ${group.octave}`;
        wrapper.appendChild(label);
      }
      for (const note of group.notes) {
        const key = document.createElement("div");
        key.className = note.isWhite ? "key white" : "key black";
        key.dataset.note = note.noteStr;
        const lbl = document.createElement("span");
        lbl.className = "key-label";
        lbl.textContent = note.noteStr;
        key.appendChild(lbl);
        const handleDown = () => {
          key.classList.add("active");
          if (freePlayNoteTimes) {
            startNoteStr(note.noteStr);
            key._noteStart = Date.now();
          } else {
            playNoteStr(note.noteStr);
            addFreePlayNote(note.noteStr);
          }
        };
        const handleUp = () => {
          key.classList.remove("active");
          if (key._noteStart) {
            stopNoteStr(note.noteStr);
            const ms = Date.now() - key._noteStart;
            key._noteStart = null;
            addFreePlayNote(note.noteStr, durationToNoteValue(ms));
          }
        };
        key.addEventListener("mousedown", handleDown);
        key.addEventListener("mouseup", handleUp);
        key.addEventListener("mouseleave", handleUp);
        addFreePlayTouchHandlers(key, note.noteStr, handleDown, handleUp);
        wrapper.appendChild(key);
      }
      keyboard.appendChild(wrapper);
      if (g < groups.length - 1) {
        const sep = document.createElement("div");
        sep.className = "octave-marker";
        keyboard.appendChild(sep);
      }
    }
    keyboard.classList.toggle("labels-hidden", !state_default.showLabels);
    const noteIdx = startMidi % 12;
    const upShift = noteIdx === 0 ? 5 : 7;
    const downShift = noteIdx === 0 ? 7 : 5;
    document.getElementById("freeplay-octave-down").disabled = startMidi - downShift < FREEPLAY_MIN_START;
    document.getElementById("freeplay-octave-up").disabled = startMidi + upShift > FREEPLAY_MAX_START;
    document.getElementById("freeplay-octave-label").textContent = `${midiToNote(startMidi)} \u2013 ${midiToNote(endMidi)}`;
    const container = document.getElementById("freeplay-keyboard-container");
    container.scrollLeft = (keyboard.scrollWidth - container.clientWidth) / 2;
  }
  function renderEmptyGrandStaff() {
    const staffDiv = document.getElementById("freeplay-staff");
    staffDiv.innerHTML = "";
    try {
      const containerWidth = Math.min(window.innerWidth * 0.9, 400);
      const staffWidth = Math.max(containerWidth - 40, 140);
      const staffHeight = Math.min(250, Math.max(window.innerHeight * 0.28, 180));
      const factory = new Factory19({
        renderer: { elementId: "freeplay-staff", width: containerWidth, height: staffHeight }
      });
      const score = factory.EasyScore();
      const system = factory.System({ x: 0, y: 0, width: staffWidth });
      const trebleVoice = score.voice(score.notes("B4/w/r", { clef: "treble" }));
      const bassVoice = score.voice(score.notes("D3/w/r", { clef: "bass" }));
      system.addStave({ voices: [trebleVoice] }).addClef("treble");
      system.addStave({ voices: [bassVoice] }).addClef("bass");
      system.addConnector("brace");
      system.addConnector("singleLeft");
      factory.draw();
    } catch (error) {
      console.error("Error rendering empty grand staff:", error);
    }
  }
  function generateRestPadding(beats, restNote) {
    const rests = [];
    let remaining = Math.round(beats * 100) / 100;
    for (const [dur, val] of [["w", 4], ["h", 2], ["q", 1], ["8", 0.5], ["16", 0.25]]) {
      while (remaining >= val - 1e-3) {
        rests.push(`${restNote}/${dur}/r`);
        remaining = Math.round((remaining - val) * 100) / 100;
      }
    }
    return rests;
  }
  function renderFreePlayStaff() {
    const staffDiv = document.getElementById("freeplay-staff");
    staffDiv.innerHTML = "";
    if (freePlayNoteBuffer.length === 0) {
      renderEmptyGrandStaff();
      return;
    }
    try {
      const totalBeats = freePlayNoteBuffer.reduce((sum, n) => sum + n.beats, 0);
      const targetBeats = totalBeats <= 4 ? 4 : 8;
      const remainingBeats = Math.round((targetBeats - totalBeats) * 100) / 100;
      const trebleParts = [];
      const bassParts = [];
      for (const note of freePlayNoteBuffer) {
        const parsed = parseNote(note.noteStr);
        const vexNote = `${parsed.name}${parsed.accidental}${parsed.octave}/${note.dur}`;
        if (note.clef === "treble") {
          trebleParts.push(vexNote);
          bassParts.push(`D3/${note.dur}/r`);
        } else {
          trebleParts.push(`B4/${note.dur}/r`);
          bassParts.push(vexNote);
        }
      }
      if (remainingBeats > 0) {
        trebleParts.push(...generateRestPadding(remainingBeats, "B4"));
        bassParts.push(...generateRestPadding(remainingBeats, "D3"));
      }
      const baseWidth = Math.min(window.innerWidth * 0.9, 400);
      const containerWidth = targetBeats <= 4 ? baseWidth : Math.min(baseWidth * 1.6, window.innerWidth * 0.95);
      const staffWidth = Math.max(containerWidth - 40, 140);
      const staffHeight = Math.min(250, Math.max(window.innerHeight * 0.28, 180));
      const timeStr = targetBeats <= 4 ? "4/4" : "8/4";
      const factory = new Factory19({
        renderer: { elementId: "freeplay-staff", width: containerWidth, height: staffHeight }
      });
      const score = factory.EasyScore();
      const system = factory.System({ x: 0, y: 0, width: staffWidth });
      const trebleVoice = score.voice(score.notes(trebleParts.join(", "), { clef: "treble" }), { time: timeStr });
      const bassVoice = score.voice(score.notes(bassParts.join(", "), { clef: "bass" }), { time: timeStr });
      system.addStave({ voices: [trebleVoice] }).addClef("treble");
      system.addStave({ voices: [bassVoice] }).addClef("bass");
      system.addConnector("brace");
      system.addConnector("singleLeft");
      factory.draw();
    } catch (error) {
      console.error("Error rendering free play staff:", error);
    }
  }

  // src/app/progress.js
  function getNotationProgress() {
    const saved = localStorage.getItem(STORAGE_KEY);
    if (saved) {
      try {
        const data = JSON.parse(saved);
        if (data.notationProgress) return data.notationProgress;
      } catch (e) {
      }
    }
    return createDefaultNotationProgress();
  }
  function createDefaultNotationProgress() {
    const chapters = {};
    for (const ch of NOTATION_CHAPTERS) {
      chapters[ch.id] = {
        lessonComplete: false,
        lessonPage: 0,
        quizPassed: false,
        quizStats: {},
        quizMemory: {},
        roundNumber: 0,
        currentStreak: 0,
        longestStreak: 0
      };
    }
    return { chapters };
  }
  function getNotationCurrentChapter(progress) {
    for (const ch of NOTATION_CHAPTERS) {
      if (!progress.chapters[ch.id] || !progress.chapters[ch.id].quizPassed) return ch.id;
    }
    return NOTATION_CHAPTERS.length;
  }
  function saveNotationProgress(progress) {
    const saved = localStorage.getItem(STORAGE_KEY);
    let data = {};
    if (saved) {
      try {
        data = JSON.parse(saved);
      } catch (e) {
      }
    }
    data.notationProgress = progress;
    localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
  }
  function createDefaultProgress(allItems) {
    const stats = {};
    const memory = {};
    allItems.forEach((item) => {
      stats[item] = { correct: 0, total: 0 };
      memory[item] = { easiness: 2.5, interval: 1, repetitions: 0, lastSeen: 0, priority: 1 };
    });
    return {
      currentLevel: 0,
      noteStats: stats,
      noteMemory: memory,
      currentStreak: 0,
      longestStreak: 0,
      roundNumber: 0
    };
  }
  var modeProgress = {
    visual: createDefaultProgress(ALL_NOTES),
    audio: createDefaultProgress(ALL_NOTES),
    reverse: createDefaultProgress(ALL_NOTES),
    interval: createDefaultProgress(ALL_INTERVALS),
    keysig: createDefaultProgress(ALL_KEYSIGS),
    circle: createDefaultProgress(ALL_COF_ITEMS)
  };
  function getCurrentProgress() {
    return modeProgress[state_default.quizMode];
  }
  function saveProgress() {
    const saved = localStorage.getItem(STORAGE_KEY);
    let data = {};
    if (saved) {
      try {
        data = JSON.parse(saved);
      } catch (e) {
      }
    }
    data.modeProgress = modeProgress;
    data.showLabels = state_default.showLabels;
    localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
  }
  function loadProgress() {
    const saved = localStorage.getItem(STORAGE_KEY);
    if (!saved) return;
    try {
      const data = JSON.parse(saved);
      if (data.modeProgress) {
        for (const mode of ["visual", "audio", "reverse", "interval", "keysig", "circle"]) {
          if (data.modeProgress[mode]) {
            Object.assign(modeProgress[mode], data.modeProgress[mode]);
            const allItems = mode === "interval" ? ALL_INTERVALS : mode === "keysig" ? ALL_KEYSIGS : mode === "circle" ? ALL_COF_ITEMS : ALL_NOTES;
            allItems.forEach((item) => {
              if (!modeProgress[mode].noteStats[item]) {
                modeProgress[mode].noteStats[item] = { correct: 0, total: 0 };
              }
              if (!modeProgress[mode].noteMemory[item]) {
                modeProgress[mode].noteMemory[item] = { easiness: 2.5, interval: 1, repetitions: 0, lastSeen: 0, priority: 1 };
              }
            });
          }
        }
      } else if (data.currentLevel !== void 0) {
        modeProgress.visual.currentLevel = data.currentLevel || 0;
        if (data.noteStats) Object.assign(modeProgress.visual.noteStats, data.noteStats);
        if (data.noteMemory) Object.assign(modeProgress.visual.noteMemory, data.noteMemory);
        modeProgress.visual.currentStreak = data.currentStreak || 0;
        modeProgress.visual.longestStreak = data.longestStreak || 0;
        modeProgress.visual.roundNumber = data.roundNumber || 0;
      }
      state_default.showLabels = data.showLabels !== false;
    } catch (e) {
      console.error("Failed to load progress:", e);
    }
  }
  function resetProgress() {
    if (!confirm("Reset all progress? This will clear your level, stats, and streaks for all modes.")) return;
    localStorage.removeItem(STORAGE_KEY);
    location.reload();
  }
  function getLevelsForMode(mode) {
    if (mode === "interval") return INTERVAL_LEVELS;
    if (mode === "keysig") return KEYSIG_LEVELS;
    if (mode === "circle") return COF_LEVELS;
    return DIFFICULTY_LEVELS;
  }
  function getLevelItems(level) {
    return state_default.quizMode === "interval" ? level.intervals : state_default.quizMode === "keysig" ? level.keys : state_default.quizMode === "circle" ? level.items : level.notes;
  }
  function getActiveNotes() {
    const progress = getCurrentProgress();
    if (state_default.quizMode === "interval") {
      return INTERVAL_LEVELS[progress.currentLevel].intervals;
    }
    if (state_default.quizMode === "keysig") {
      return KEYSIG_LEVELS[progress.currentLevel].keys;
    }
    if (state_default.quizMode === "circle") {
      return COF_LEVELS[progress.currentLevel].items;
    }
    return DIFFICULTY_LEVELS[progress.currentLevel].notes;
  }
  function updateSpacedRepetition(itemStr, quality) {
    const progress = getCurrentProgress();
    if (!progress.noteMemory[itemStr]) {
      progress.noteMemory[itemStr] = { easiness: 2.5, interval: 1, repetitions: 0, lastSeen: 0, priority: 1 };
    }
    const mem = progress.noteMemory[itemStr];
    if (quality >= 3) {
      if (mem.repetitions === 0) mem.interval = 1;
      else if (mem.repetitions === 1) mem.interval = 3;
      else mem.interval = Math.round(mem.interval * mem.easiness);
      mem.repetitions++;
    } else {
      mem.repetitions = 0;
      mem.interval = 1;
    }
    mem.easiness = Math.max(
      1.3,
      mem.easiness + (0.1 - (5 - quality) * (0.08 + (5 - quality) * 0.02))
    );
    mem.lastSeen = progress.roundNumber;
    mem.priority = Math.max(0.1, 1 / mem.easiness);
  }
  function calculateQuality(responseTimeMs, isCorrect, wasFirstAttempt) {
    if (!isCorrect) return 0;
    if (!wasFirstAttempt) return 2;
    if (responseTimeMs < 1500) return 5;
    if (responseTimeMs < 3e3) return 4;
    return 3;
  }
  function recordAttempt(itemStr, wasCorrect, responseTimeMs) {
    const progress = getCurrentProgress();
    const wasFirstAttempt = state_default.firstAttempt;
    if (state_default.firstAttempt) {
      if (!progress.noteStats[itemStr]) progress.noteStats[itemStr] = { correct: 0, total: 0 };
      progress.noteStats[itemStr].total++;
      if (wasCorrect) progress.noteStats[itemStr].correct++;
      if (wasCorrect) {
        progress.currentStreak++;
        progress.longestStreak = Math.max(progress.longestStreak, progress.currentStreak);
      } else {
        progress.currentStreak = 0;
      }
      updateStreakDisplay();
    }
    if (wasCorrect) {
      const quality = calculateQuality(responseTimeMs, true, wasFirstAttempt);
      updateSpacedRepetition(itemStr, quality);
      const rtDisplay = document.getElementById("response-time");
      const timeStr = (responseTimeMs / 1e3).toFixed(1);
      const speedLabel = responseTimeMs < 1500 ? "Fast!" : responseTimeMs < 3e3 ? "Good" : "Keep practicing";
      rtDisplay.textContent = `${timeStr}s - ${speedLabel}`;
    } else if (state_default.firstAttempt) {
      updateSpacedRepetition(itemStr, 0);
      document.getElementById("response-time").textContent = "";
    }
    state_default.firstAttempt = false;
    updateStatsDisplay();
    updateLevelProgress();
    checkLevelUp();
    saveProgress();
  }
  function checkLevelUp() {
    const progress = getCurrentProgress();
    const levels = getLevelsForMode(state_default.quizMode);
    if (progress.currentLevel >= levels.length - 1) return false;
    const level = levels[progress.currentLevel];
    const items = getLevelItems(level);
    let totalCorrect = 0, totalAttempts = 0;
    let allHaveMinAttempts = true;
    for (const item of items) {
      const stat = progress.noteStats[item];
      if (!stat) continue;
      totalCorrect += stat.correct;
      totalAttempts += stat.total;
      if (stat.total < level.minAttempts) allHaveMinAttempts = false;
    }
    const accuracy = totalAttempts > 0 ? totalCorrect / totalAttempts : 0;
    if (accuracy >= level.threshold && allHaveMinAttempts) {
      progress.currentLevel++;
      updateLevelDisplay();
      if (state_default.quizMode === "interval") buildIntervalButtons();
      else if (state_default.quizMode === "keysig") buildKeySigButtons();
      else if (state_default.quizMode !== "circle") rebuildKeyboard();
      showLevelComplete();
      return true;
    }
    return false;
  }
  function resetLevelStats(levelIndex) {
    const progress = getCurrentProgress();
    const levels = getLevelsForMode(state_default.quizMode);
    const level = levels[levelIndex];
    const items = getLevelItems(level);
    for (const item of items) {
      progress.noteStats[item] = { correct: 0, total: 0 };
      if (progress.noteMemory[item]) {
        progress.noteMemory[item] = { easiness: 2.5, interval: 1, repetitions: 0, lastSeen: 0, priority: 1 };
      }
    }
    saveProgress();
  }
  function showLevelComplete() {
    const progress = getCurrentProgress();
    const levels = getLevelsForMode(state_default.quizMode);
    const isLastLevel = progress.currentLevel >= levels.length - 1;
    const nextLevel = levels[progress.currentLevel];
    document.getElementById("next-level-name").textContent = isLastLevel ? "You've completed all levels!" : `Next: ${nextLevel.name}`;
    document.getElementById("level-complete").style.display = "flex";
    document.getElementById("start-btn").style.display = "none";
    document.getElementById("replay-btn").style.display = "none";
    document.getElementById("continue-btn").style.display = isLastLevel ? "none" : "inline-block";
    document.getElementById("stay-btn").style.display = "inline-block";
    document.getElementById("reset-stay-btn").style.display = "inline-block";
  }

  // src/app/notation-mode.js
  function showNotationChapterList() {
    state_default.notationProgress = getNotationProgress();
    document.getElementById("main-menu").classList.add("hidden");
    document.getElementById("quiz-screen").classList.remove("active");
    document.getElementById("notation-lesson").classList.remove("active");
    document.getElementById("notation-quiz").classList.remove("active");
    document.getElementById("notation-chapters").classList.add("active");
    state_default.isNotationQuizActive = false;
    buildChapterList();
  }
  function buildChapterList() {
    const list = document.getElementById("chapter-list");
    list.innerHTML = "";
    const currentCh = getNotationCurrentChapter(state_default.notationProgress);
    for (const ch of NOTATION_CHAPTERS) {
      const chProg = state_default.notationProgress.chapters[ch.id];
      const isCompleted = chProg && chProg.quizPassed;
      const isCurrent = ch.id === currentCh;
      const isLocked = !state_default.allLevelsUnlocked && ch.id > currentCh;
      const item = document.createElement("div");
      item.className = "chapter-item" + (isCompleted ? " completed" : "") + (isCurrent ? " current" : "") + (isLocked ? " locked" : "");
      item.innerHTML = `
            <div class="chapter-num">${isCompleted ? "\u2713" : ch.id}</div>
            <div class="chapter-info">
                <h3>${ch.title}</h3>
                <p>${ch.subtitle}${chProg && chProg.lessonComplete ? " \xB7 Lesson complete" : ""}${isCompleted ? " \xB7 Quiz passed" : ""}</p>
            </div>
        `;
      if (!isLocked) {
        item.addEventListener("click", () => startChapter(ch.id));
      }
      list.appendChild(item);
    }
  }
  function startChapter(chapterId) {
    state_default.currentChapterId = chapterId;
    const chProg = state_default.notationProgress.chapters[chapterId];
    if (chProg && chProg.lessonComplete) {
      showNotationLesson(chapterId, 0);
    } else {
      showNotationLesson(chapterId, chProg ? chProg.lessonPage : 0);
    }
  }
  function showNotationLesson(chapterId, pageIndex) {
    state_default.currentChapterId = chapterId;
    const chapter = NOTATION_CHAPTERS.find((c) => c.id === chapterId);
    if (!chapter) return;
    state_default.currentLessonPage = Math.min(pageIndex, chapter.pages.length - 1);
    document.getElementById("notation-chapters").classList.remove("active");
    document.getElementById("notation-quiz").classList.remove("active");
    document.getElementById("notation-lesson").classList.add("active");
    document.getElementById("lesson-title").textContent = chapter.title;
    renderLessonPage(chapter);
  }
  function renderLessonPage(chapter) {
    const page = chapter.pages[state_default.currentLessonPage];
    const content = document.getElementById("lesson-content");
    content.innerHTML = page.content;
    if (page.render) {
      requestAnimationFrame(() => page.render(content));
    }
    document.getElementById("lesson-page-indicator").textContent = `Page ${state_default.currentLessonPage + 1} of ${chapter.pages.length}`;
    const prevBtn = document.getElementById("lesson-prev");
    const nextBtn = document.getElementById("lesson-next");
    prevBtn.style.display = state_default.currentLessonPage > 0 ? "inline-block" : "none";
    const isLastPage = state_default.currentLessonPage >= chapter.pages.length - 1;
    nextBtn.textContent = isLastPage ? "Start Quiz" : "Next";
    nextBtn.className = isLastPage ? "primary" : "";
    if (!state_default.notationProgress.chapters[chapter.id].lessonComplete) {
      state_default.notationProgress.chapters[chapter.id].lessonPage = state_default.currentLessonPage;
      saveNotationProgress(state_default.notationProgress);
    }
  }
  function showNotationQuiz(chapterId) {
    state_default.currentChapterId = chapterId;
    const chapter = NOTATION_CHAPTERS.find((c) => c.id === chapterId);
    if (!chapter) return;
    state_default.isNotationQuizActive = true;
    document.getElementById("notation-chapters").classList.remove("active");
    document.getElementById("notation-lesson").classList.remove("active");
    document.getElementById("notation-quiz").classList.add("active");
    document.getElementById("nq-title").textContent = `Quiz: ${chapter.title}`;
    const chProg = state_default.notationProgress.chapters[chapterId];
    if (!chProg.quizStats || Object.keys(chProg.quizStats).length === 0) {
      chProg.quizStats = {};
      chProg.quizMemory = {};
      for (const q of chapter.quizPool) {
        chProg.quizStats[q.id] = { correct: 0, total: 0 };
        chProg.quizMemory[q.id] = { easiness: 2.5, interval: 1, repetitions: 0, lastSeen: 0, priority: 1 };
      }
    }
    updateNQStatsDisplay();
    updateNQProgress();
    updateNQStreak();
    pickNextNQQuestion();
  }
  function pickNextNQQuestion() {
    const chapter = NOTATION_CHAPTERS.find((c) => c.id === state_default.currentChapterId);
    const chProg = state_default.notationProgress.chapters[state_default.currentChapterId];
    chProg.roundNumber = (chProg.roundNumber || 0) + 1;
    const candidates = chapter.quizPool.filter((q) => !state_default.currentQuizQuestion || q.id !== state_default.currentQuizQuestion.id).map((q) => {
      if (!chProg.quizMemory[q.id]) {
        chProg.quizMemory[q.id] = { easiness: 2.5, interval: 1, repetitions: 0, lastSeen: 0, priority: 1 };
      }
      const mem = chProg.quizMemory[q.id];
      const roundsSince = chProg.roundNumber - mem.lastSeen;
      const isDue = roundsSince >= mem.interval;
      let score = mem.priority;
      if (isDue) score += 10;
      if (roundsSince > mem.interval * 2) score += 5;
      score += Math.random() * 0.5;
      return { question: q, score };
    }).sort((a, b) => b.score - a.score);
    state_default.currentQuizQuestion = candidates[0].question;
    state_default.nqFirstAttempt = true;
    renderNQQuestion();
  }
  function renderNQQuestion() {
    const q = state_default.currentQuizQuestion;
    const staffContainer = document.getElementById("nq-staff-container");
    const staffEl = document.getElementById("nq-staff");
    staffEl.innerHTML = "";
    if (q.render) {
      staffContainer.style.display = "flex";
      q.render(staffEl);
    } else {
      staffContainer.style.display = "none";
    }
    document.getElementById("nq-prompt").textContent = q.prompt;
    const btnContainer = document.getElementById("nq-buttons");
    btnContainer.innerHTML = "";
    q.options.forEach((opt, idx) => {
      const btn = document.createElement("button");
      btn.className = "mc-btn";
      btn.textContent = opt;
      btn.addEventListener("click", () => handleNQAnswer(idx, btn));
      btn.addEventListener("touchstart", (e) => {
        e.preventDefault();
        handleNQAnswer(idx, btn);
      }, { passive: false });
      btnContainer.appendChild(btn);
    });
    document.getElementById("nq-feedback").textContent = "";
    document.getElementById("nq-feedback").className = "";
    document.getElementById("nq-response-time").textContent = "";
    state_default.nqDisplayTime = Date.now();
  }
  function handleNQAnswer(selectedIndex, btnElement) {
    if (state_default.isProcessingClick || !state_default.currentQuizQuestion) return;
    const q = state_default.currentQuizQuestion;
    const isCorrect = selectedIndex === q.correctIndex;
    const responseTime = Date.now() - state_default.nqDisplayTime;
    const chProg = state_default.notationProgress.chapters[state_default.currentChapterId];
    if (isCorrect) {
      state_default.isProcessingClick = true;
      btnElement.classList.add("correct");
      if (state_default.nqFirstAttempt) {
        if (!chProg.quizStats[q.id]) chProg.quizStats[q.id] = { correct: 0, total: 0 };
        chProg.quizStats[q.id].total++;
        chProg.quizStats[q.id].correct++;
        chProg.currentStreak = (chProg.currentStreak || 0) + 1;
        chProg.longestStreak = Math.max(chProg.longestStreak || 0, chProg.currentStreak);
      }
      const quality = calculateQuality(responseTime, true, state_default.nqFirstAttempt);
      updateNQSpacedRepetition(q.id, quality, chProg);
      const feedback = document.getElementById("nq-feedback");
      feedback.textContent = "Correct!";
      feedback.style.color = "#8f8";
      const rtDisplay = document.getElementById("nq-response-time");
      const timeStr = (responseTime / 1e3).toFixed(1);
      const speedLabel = responseTime < 1500 ? "Fast!" : responseTime < 3e3 ? "Good" : "Keep practicing";
      rtDisplay.textContent = `${timeStr}s - ${speedLabel}`;
      saveNotationProgress(state_default.notationProgress);
      updateNQStatsDisplay();
      updateNQProgress();
      updateNQStreak();
      if (checkNQChapterComplete()) {
        setTimeout(() => {
          state_default.isProcessingClick = false;
          showNQChapterComplete();
        }, 500);
        return;
      }
      setTimeout(() => {
        btnElement.classList.remove("correct");
        pickNextNQQuestion();
        state_default.isProcessingClick = false;
      }, 500);
    } else {
      btnElement.classList.add("wrong");
      if (state_default.nqFirstAttempt) {
        if (!chProg.quizStats[q.id]) chProg.quizStats[q.id] = { correct: 0, total: 0 };
        chProg.quizStats[q.id].total++;
        chProg.currentStreak = 0;
        updateNQSpacedRepetition(q.id, 0, chProg);
      }
      state_default.nqFirstAttempt = false;
      const feedback = document.getElementById("nq-feedback");
      feedback.textContent = `Wrong \u2014 ${q.options[q.correctIndex]}`;
      feedback.style.color = "#f88";
      saveNotationProgress(state_default.notationProgress);
      updateNQStatsDisplay();
      updateNQProgress();
      updateNQStreak();
      setTimeout(() => btnElement.classList.remove("wrong"), 200);
    }
  }
  function updateNQSpacedRepetition(questionId, quality, chProg) {
    if (!chProg.quizMemory[questionId]) {
      chProg.quizMemory[questionId] = { easiness: 2.5, interval: 1, repetitions: 0, lastSeen: 0, priority: 1 };
    }
    const mem = chProg.quizMemory[questionId];
    if (quality >= 3) {
      if (mem.repetitions === 0) mem.interval = 1;
      else if (mem.repetitions === 1) mem.interval = 3;
      else mem.interval = Math.round(mem.interval * mem.easiness);
      mem.repetitions++;
    } else {
      mem.repetitions = 0;
      mem.interval = 1;
    }
    mem.easiness = Math.max(1.3, mem.easiness + (0.1 - (5 - quality) * (0.08 + (5 - quality) * 0.02)));
    mem.lastSeen = chProg.roundNumber;
    mem.priority = Math.max(0.1, 1 / mem.easiness);
  }
  function updateNQProgress() {
    const chapter = NOTATION_CHAPTERS.find((c) => c.id === state_default.currentChapterId);
    const chProg = state_default.notationProgress.chapters[state_default.currentChapterId];
    const pool = chapter.quizPool;
    let totalCorrect = 0, totalAttempts = 0, itemsReady = 0;
    const minAttempts = 1;
    const threshold = 0.8;
    for (const q of pool) {
      const stat = chProg.quizStats[q.id];
      if (!stat) continue;
      totalCorrect += stat.correct;
      totalAttempts += stat.total;
      if (stat.total >= minAttempts) itemsReady++;
    }
    const accuracy = totalAttempts > 0 ? totalCorrect / totalAttempts : 0;
    const accuracyPct = Math.round(accuracy * 100);
    const attemptProgress = itemsReady / pool.length;
    const accuracyProgress = Math.min(1, accuracy / threshold);
    const overallProgress = Math.min(1, attemptProgress * 0.4 + accuracyProgress * 0.6);
    const fill = document.getElementById("nq-progress-fill");
    fill.style.width = `${Math.round(overallProgress * 100)}%`;
    fill.style.background = accuracy >= threshold && itemsReady === pool.length ? "#22aa55" : accuracy >= threshold ? "#cc8800" : "#4488cc";
    document.getElementById("nq-progress-text").textContent = `${accuracyPct}% accuracy (need 80%) \xB7 ${itemsReady}/${pool.length} questions seen`;
  }
  function updateNQStreak() {
    const chProg = state_default.notationProgress.chapters[state_default.currentChapterId];
    document.getElementById("nq-streak").textContent = `Streak: ${chProg.currentStreak || 0} | Best: ${chProg.longestStreak || 0}`;
  }
  function updateNQStatsDisplay() {
    const chapter = NOTATION_CHAPTERS.find((c) => c.id === state_default.currentChapterId);
    const chProg = state_default.notationProgress.chapters[state_default.currentChapterId];
    const grid = document.getElementById("nq-stats-grid");
    grid.innerHTML = "";
    for (const q of chapter.quizPool) {
      const stat = chProg.quizStats[q.id];
      if (!stat) continue;
      const accuracy = stat.total > 0 ? Math.round(stat.correct / stat.total * 100) : null;
      const div = document.createElement("div");
      div.className = "note-stat";
      if (accuracy !== null) {
        if (accuracy === 100) div.classList.add("perfect");
        else if (accuracy >= 80) div.classList.add("good");
        else if (accuracy >= 50) div.classList.add("struggling");
        else div.classList.add("bad");
      }
      const shortPrompt = q.prompt.length > 20 ? q.prompt.substring(0, 18) + "\u2026" : q.prompt;
      div.innerHTML = `
            <div class="note-name" style="font-size:clamp(0.6rem,2vw,0.7rem);">${shortPrompt}</div>
            <div class="note-accuracy">${accuracy !== null ? `${accuracy}%` : "-"}</div>
        `;
      grid.appendChild(div);
    }
  }
  function checkNQChapterComplete() {
    const chapter = NOTATION_CHAPTERS.find((c) => c.id === state_default.currentChapterId);
    const chProg = state_default.notationProgress.chapters[state_default.currentChapterId];
    const minAttempts = 1;
    const threshold = 0.8;
    let totalCorrect = 0, totalAttempts = 0;
    let allHaveMinAttempts = true;
    for (const q of chapter.quizPool) {
      const stat = chProg.quizStats[q.id];
      if (!stat) continue;
      totalCorrect += stat.correct;
      totalAttempts += stat.total;
      if (stat.total < minAttempts) allHaveMinAttempts = false;
    }
    const accuracy = totalAttempts > 0 ? totalCorrect / totalAttempts : 0;
    return accuracy >= threshold && allHaveMinAttempts;
  }
  function showNQChapterComplete() {
    const chProg = state_default.notationProgress.chapters[state_default.currentChapterId];
    chProg.quizPassed = true;
    saveNotationProgress(state_default.notationProgress);
    const isLastChapter = state_default.currentChapterId >= NOTATION_CHAPTERS.length;
    const nextChapter = NOTATION_CHAPTERS.find((c) => c.id === state_default.currentChapterId + 1);
    document.getElementById("next-level-name").textContent = isLastChapter || !nextChapter ? "You've completed all chapters!" : `Next: ${nextChapter.title}`;
    document.getElementById("level-complete").style.display = "flex";
    document.getElementById("continue-btn").style.display = !isLastChapter && nextChapter ? "inline-block" : "none";
    document.getElementById("stay-btn").style.display = "inline-block";
    document.getElementById("reset-stay-btn").style.display = "inline-block";
  }

  // src/main.js
  loadProgress();
  document.getElementById("show-labels").checked = state_default.showLabels;
  showMainMenu();
  document.getElementById("card-visual").addEventListener("click", () => showQuizScreen("visual"));
  document.getElementById("card-audio").addEventListener("click", async () => {
    await Tone.start();
    showQuizScreen("audio");
  });
  document.getElementById("card-reverse").addEventListener("click", () => showQuizScreen("reverse"));
  document.getElementById("card-interval").addEventListener("click", async () => {
    await Tone.start();
    showQuizScreen("interval");
  });
  document.getElementById("card-keysig").addEventListener("click", () => showQuizScreen("keysig"));
  document.getElementById("card-circle").addEventListener("click", () => showQuizScreen("circle"));
  document.getElementById("card-notation").addEventListener("click", () => showNotationChapterList());
  document.getElementById("card-freeplay").addEventListener("click", async () => {
    await Tone.start();
    showFreePlayScreen();
  });
  document.getElementById("back-to-menu").addEventListener("click", () => showMainMenu());
  document.getElementById("freeplay-back-menu").addEventListener("click", () => showMainMenu());
  document.getElementById("freeplay-octave-down").addEventListener("click", () => shiftFreePlayOctave(-1));
  document.getElementById("freeplay-octave-up").addEventListener("click", () => shiftFreePlayOctave(1));
  document.getElementById("freeplay-note-times").addEventListener("change", (e) => toggleFreePlayNoteTimes(e.target.checked));
  document.getElementById("notation-back-menu").addEventListener("click", () => showMainMenu());
  document.getElementById("lesson-prev").addEventListener("click", () => {
    if (state_default.currentLessonPage > 0) {
      state_default.currentLessonPage--;
      const chapter = NOTATION_CHAPTERS.find((c) => c.id === state_default.currentChapterId);
      renderLessonPage(chapter);
    }
  });
  document.getElementById("lesson-next").addEventListener("click", () => {
    const chapter = NOTATION_CHAPTERS.find((c) => c.id === state_default.currentChapterId);
    if (state_default.currentLessonPage >= chapter.pages.length - 1) {
      state_default.notationProgress.chapters[chapter.id].lessonComplete = true;
      saveNotationProgress(state_default.notationProgress);
      showNotationQuiz(chapter.id);
    } else {
      state_default.currentLessonPage++;
      renderLessonPage(chapter);
    }
  });
  document.getElementById("lesson-back-chapters").addEventListener("click", () => showNotationChapterList());
  document.getElementById("quiz-back-chapters").addEventListener("click", () => showNotationChapterList());
  document.getElementById("start-btn").addEventListener("click", async () => {
    await Tone.start();
    beginQuiz();
  });
  document.getElementById("replay-btn").addEventListener("click", async () => {
    await Tone.start();
    replayCurrentNote();
  });
  document.getElementById("continue-btn").addEventListener("click", () => {
    document.getElementById("level-complete").style.display = "none";
    if (state_default.isNotationQuizActive) {
      const nextChapter = NOTATION_CHAPTERS.find((c) => c.id === state_default.currentChapterId + 1);
      if (nextChapter) startChapter(nextChapter.id);
      return;
    }
    beginQuiz();
  });
  document.getElementById("stay-btn").addEventListener("click", () => {
    document.getElementById("level-complete").style.display = "none";
    if (state_default.isNotationQuizActive) {
      showNotationQuiz(state_default.currentChapterId);
      return;
    }
    const progress = getCurrentProgress();
    progress.currentLevel = Math.max(0, progress.currentLevel - 1);
    saveProgress();
    updateLevelDisplay();
    if (state_default.quizMode === "interval") buildIntervalButtons();
    else if (state_default.quizMode === "keysig") buildKeySigButtons();
    else rebuildKeyboard();
    beginQuiz();
  });
  document.getElementById("reset-stay-btn").addEventListener("click", () => {
    document.getElementById("level-complete").style.display = "none";
    if (state_default.isNotationQuizActive) {
      const cp = state_default.notationProgress.chapters[state_default.currentChapterId];
      cp.quizPassed = false;
      cp.quizStats = {};
      cp.quizMemory = {};
      cp.currentStreak = 0;
      cp.longestStreak = 0;
      cp.roundNumber = 0;
      const chapter = NOTATION_CHAPTERS.find((c) => c.id === state_default.currentChapterId);
      for (const q of chapter.quizPool) {
        cp.quizStats[q.id] = { correct: 0, total: 0 };
        cp.quizMemory[q.id] = { easiness: 2.5, interval: 1, repetitions: 0, lastSeen: 0, priority: 1 };
      }
      saveNotationProgress(state_default.notationProgress);
      showNotationQuiz(state_default.currentChapterId);
      return;
    }
    const progress = getCurrentProgress();
    const targetLevel = Math.max(0, progress.currentLevel - 1);
    progress.currentLevel = targetLevel;
    resetLevelStats(targetLevel);
    updateLevelDisplay();
    updateStatsDisplay();
    if (state_default.quizMode === "interval") buildIntervalButtons();
    else if (state_default.quizMode === "keysig") buildKeySigButtons();
    else rebuildKeyboard();
    beginQuiz();
  });
  document.getElementById("menu-btn").addEventListener("click", () => {
    document.getElementById("level-complete").style.display = "none";
    showMainMenu();
  });
  document.getElementById("level-picker").addEventListener("change", (e) => {
    const progress = getCurrentProgress();
    progress.currentLevel = parseInt(e.target.value, 10);
    saveProgress();
    updateLevelDisplay();
    if (state_default.quizMode === "interval") buildIntervalButtons();
    else if (state_default.quizMode === "keysig") buildKeySigButtons();
    else rebuildKeyboard();
    showWaitingState();
    updateStatsDisplay();
  });
  document.getElementById("unlock-all-btn").addEventListener("click", (e) => {
    e.preventDefault();
    state_default.allLevelsUnlocked = !state_default.allLevelsUnlocked;
    populateLevelPicker();
  });
  document.getElementById("show-labels").addEventListener("change", (e) => {
    state_default.showLabels = e.target.checked;
    document.getElementById("keyboard").classList.toggle("labels-hidden", !state_default.showLabels);
    saveProgress();
  });
  document.getElementById("reset-btn").addEventListener("click", resetProgress);
  if ("serviceWorker" in navigator) {
    navigator.serviceWorker.register("./sw.js");
  }
  fetch("./sw.js").then((r) => r.text()).then((text) => {
    const match = text.match(/APP_VERSION\s*=\s*['"](.+?)['"]/);
    if (match) document.getElementById("app-version").textContent = `v${match[1]}`;
  }).catch(() => {
  });
})();

    </script>
</body>
</html>
